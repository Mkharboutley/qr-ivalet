(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{92:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(3640)}])},1792:(e,t,n)=>{"use strict";n.d(t,{Uz:()=>w,Qg:()=>b});var r,i=n(6614),s=n(9207),o=n(8308);function a(e,t){let n={};for(let r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function l(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":{let t=Number(e.value);if(isNaN(t))throw Error("Data cannot be decoded from JSON: "+e);return t}default:throw Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>l(e)):"function"==typeof e||"object"==typeof e?a(e,e=>l(e)):e}let u="functions",h={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class c extends s.g{constructor(e,t,n){super(`${u}/${e}`,t||""),this.details=n}}class d{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{let e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.appCheck){let t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){let t=await this.getAuthToken();return{authToken:t,messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}let p="us-central1";class g{constructor(e,t,n,r,i=p,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new d(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{let e=new URL(i);this.customDomain=e.origin,this.region=p}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){let t=this.app.options.projectId;if(null!==this.emulatorOrigin){let n=this.emulatorOrigin;return`${n}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}async function m(e,t,n,r){let i;n["Content-Type"]="application/json";try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}async function y(e,t,n,r){var i;let s,o={data:n=function e(t){if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t)||!0===t||!1===t||"[object String]"===Object.prototype.toString.call(t))return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(t=>e(t));if("function"==typeof t||"object"==typeof t)return a(t,t=>e(t));throw Error("Data cannot be encoded in JSON: "+t)}(n)},u={},d=await e.contextProvider.getContext(r.limitedUseAppCheckTokens);d.authToken&&(u.Authorization="Bearer "+d.authToken),d.messagingToken&&(u["Firebase-Instance-ID-Token"]=d.messagingToken),null!==d.appCheckToken&&(u["X-Firebase-AppCheck"]=d.appCheckToken);let p=(i=r.timeout||7e4,s=null,{promise:new Promise((e,t)=>{s=setTimeout(()=>{t(new c("deadline-exceeded","deadline-exceeded"))},i)}),cancel:()=>{s&&clearTimeout(s)}}),g=await Promise.race([m(t,o,u,e.fetchImpl),p.promise,e.cancelAllRequests]);if(p.cancel(),!g)throw new c("cancelled","Firebase Functions instance was deleted.");let y=function(e,t){let n,r=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),i=r;try{let e=t&&t.error;if(e){let t=e.status;if("string"==typeof t){if(!h[t])return new c("internal","internal");r=h[t],i=t}let s=e.message;"string"==typeof s&&(i=s),n=e.details,void 0!==n&&(n=l(n))}}catch(e){}return"ok"===r?null:new c(r,i,n)}(g.status,g.json);if(y)throw y;if(!g.json)throw new c("internal","Response is not valid JSON object.");let v=g.json.data;if(void 0===v&&(v=g.json.result),void 0===v)throw new c("internal","Response is missing data field.");return{data:l(v)}}let v="@firebase/functions",_="0.10.0";function w(e=(0,i.Sx)(),t=p){let n=(0,i.j6)((0,s.Ku)(e),u).getImmediate({identifier:t}),r=(0,s.yU)("functions");return r&&function(e,t,n){var r;r=(0,s.Ku)(e),r.emulatorOrigin=`http://${t}:${n}`}(n,...r),n}function b(e,t,n){var r;return r=(0,s.Ku)(e),e=>(function(e,t,n,r){let i=e._url(t);return y(e,i,n,r)})(r,t,e,n||{})}r=fetch.bind(self),(0,i.om)(new o.uA(u,(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal");return new g(n,i,e.getProvider("messaging-internal"),e.getProvider("app-check-internal"),t,r)},"PUBLIC").setMultipleInstances(!0)),(0,i.KO)(v,_,void 0),(0,i.KO)(v,_,"esm2017")},2733:(e,t,n)=>{"use strict";n.d(t,{C:()=>i,x:()=>s});var r=n(6042);let i={apiKey:"AIzaSyAN2yho6jTCGMz03mJEF3KmaadBmRtOB1s",authDomain:"qr-ivalet.firebaseapp.com",projectId:"qr-ivalet",storageBucket:"qr-ivalet.firebasestorage.app",messagingSenderId:"449440591739",appId:"1:449440591739:web:e1a17a52350ca15c7a97de",measurementId:"G-S80BT7FPQH"},s=0===(0,r.Dk)().length?(0,r.Wp)(i):(0,r.Dk)()[0]},3640:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Z});var r=n(7876);n(6048);var i=n(5965),s=n(2733),o=n(4232),[a,l]=function(e={}){let{strict:t=!0,errorMessage:n="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:r}=e,i=o.createContext(void 0);return i.displayName=r,[i.Provider,function e(){var r;let s=o.useContext(i);if(!s&&t){let t=Error(n);throw t.name="ContextError",null==(r=Error.captureStackTrace)||r.call(Error,t,e),t}return s},i]}({name:"ProviderContext",strict:!1});let u=new Set(["Arab","Syrc","Samr","Mand","Thaa","Mend","Nkoo","Adlm","Rohg","Hebr"]),h=new Set(["ae","ar","arc","bcc","bqi","ckb","dv","fa","glk","he","ku","mzn","nqo","pnb","ps","sd","ug","ur","yi"]);function c(e){if(Intl.Locale){let t=new Intl.Locale(e).maximize(),n="function"==typeof t.getTextInfo?t.getTextInfo():t.textInfo;if(n)return"rtl"===n.direction;if(t.script)return u.has(t.script)}let t=e.split("-")[0];return h.has(t)}let d={prefix:String(Math.round(1e10*Math.random())),current:0},p=o.createContext(d),g=o.createContext(!1);"undefined"!=typeof window&&window.document&&window.document.createElement;let m=new WeakMap;function y(){return!1}function v(){return!0}function _(e){return()=>{}}o.useId;let w=Symbol.for("react-aria.i18n.locale");function b(){let e="undefined"!=typeof window&&window[w]||"undefined"!=typeof navigator&&(navigator.language||navigator.userLanguage)||"en-US";try{Intl.DateTimeFormat.supportedLocalesOf([e])}catch{e="en-US"}return{locale:e,direction:c(e)?"rtl":"ltr"}}let I=b(),T=new Set;function E(){for(let e of(I=b(),T))e(I)}let C=o.createContext(null);function S(e){let{locale:t,children:n}=e,r=function(){let e="function"==typeof o.useSyncExternalStore?o.useSyncExternalStore(_,y,v):(0,o.useContext)(g),[t,n]=(0,o.useState)(I);return((0,o.useEffect)(()=>(0===T.size&&window.addEventListener("languagechange",E),T.add(n),()=>{T.delete(n),0===T.size&&window.removeEventListener("languagechange",E)}),[]),e)?{locale:"en-US",direction:"ltr"}:t}(),i=o.useMemo(()=>t?{locale:t,direction:c(t)?"rtl":"ltr"}:r,[r,t]);return o.createElement(C.Provider,{value:i},n)}let k=null;function x(e){var t;return"undefined"!=typeof window&&null!=window.navigator&&((null==(t=window.navigator.userAgentData)?void 0:t.brands.some(t=>e.test(t.brand)))||e.test(window.navigator.userAgent))}function A(e){var t;return"undefined"!=typeof window&&null!=window.navigator&&e.test((null==(t=window.navigator.userAgentData)?void 0:t.platform)||window.navigator.platform)}function N(e){let t=null;return()=>(null==t&&(t=e()),t)}let D=N(function(){return A(/^Mac/i)}),R=N(function(){return A(/^iPhone/i)}),P=N(function(){return A(/^iPad/i)||D()&&navigator.maxTouchPoints>1}),O=N(function(){return R()||P()});N(function(){return D()||O()});let M=N(function(){return x(/AppleWebKit/i)&&!L()}),L=N(function(){return x(/Chrome/i)});N(function(){return x(/Android/i)});let F=N(function(){return x(/Firefox/i)}),U=(0,o.createContext)({isNative:!0,open:function(e,t){j(e,e=>q(e,t))},useHref:e=>e});function V(e){let{children:t,navigate:n,useHref:r}=e,i=(0,o.useMemo)(()=>({isNative:!1,open:(e,t,r,i)=>{j(e,e=>{var s,o;let a;(s=e,o=t,(a=s.getAttribute("target"))&&"_self"!==a||s.origin!==location.origin||s.hasAttribute("download")||o.metaKey||o.ctrlKey||o.altKey||o.shiftKey)?q(e,t):n(r,i)})},useHref:r||(e=>e)}),[n,r]);return o.createElement(U.Provider,{value:i},t)}function q(e,t,n=!0){var r,i;let{metaKey:s,ctrlKey:o,altKey:a,shiftKey:l}=t;F()&&(null==(i=window.event)||null==(r=i.type)?void 0:r.startsWith("key"))&&"_blank"===e.target&&(D()?s=!0:o=!0);let u=M()&&D()&&!P()&&1?new KeyboardEvent("keydown",{keyIdentifier:"Enter",metaKey:s,ctrlKey:o,altKey:a,shiftKey:l}):new MouseEvent("click",{metaKey:s,ctrlKey:o,altKey:a,shiftKey:l,bubbles:!0,cancelable:!0});if(q.isOpening=n,function(){if(null==k){k=!1;try{document.createElement("div").focus({get preventScroll(){return k=!0,!0}})}catch{}}return k}())e.focus({preventScroll:!0});else{let t=function(e){let t=e.parentNode,n=[],r=document.scrollingElement||document.documentElement;for(;t instanceof HTMLElement&&t!==r;)(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth)&&n.push({element:t,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),t=t.parentNode;return r instanceof HTMLElement&&n.push({element:r,scrollTop:r.scrollTop,scrollLeft:r.scrollLeft}),n}(e);e.focus(),function(e){for(let{element:t,scrollTop:n,scrollLeft:r}of e)t.scrollTop=n,t.scrollLeft=r}(t)}e.dispatchEvent(u),q.isOpening=!1}function j(e,t){if(e instanceof HTMLAnchorElement)t(e);else if(e.hasAttribute("data-href")){let n=document.createElement("a");n.href=e.getAttribute("data-href"),e.hasAttribute("data-target")&&(n.target=e.getAttribute("data-target")),e.hasAttribute("data-rel")&&(n.rel=e.getAttribute("data-rel")),e.hasAttribute("data-download")&&(n.download=e.getAttribute("data-download")),e.hasAttribute("data-ping")&&(n.ping=e.getAttribute("data-ping")),e.hasAttribute("data-referrer-policy")&&(n.referrerPolicy=e.getAttribute("data-referrer-policy")),e.appendChild(n),t(n),e.removeChild(n)}}q.isOpening=!1,n(8477);let B=o.createContext(null);function z(e){let{children:t}=e,n=(0,o.useContext)(B),[r,i]=(0,o.useState)(0),s=(0,o.useMemo)(()=>({parent:n,modalCount:r,addModal(){i(e=>e+1),n&&n.addModal()},removeModal(){i(e=>e-1),n&&n.removeModal()}}),[n,r]);return o.createElement(B.Provider,{value:s},t)}function K(e){let t,{modalProviderProps:n}={modalProviderProps:{"aria-hidden":!!(t=(0,o.useContext)(B))&&t.modalCount>0||void 0}};return o.createElement("div",{"data-overlay-container":!0,...e,...n})}function $(e){return o.createElement(z,null,o.createElement(K,e))}let G={},H=(0,o.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),W=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]),Q=e=>!isValidMotionProp(e);function Y(e){}try{Y(require("@emotion/is-prop-valid").default)}catch{}function X({children:e,isValidProp:t,...n}){t&&Y(t),(n={...(0,o.useContext)(H),...n}).isStatic=function(e){let t=(0,o.useRef)(null);return null===t.current&&(t.current=e()),t.current}(()=>n.isStatic);let i=(0,o.useMemo)(()=>n,[JSON.stringify(n.transition),n.transformPagePoint,n.reducedMotion]);return(0,r.jsx)(H.Provider,{value:i,children:e})}var J=({children:e,navigate:t,disableAnimation:n,useHref:i,disableRipple:s=!1,skipFramerMotionAnimations:l=n,reducedMotion:u="never",validationBehavior:h,locale:c="en-US",defaultDates:d,createCalendar:p,...g})=>{let m=e;t&&(m=(0,r.jsx)(V,{navigate:t,useHref:i,children:m}));let y=(0,o.useMemo)(()=>(n&&l&&(G.skipAnimations=!0),{createCalendar:p,defaultDates:d,disableAnimation:n,disableRipple:s,validationBehavior:h}),[p,null==d?void 0:d.maxDate,null==d?void 0:d.minDate,n,s,h]);return(0,r.jsx)(a,{value:y,children:(0,r.jsx)(S,{locale:c,children:(0,r.jsx)(X,{reducedMotion:u,children:(0,r.jsx)($,{...g,children:m})})})})};function Z(e){let{Component:t,pageProps:n}=e;return(0,r.jsx)(i.qB,{firebaseConfig:s.C,children:(0,r.jsx)(J,{children:(0,r.jsx)(t,{...n})})})}},5282:(e,t,n)=>{"use strict";n.d(t,{xI:()=>nd,hg:()=>te,x9:()=>e8});var r=n(9207),i=n(6614);function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}Object.create;Object.create;var o=("function"==typeof SuppressedError&&SuppressedError,n(6525)),a=n(8308);function l(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let u=new r.FA("auth","Firebase",l()),h=new o.Vy("@firebase/auth");function c(e,...t){h.logLevel<=o.$b.ERROR&&h.error(`Auth (${i.MF}): ${e}`,...t)}function d(e,...t){throw y(e,...t)}function p(e,...t){return y(e,...t)}function g(e,t,n){let i=Object.assign(Object.assign({},l()),{[t]:n});return new r.FA("auth","Firebase",i).create(t,{appName:e.name})}function m(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&d(e,"argument-error"),g(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function y(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return u.create(e,...t)}function v(e,t,...n){if(!e)throw y(t,...n)}function _(e){let t="INTERNAL ASSERTION FAILED: "+e;throw c(t),Error(t)}function w(e,t){e||_(t)}function b(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function I(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class T{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||_(n),this.isMobile=(0,r.jZ)()||(0,r.lV)()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===I()||"https:"===I()||(0,r.sr)()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function E(e,t){var n,r;n=e.emulator,r="Emulator should always be set here",n||_(r);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class C{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void _("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void _("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void _("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let S={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},k=new T(3e4,6e4);function x(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function A(e,t,n,i,s={}){return N(e,s,async()=>{let s={},o={};i&&("GET"===t?o=i:s={body:JSON.stringify(i)});let a=(0,r.Am)(Object.assign({key:e.config.apiKey},o)).slice(1),l=await e._getAdditionalHeaders();return l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode),C.fetch()(R(e,e.config.apiHost,n,a),Object.assign({method:t,headers:l,referrerPolicy:"no-referrer"},s))})}async function N(e,t,n){e._canInitEmulator=!1;let i=Object.assign(Object.assign({},S),t);try{let t=new P(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw O(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw O(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw O(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw O(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw g(e,o,n);d(e,o)}}catch(t){if(t instanceof r.g)throw t;d(e,"network-request-failed",{message:String(t)})}}async function D(e,t,n,r,i={}){let s=await A(e,t,n,r,i);return"mfaPendingCredential"in s&&d(e,"multi-factor-auth-required",{_serverResponse:s}),s}function R(e,t,n,r){let i=`${t}${n}?${r}`;return e.config.emulator?E(e.config,i):`${e.config.apiScheme}://${i}`}class P{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(p(this.auth,"network-request-failed")),k.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function O(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=p(e,t,r);return i.customData._tokenResponse=n,i}async function M(e,t){return A(e,"POST","/v1/accounts:delete",t)}async function L(e,t){return A(e,"POST","/v1/accounts:lookup",t)}function F(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function U(e,t=!1){let n=(0,r.Ku)(e),i=await n.getIdToken(t),s=q(i);v(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");let o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:i,authTime:F(V(s.auth_time)),issuedAtTime:F(V(s.iat)),expirationTime:F(V(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}function V(e){return 1e3*Number(e)}function q(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return c("JWT malformed, contained fewer than 3 sections"),null;try{let e=(0,r.u)(n);if(!e)return c("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return c("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function j(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof r.g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class B{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class z{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=F(this.lastLoginAt),this.creationTime=F(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function K(e){var t,n,r;let i=e.auth,o=await e.getIdToken(),a=await j(e,L(i,{idToken:o}));v(null==a?void 0:a.users.length,i,"internal-error");let l=a.users[0];e._notifyReloadListener(l);let u=(null==(t=l.providerUserInfo)?void 0:t.length)?l.providerUserInfo.map(e=>{var{providerId:t}=e,n=s(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],h=(n=e.providerData,r=u,[...n.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),c=e.isAnonymous,d=!(e.email&&l.passwordHash)&&!(null==h?void 0:h.length);Object.assign(e,{uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:h,metadata:new z(l.createdAt,l.lastLoginAt),isAnonymous:!!c&&d})}async function $(e){let t=(0,r.Ku)(e);await K(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}async function G(e,t){let n=await N(e,{},async()=>{let n=(0,r.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,o=R(e,i,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",C.fetch()(o,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}class H{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){let t=q(e);return v(t,"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return(v(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired)?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await G(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new H;return n&&(v("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(v("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(v("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new H,this.toJSON())}_performRefresh(){return _("not implemented")}}function W(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Q{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=s(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new B(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new z(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await j(this,this.stsTokenManager.getToken(this.auth,e));return v(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return U(this,e)}reload(){return $(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new Q(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await K(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){let e=await this.getIdToken();return await j(this,M(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,l,u;let h=null!=(n=t.displayName)?n:void 0,c=null!=(r=t.email)?r:void 0,d=null!=(i=t.phoneNumber)?i:void 0,p=null!=(s=t.photoURL)?s:void 0,g=null!=(o=t.tenantId)?o:void 0,m=null!=(a=t._redirectEventId)?a:void 0,y=null!=(l=t.createdAt)?l:void 0,_=null!=(u=t.lastLoginAt)?u:void 0,{uid:w,emailVerified:b,isAnonymous:I,providerData:T,stsTokenManager:E}=t;v(w&&E,e,"internal-error");let C=H.fromJSON(this.name,E);v("string"==typeof w,e,"internal-error"),W(h,e.name),W(c,e.name),v("boolean"==typeof b,e,"internal-error"),v("boolean"==typeof I,e,"internal-error"),W(d,e.name),W(p,e.name),W(g,e.name),W(m,e.name),W(y,e.name),W(_,e.name);let S=new Q({uid:w,auth:e,email:c,emailVerified:b,displayName:h,isAnonymous:I,photoURL:p,phoneNumber:d,tenantId:g,stsTokenManager:C,createdAt:y,lastLoginAt:_});return T&&Array.isArray(T)&&(S.providerData=T.map(e=>Object.assign({},e))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(e,t,n=!1){let r=new H;r.updateFromServerResponse(t);let i=new Q({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await K(i),i}}let Y=new Map;function X(e){var t,n;t="Expected a class definition",e instanceof Function||_(t);let r=Y.get(e);return r?(n="Instance stored in cache mismatched with class",r instanceof e||_(n)):(r=new e,Y.set(e,r)),r}class J{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function Z(e,t,n){return`firebase:${e}:${t}:${n}`}J.type="NONE";class ee{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:r,name:i}=this.auth;this.fullUserKey=Z(this.userKey,r.apiKey,i),this.fullPersistenceKey=Z("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?Q._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ee(X(J),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||X(J),s=Z(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let r=Q._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}let a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length&&(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new ee(i,e,n)}}function et(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(es(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(en(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ea(t))return"Blackberry";if(el(t))return"Webos";if(er(t))return"Safari";if((t.includes("chrome/")||ei(t))&&!t.includes("edge/"))return"Chrome";if(eo(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function en(e=(0,r.ZQ)()){return/firefox\//i.test(e)}function er(e=(0,r.ZQ)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ei(e=(0,r.ZQ)()){return/crios\//i.test(e)}function es(e=(0,r.ZQ)()){return/iemobile/i.test(e)}function eo(e=(0,r.ZQ)()){return/android/i.test(e)}function ea(e=(0,r.ZQ)()){return/blackberry/i.test(e)}function el(e=(0,r.ZQ)()){return/webos/i.test(e)}function eu(e=(0,r.ZQ)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function eh(e=(0,r.ZQ)()){return eu(e)||eo(e)||el(e)||ea(e)||/windows phone/i.test(e)||es(e)}function ec(e,t=[]){let n;switch(e){case"Browser":n=et((0,r.ZQ)());break;case"Worker":n=`${et((0,r.ZQ)())}-${e}`;break;default:n=e}let s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${i.MF}/${s}`}async function ed(e,t){return A(e,"GET","/v2/recaptchaConfig",x(e,t))}function ef(e){return void 0!==e&&void 0!==e.enterprise}class ep{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState)}}function eg(e){return new Promise((t,n)=>{var r,i;let s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{let t=p("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(null!=(i=null==(r=document.getElementsByTagName("head"))?void 0:r[0])?i:document).appendChild(s)})}function em(e){return`__${e}${Math.floor(1e6*Math.random())}`}class ey{constructor(e){this.type="recaptcha-enterprise",this.auth=eb(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{ed(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0===r.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new ep(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;ef(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&ef(window.grecaptcha))r(n,e,i);else{if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));eg("https://www.google.com/recaptcha/enterprise.js?render="+n).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function ev(e,t,n,r=!1){let i,s=new ey(e);try{i=await s.verify(n)}catch(e){i=await s.verify(n,!0)}let o=Object.assign({},t);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class e_{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class ew{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eI(this),this.idTokenSubscription=new eI(this),this.beforeStateQueue=new e_(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=X(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted){if(this.persistenceManager=await ee.create(this,e),!this._deleted){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(r=this.currentUser)?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser(),r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);(!n||n===s)&&(null==o?void 0:o.user)&&(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await K(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){let t=e?(0,r.Ku)(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(X(e))})}async initializeRecaptchaConfig(){let e=new ep(await ed(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==this.tenantId?this._agentRecaptchaConfig=e:this._tenantRecaptchaConfigs[this.tenantId]=e,e.emailPasswordEnabled&&new ey(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&X(e)||this._popupRedirectResolver;v(t,this,"argument-error"),this.redirectPersistenceManager=await ee.create(this,[X(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(n=this.redirectUser)?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return(v(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t)?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ec(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);let r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){h.logLevel<=o.$b.WARN&&h.warn(`Auth (${i.MF}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function eb(e){return(0,r.Ku)(e)}class eI{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,r.tD)(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function eT(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function eE(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class eC{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return _("not implemented")}_getIdTokenResponse(e){return _("not implemented")}_linkToIdToken(e,t){return _("not implemented")}_getReauthenticationResolver(e){return _("not implemented")}}async function eS(e,t){return A(e,"POST","/v1/accounts:resetPassword",x(e,t))}async function ek(e,t){return A(e,"POST","/v1/accounts:update",t)}async function ex(e,t){return D(e,"POST","/v1/accounts:signInWithPassword",x(e,t))}async function eA(e,t){return A(e,"POST","/v1/accounts:sendOobCode",x(e,t))}async function eN(e,t){return D(e,"POST","/v1/accounts:signInWithEmailLink",x(e,t))}async function eD(e,t){return D(e,"POST","/v1/accounts:signInWithEmailLink",x(e,t))}class eR extends eC{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new eR(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new eR(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":let n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null==(t=e._getRecaptchaConfig())||!t.emailPasswordEnabled)return ex(e,n).catch(async t=>{if("auth/missing-recaptcha-token"!==t.code)return Promise.reject(t);{console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");let t=await ev(e,n,"signInWithPassword");return ex(e,t)}});{let t=await ev(e,n,"signInWithPassword");return ex(e,t)}case"emailLink":return eN(e,{email:this._email,oobCode:this._password});default:d(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ek(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return eD(e,{idToken:t,email:this._email,oobCode:this._password});default:d(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function eP(e,t){return D(e,"POST","/v1/accounts:signInWithIdp",x(e,t))}class eO extends eC{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new eO(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):d("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=s(t,["providerId","signInMethod"]);if(!n||!r)return null;let o=new eO(n,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){return eP(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,eP(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,eP(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,r.Am)(t)}return e}}async function eM(e,t){return A(e,"POST","/v1/accounts:sendVerificationCode",x(e,t))}async function eL(e,t){return D(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,t))}async function eF(e,t){let n=await D(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,t));if(n.temporaryProof)throw O(e,"account-exists-with-different-credential",n);return n}let eU={USER_NOT_FOUND:"user-not-found"};async function eV(e,t){return D(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),eU)}class eq extends eC{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new eq({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new eq({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return eL(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return eF(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return eV(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new eq({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class ej{constructor(e){var t,n,i,s,o,a;let l=(0,r.I9)((0,r.hp)(e)),u=null!=(t=l.apiKey)?t:null,h=null!=(n=l.oobCode)?n:null,c=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(i=l.mode)?i:null);v(u&&h&&c,"argument-error"),this.apiKey=u,this.operation=c,this.code=h,this.continueUrl=null!=(s=l.continueUrl)?s:null,this.languageCode=null!=(o=l.languageCode)?o:null,this.tenantId=null!=(a=l.tenantId)?a:null}static parseLink(e){let t=function(e){let t=(0,r.I9)((0,r.hp)(e)).link,n=t?(0,r.I9)((0,r.hp)(t)).deep_link_id:null,i=(0,r.I9)((0,r.hp)(e)).deep_link_id;return(i?(0,r.I9)((0,r.hp)(i)).link:null)||i||n||t||e}(e);try{return new ej(t)}catch(e){return null}}}class eB{constructor(){this.providerId=eB.PROVIDER_ID}static credential(e,t){return eR._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=ej.parseLink(t);return v(n,"argument-error"),eR._fromEmailAndCode(e,n.code,n.tenantId)}}eB.PROVIDER_ID="password",eB.EMAIL_PASSWORD_SIGN_IN_METHOD="password",eB.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ez{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class eK extends ez{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class e$ extends eK{constructor(){super("facebook.com")}static credential(e){return eO._fromParams({providerId:e$.PROVIDER_ID,signInMethod:e$.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e$.credentialFromTaggedObject(e)}static credentialFromError(e){return e$.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e$.credential(e.oauthAccessToken)}catch(e){return null}}}e$.FACEBOOK_SIGN_IN_METHOD="facebook.com",e$.PROVIDER_ID="facebook.com";class eG extends eK{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return eO._fromParams({providerId:eG.PROVIDER_ID,signInMethod:eG.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return eG.credentialFromTaggedObject(e)}static credentialFromError(e){return eG.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return eG.credential(t,n)}catch(e){return null}}}eG.GOOGLE_SIGN_IN_METHOD="google.com",eG.PROVIDER_ID="google.com";class eH extends eK{constructor(){super("github.com")}static credential(e){return eO._fromParams({providerId:eH.PROVIDER_ID,signInMethod:eH.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return eH.credentialFromTaggedObject(e)}static credentialFromError(e){return eH.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return eH.credential(e.oauthAccessToken)}catch(e){return null}}}eH.GITHUB_SIGN_IN_METHOD="github.com",eH.PROVIDER_ID="github.com";class eW extends eK{constructor(){super("twitter.com")}static credential(e,t){return eO._fromParams({providerId:eW.PROVIDER_ID,signInMethod:eW.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return eW.credentialFromTaggedObject(e)}static credentialFromError(e){return eW.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return eW.credential(t,n)}catch(e){return null}}}eW.TWITTER_SIGN_IN_METHOD="twitter.com",eW.PROVIDER_ID="twitter.com";class eQ{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new eQ({user:await Q._fromIdTokenResponse(e,n,r),providerId:eY(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new eQ({user:e,providerId:eY(n),_tokenResponse:n,operationType:t})}}function eY(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class eX extends r.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,eX.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new eX(e,t,n,r)}}function eJ(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw eX._fromErrorAndOperation(e,n,t,r);throw n})}async function eZ(e,t,n=!1){let r=await j(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return eQ._forOperation(e,"link",r)}async function e0(e,t,n){await K(t),v(new Set(t.providerData.map(({providerId:e})=>e).filter(e=>!!e)).has(n)===e,t.auth,!1===e?"provider-already-linked":"no-such-provider")}async function e1(e,t,n=!1){let{auth:r}=e,i="reauthenticate";try{let s=await j(e,eJ(r,i,t,e),n);v(s.idToken,r,"internal-error");let o=q(s.idToken);v(o,r,"internal-error");let{sub:a}=o;return v(e.uid===a,r,"user-mismatch"),eQ._forOperation(e,i,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&d(r,"user-mismatch"),e}}async function e2(e,t,n=!1){let r="signIn",i=await eJ(e,r,t),s=await eQ._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function e3(e,t){return e2(eb(e),t)}class e4{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?e6._fromServerResponse(e,t):"totpInfo"in t?e5._fromServerResponse(e,t):d(e,"internal-error")}}class e6 extends e4{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new e6(t)}}class e5 extends e4{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new e5(t)}}function e8(e,t,n){return e3((0,r.Ku)(e),eB.credential(t,n))}class e9{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class e7 extends e9{constructor(e,t,n,r){super(e,t,n),this.username=r}}function te(e,t,n,i){return(0,r.Ku)(e).onAuthStateChanged(t,n,i)}class tt{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new tt("enroll",e,t)}static _fromMfaPendingCredential(e){return new tt("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null==(t=e.multiFactorSession)?void 0:t.pendingCredential)return tt._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);else if(null==(n=e.multiFactorSession)?void 0:n.idToken)return tt._fromIdtoken(e.multiFactorSession.idToken)}return null}}class tn{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){let n=eb(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>e4._fromServerResponse(n,e));v(r.mfaPendingCredential,n,"internal-error");let s=tt._fromMfaPendingCredential(r.mfaPendingCredential);return new tn(s,i,async e=>{let i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;let o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let a=await eQ._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(a.user),a;case"reauthenticate":return v(t.user,n,"internal-error"),eQ._forOperation(t.user,t.operationType,o);default:d(n,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class tr{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>e4._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new tr(e)}async getSession(){return tt._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){let n=await this.getSession(),r=await j(this.user,e._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{var r,i;let e=await j(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},A(r,"POST","/v2/accounts/mfaEnrollment:withdraw",x(r,i))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;let ti="__sak";class ts{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(ti,"1"),this.storage.removeItem(ti),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class to extends ts{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){let e=(0,r.ZQ)();return er(e)||eu(e)}()&&function(){try{return!!(window&&window!==window.top)}catch(e){return!1}}(),this.fallbackToPolling=eh(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}let i=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,r.lT)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}to.type="LOCAL";class ta extends ts{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ta.type="SESSION";class tl{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new tl(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:r}=e.data,i=this.handlersMap[n];if(!(null==i?void 0:i.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(i).map(async t=>t(e.origin,r)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function tu(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}tl.receivers=[];class th{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r,i,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=tu("",20);s.port1.start();let u=setTimeout(()=>{a(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(e.data.response);break;default:clearTimeout(u),clearTimeout(r),a(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function tc(){return window}function td(){return void 0!==tc().WorkerGlobalScope&&"function"==typeof tc().importScripts}async function tf(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let tp="firebaseLocalStorageDb",tg="firebaseLocalStorage",tm="fbase_key";class ty{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function tv(e,t){return e.transaction([tg],t?"readwrite":"readonly").objectStore(tg)}function t_(){let e=indexedDB.open(tp,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(tg,{keyPath:tm})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(tg)?t(n):(n.close(),await new ty(indexedDB.deleteDatabase(tp)).toPromise(),t(await t_()))})})}async function tw(e,t,n){return new ty(tv(e,!0).put({[tm]:t,value:n})).toPromise()}async function tb(e,t){let n=tv(e,!1).get(t),r=await new ty(n).toPromise();return void 0===r?null:r.value}function tI(e,t){return new ty(tv(e,!0).delete(t)).toPromise()}class tT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await t_()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return td()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tl._getInstance(td()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await tf(),!this.activeServiceWorker)return;this.sender=new th(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null==(e=n[0])?void 0:e.fulfilled)&&(null==(t=n[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await t_();return await tw(e,ti,"1"),await tI(e,ti),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>tw(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>tb(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tI(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new ty(tv(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}tT.type="LOCAL",em("rcb"),new T(3e4,6e4);async function tE(e,t,n){var r,i,s;let o=await n.verify();try{let a;if(v("string"==typeof o,e,"argument-error"),v("recaptcha"===n.type,e,"argument-error"),a="string"==typeof t?{phoneNumber:t}:t,"session"in a){let t=a.session;if("phoneNumber"in a)return v("enroll"===t.type,e,"internal-error"),(await (i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:a.phoneNumber,recaptchaToken:o}},A(e,"POST","/v2/accounts/mfaEnrollment:start",x(e,i)))).phoneSessionInfo.sessionInfo;{v("signin"===t.type,e,"internal-error");let n=(null==(r=a.multiFactorHint)?void 0:r.uid)||a.multiFactorUid;return v(n,e,"missing-multi-factor-info"),(await (s={mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:o}},A(e,"POST","/v2/accounts/mfaSignIn:start",x(e,s)))).phoneResponseInfo.sessionInfo}}{let{sessionInfo:t}=await eM(e,{phoneNumber:a.phoneNumber,recaptchaToken:o});return t}}finally{n._reset()}}class tC{constructor(e){this.providerId=tC.PROVIDER_ID,this.auth=eb(e)}verifyPhoneNumber(e,t){return tE(this.auth,e,(0,r.Ku)(t))}static credential(e,t){return eq._fromVerification(e,t)}static credentialFromResult(e){return tC.credentialFromTaggedObject(e)}static credentialFromError(e){return tC.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?eq._fromTokenResponse(t,n):null}}function tS(e,t){return t?X(t):(v(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}tC.PROVIDER_ID="phone",tC.PHONE_SIGN_IN_METHOD="phone";class tk extends eC{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return eP(e,this._buildIdpRequest())}_linkToIdToken(e,t){return eP(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return eP(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function tx(e){return e2(e.auth,new tk(e),e.bypassAuthState)}function tA(e){let{auth:t,user:n}=e;return v(n,t,"internal-error"),e1(n,new tk(e),e.bypassAuthState)}async function tN(e){let{auth:t,user:n}=e;return v(n,t,"internal-error"),eZ(n,new tk(e),e.bypassAuthState)}class tD{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tx;case"linkViaPopup":case"linkViaRedirect":return tN;case"reauthViaPopup":case"reauthViaRedirect":return tA;default:d(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||_(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||_(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let tR=new T(2e3,1e4);class tP extends tD{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,tP.currentPopupAction&&tP.currentPopupAction.cancel(),tP.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return v(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||_(t);let n=tu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(p(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(p(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tP.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null==(n=null==(t=this.authWindow)?void 0:t.window)?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(p(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,tR.get())};e()}}tP.currentPopupAction=null;let tO=new Map;class tM extends tD{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=tO.get(this.auth._key());if(!e){try{let t=await tL(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}tO.set(this.auth._key(),e)}return this.bypassAuthState||tO.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function tL(e,t){let n=tq(t),r=tV(e);if(!await r._isAvailable())return!1;let i=await r._get(n)==="true";return await r._remove(n),i}async function tF(e,t){return tV(e)._set(tq(t),"true")}function tU(e,t){tO.set(e._key(),t)}function tV(e){return X(e._redirectPersistence)}function tq(e){return Z("pendingRedirect",e.config.apiKey,e.name)}async function tj(e,t,n=!1){let r=eb(e),i=tS(r,t),s=new tM(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function tB(e){let t=tu(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class tz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return t$(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!t$(e)){let r=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error";t.onError(p(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(tK(e))}saveEventToCache(e){this.cachedEventUids.add(tK(e)),this.lastProcessedEventTime=Date.now()}}function tK(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function t$({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function tG(e,t={}){return A(e,"GET","/v1/projects",t)}let tH=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tW=/^https?/;async function tQ(e){if(e.config.emulator)return;let{authorizedDomains:t}=await tG(e);for(let e of t)try{if(function(e){let t=b(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!tW.test(n))return!1;if(tH.test(e))return r===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}(e))return}catch(e){}d(e,"unauthorized-domain")}let tY=new T(3e4,6e4);function tX(){let e=tc().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let tJ=null,tZ=new T(5e3,15e3),t0={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},t1=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function t2(e){let t=await (tJ=tJ||new Promise((t,n)=>{var r,i,s;function o(){tX(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{tX(),n(p(e,"network-request-failed"))},timeout:tY.get()})}if(null==(i=null==(r=tc().gapi)?void 0:r.iframes)?void 0:i.Iframe)t(gapi.iframes.getContext());else if(null==(s=tc().gapi)?void 0:s.load)o();else{let t=em("iframefcb");return tc()[t]=()=>{gapi.load?o():n(p(e,"network-request-failed"))},eg(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}}).catch(e=>{throw tJ=null,e})),n=tc().gapi;return v(n,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;v(t.authDomain,e,"auth-domain-config-required");let n=t.emulator?E(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:i.MF},o=t1.get(e.config.apiHost);o&&(s.eid=o);let a=e._getFrameworks();return a.length&&(s.fw=a.join(",")),`${n}?${(0,r.Am)(s).slice(1)}`}(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:t0,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=p(e,"network-request-failed"),s=tc().setTimeout(()=>{r(i)},tZ.get());function o(){tc().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}let t3={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class t4{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let t6=encodeURIComponent("fac");async function t5(e,t,n,s,o,a){v(e.config.authDomain,e,"auth-domain-config-required"),v(e.config.apiKey,e,"invalid-api-key");let l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:i.MF,eventId:o};if(t instanceof ez)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,r.Im)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(a||{})))l[n]=i;if(t instanceof eK){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(l.scopes=e.join(","))}for(let t of(e.tenantId&&(l.tid=e.tenantId),Object.keys(l)))void 0===l[t]&&delete l[t];let u=await e._getAppCheckToken(),h=u?`#${t6}=${encodeURIComponent(u)}`:"";return`${function({config:e}){return e.emulator?E(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,r.Am)(l).slice(1)}${h}`}let t8="webStorageSupport";class t9{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ta,this._completeRedirectFn=tj,this._overrideRedirectResult=tU}async _openPopup(e,t,n,i){var s,o,a;o=null==(s=this.eventManagers[e._key()])?void 0:s.manager,a="_initialize() not called before _openPopup()",o||_(a);let l=await t5(e,t,n,b(),i);return function(e,t,n,i=500,s=600){let o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString(),l="",u=Object.assign(Object.assign({},t3),{width:i.toString(),height:s.toString(),top:o,left:a}),h=(0,r.ZQ)().toLowerCase();n&&(l=ei(h)?"_blank":n),en(h)&&(t=t||"http://localhost",u.scrollbars="yes");let c=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,r.ZQ)()){var t;return eu(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(h)&&"_self"!==l)return function(e,t){let n=document.createElement("a");n.href=e,n.target=t;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",l),new t4(null);let d=window.open(t||"",l,c);v(d,e,"popup-blocked");try{d.focus()}catch(e){}return new t4(d)}(e,l,tu())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=await t5(e,t,n,b(),r),tc().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",r||_(n),r)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await t2(e),n=new tz(e);return t.register("authEvent",t=>(v(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(t8,{type:t8},n=>{var r;let i=null==(r=null==n?void 0:n[0])?void 0:r[t8];void 0!==i&&t(!!i),d(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=tQ(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return eh()||er()||eu()}}class t7{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return _("unexpected MultiFactorSessionType")}}}class ne extends t7{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new ne(e)}_finalizeEnroll(e,t,n){return A(e,"POST","/v2/accounts/mfaEnrollment:finalize",x(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return A(e,"POST","/v2/accounts/mfaSignIn:finalize",x(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class nt{constructor(){}static assertion(e){return ne._fromCredential(e)}}nt.FACTOR_ID="phone";class nn{static assertionForEnrollment(e,t){return nr._fromSecret(e,t)}static assertionForSignIn(e,t){return nr._fromEnrollmentId(e,t)}static async generateSecret(e){var t;v(void 0!==e.auth,"internal-error");let n=await A(t=e.auth,"POST","/v2/accounts/mfaEnrollment:start",x(t,{idToken:e.credential,totpEnrollmentInfo:{}}));return ni._fromStartTotpMfaEnrollmentResponse(n,e.auth)}}nn.FACTOR_ID="totp";class nr extends t7{constructor(e,t,n){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=n}static _fromSecret(e,t){return new nr(t,void 0,e)}static _fromEnrollmentId(e,t){return new nr(t,e)}async _finalizeEnroll(e,t,n){return v(void 0!==this.secret,e,"argument-error"),A(e,"POST","/v2/accounts/mfaEnrollment:finalize",x(e,{idToken:t,displayName:n,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}))}async _finalizeSignIn(e,t){v(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let n={verificationCode:this.otp};return A(e,"POST","/v2/accounts/mfaSignIn:finalize",x(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:n}))}}class ni{constructor(e,t,n,r,i,s,o){this.sessionInfo=s,this.auth=o,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=n,this.codeIntervalSeconds=r,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new ni(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var n;let r=!1;return(ns(e)||ns(t))&&(r=!0),r&&(ns(e)&&(e=(null==(n=this.auth.currentUser)?void 0:n.email)||"unknownuser"),ns(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function ns(e){return void 0===e||(null==e?void 0:e.length)===0}var no="@firebase/auth",na="0.23.2";class nl{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let nu=(0,r.XA)("authIdTokenMaxAge")||300,nh=null,nc=e=>async t=>{let n=t&&await t.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>nu)return;let i=null==n?void 0:n.token;nh!==i&&(nh=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function nd(e=(0,i.Sx)()){let t=(0,i.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=(0,i.j6)(e,"auth");if(n.isInitialized()){let e=n.getImmediate(),i=n.getOptions();if((0,r.bD)(i,null!=t?t:{}))return e;d(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:t9,persistence:[tT,to,ta]}),s=(0,r.XA)("authTokenSyncURL");if(s){let e=nc(s);(0,r.Ku)(n).beforeAuthStateChanged(e,()=>e(n.currentUser)),(0,r.Ku)(n).onIdTokenChanged(t=>e(t),void 0,void 0)}let o=(0,r.Tj)("auth");return o&&function(e,t,n){let r=eb(e);v(r._canInitEmulator,r,"emulator-config-failed"),v(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let i=eT(t),{host:s,port:o}=function(e){let t=eT(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:eE(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:eE(t)}}}(t),a=null===o?"":`:${o}`;r.config.emulator={url:`${i}//${s}${a}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${o}`),n}!function(e){(0,i.om)(new a.uA("auth",(t,{options:n})=>{let r=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;v(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let l=new ew(r,i,s,{apiKey:o,authDomain:a,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ec(e)}),u=(null==n?void 0:n.persistence)||[],h=(Array.isArray(u)?u:[u]).map(X);return(null==n?void 0:n.errorMap)&&l._updateErrorMap(n.errorMap),l._initializeWithPersistence(h,null==n?void 0:n.popupRedirectResolver),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,i.om)(new a.uA("auth-internal",e=>new nl(eb(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,i.KO)(no,na,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(e)),(0,i.KO)(no,na,"esm2017")}("Browser")},5364:(e,t,n)=>{"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(5861)},5665:(e,t,n)=>{"use strict";n.d(t,{Dc:()=>rp,rJ:()=>hO,H9:()=>hM,x7:()=>cR,GG:()=>cO,aU:()=>hV,aQ:()=>cL,My:()=>cm,P:()=>cc,c4:()=>cB,mZ:()=>cM,_M:()=>cf});var r,i,s,o,a,l,u,h=n(6614),c=n(8308),d=n(6525),p=n(9207),g={},m=m||{},y=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})||self;function v(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function _(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function w(e,t,n){return e.call.apply(e.bind,arguments)}function b(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function I(e,t,n){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:b).apply(null,arguments)}function T(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function E(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function C(){this.s=this.s,this.o=this.o}C.prototype.s=!1,C.prototype.sa=function(){this.s||(this.s=!0,this.N())},C.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let S=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function k(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function x(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(v(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function A(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}A.prototype.h=function(){this.defaultPrevented=!0};var N=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{y.addEventListener("test",()=>{},t),y.removeEventListener("test",()=>{},t)}catch(e){}return e}();function D(e){return/^[\s\xa0]*$/.test(e)}function R(){var e=y.navigator;return e&&(e=e.userAgent)?e:""}function P(e){return -1!=R().indexOf(e)}function O(e){return O[" "](e),e}O[" "]=function(){};var M=P("Opera"),L=P("Trident")||P("MSIE"),F=P("Edge"),U=F||L,V=P("Gecko")&&!(-1!=R().toLowerCase().indexOf("webkit")&&!P("Edge"))&&!(P("Trident")||P("MSIE"))&&!P("Edge"),q=-1!=R().toLowerCase().indexOf("webkit")&&!P("Edge");function j(){var e=y.document;return e?e.documentMode:void 0}e:{var B="",z=function(){var e=R();return V?/rv:([^\);]+)(\)|;)/.exec(e):F?/Edge\/([\d\.]+)/.exec(e):L?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):q?/WebKit\/(\S+)/.exec(e):M?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(z&&(B=z?z[1]:""),L){var K=j();if(null!=K&&K>parseFloat(B)){i=String(K);break e}}i=B}var $=s=y.document&&L&&(j()||parseInt(i,10))||void 0;function G(e,t){if(A.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(V){e:{try{O(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:H[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&G.$.h.call(this)}}E(G,A);var H={2:"touch",3:"pen",4:"mouse"};G.prototype.h=function(){G.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var W="closure_listenable_"+(1e6*Math.random()|0),Q=0;function Y(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Q,this.fa=this.ia=!1}function X(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function J(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function Z(e){let t={};for(let n in e)t[n]=e[n];return t}let ee="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<ee.length;t++)n=ee[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function en(e){this.src=e,this.g={},this.h=0}function er(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=S(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(X(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ei(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==r)return i}return -1}en.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=ei(e,t,r,i);return -1<o?(t=e[o],n||(t.ia=!1)):((t=new Y(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var es="closure_lm_"+(1e6*Math.random()|0),eo={};function ea(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=_(i)?!!i.capture:!!i,a=ec(e);if(a||(e[es]=a=new en(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function e(t){return eh.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)N||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(eu(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function el(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[W])er(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(eu(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ec(t))?(er(n,e),0==n.h&&(n.src=null,t[es]=null)):X(e)}}}function eu(e){return e in eo?eo[e]:eo[e]="on"+e}function eh(e,t){if(e.fa)e=!0;else{t=new G(t,this);var n=e.listener,r=e.la||e.src;e.ia&&el(e),e=n.call(r,t)}return e}function ec(e){return(e=e[es])instanceof en?e:null}var ed="__closure_events_fn_"+(1e9*Math.random()>>>0);function ef(e){return"function"==typeof e?e:(e[ed]||(e[ed]=function(t){return e.handleEvent(t)}),e[ed])}function ep(){C.call(this),this.i=new en(this),this.S=this,this.J=null}function eg(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new A(t,e);else if(t instanceof A)t.target=t.target||e;else{var i=t;et(t=new A(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=em(o,r,!0,t)&&i}if(i=em(o=t.g=e,r,!0,t)&&i,i=em(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=em(o=t.g=n[s],r,!1,t)&&i}function em(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&er(e.i,o),i=!1!==a.call(l,r)&&i}}return i&&!r.defaultPrevented}E(ep,C),ep.prototype[W]=!0,ep.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else(i=_(i)?!!i.capture:!!i,r=ef(r),t&&t[W])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=ei(o=t.g[n],r,i,s))&&(X(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):t&&(t=ec(t))&&(n=t.g[n.toString()],t=-1,n&&(t=ei(n,r,i,s)),(r=-1<t?n[t]:null)&&el(r))}(this,e,t,n,r)},ep.prototype.N=function(){if(ep.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)X(n[r]);delete t.g[e],t.h--}}this.J=null},ep.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ep.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var ey=y.JSON.stringify;class ev{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}class e_{constructor(){this.h=this.g=null}add(e,t){let n=ew.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var ew=new ev(()=>new eb,e=>e.reset());class eb{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let eI,eT=!1,eE=new e_,eC=()=>{let e=y.Promise.resolve(void 0);eI=()=>{e.then(eS)}};var eS=()=>{for(var e;e=function(){let e=null;return eE.g&&(e=eE.g,eE.g=eE.g.next,eE.g||(eE.h=null),e.next=null),e}();){try{e.h.call(e.g)}catch(e){!function(e){y.setTimeout(()=>{throw e},0)}(e)}ew.j(e),100>ew.h&&(ew.h++,e.next=ew.g,ew.g=e)}eT=!1};function ek(e,t){ep.call(this),this.h=e||1,this.g=t||y,this.j=I(this.qb,this),this.l=Date.now()}function ex(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function eA(e,t,n){if("function"==typeof e)n&&(e=I(e,n));else if(e&&"function"==typeof e.handleEvent)e=I(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:y.setTimeout(e,t||0)}E(ek,ep),(u=ek.prototype).ga=!1,u.T=null,u.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),eg(this,"tick"),this.ga&&(ex(this),this.start()))}},u.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},u.N=function(){ek.$.N.call(this),ex(this),delete this.g};class eN extends C{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eA(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eD(e){C.call(this),this.h=e,this.g={}}E(eD,C);var eR=[];function eP(e,t,n,r){Array.isArray(n)||(n&&(eR[0]=n.toString()),n=eR);for(var i=0;i<n.length;i++){var s=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=ef(r),t&&t[W]?t.P(n,r,_(i)?!!i.capture:!!i,s):ea(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=ef(r),t&&t[W]?t.O(n,r,_(i)?!!i.capture:!!i,s):ea(t,n,r,!1,i,s)}(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function eO(e){J(e.g,function(e,t){this.g.hasOwnProperty(t)&&el(e)},e),e.g={}}function eM(){this.g=!0}function eL(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}}return ey(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eD.prototype.N=function(){eD.$.N.call(this),eO(this)},eD.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},eM.prototype.Ea=function(){this.g=!1},eM.prototype.info=function(){};var eF={},eU=null;function eV(){return eU=eU||new ep}function eq(e){A.call(this,eF.Ta,e)}function ej(e){let t=eV();eg(t,new eq(t))}function eB(e,t){A.call(this,eF.STAT_EVENT,e),this.stat=t}function ez(e){let t=eV();eg(t,new eB(t,e))}function eK(e,t){A.call(this,eF.Ua,e),this.size=t}function e$(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){e()},t)}eF.Ta="serverreachability",E(eq,A),eF.STAT_EVENT="statevent",E(eB,A),eF.Ua="timingevent",E(eK,A);var eG={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},eH={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function eW(){}function eQ(e){return e.h||(e.h=e.i())}function eY(){}eW.prototype.h=null;var eX={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function eJ(){A.call(this,"d")}function eZ(){A.call(this,"c")}function e0(){}function e1(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new eD(this),this.P=e3,e=U?125:void 0,this.V=new ek(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new e2}function e2(){this.i=null,this.g="",this.h=!1}E(eJ,A),E(eZ,A),E(e0,eW),e0.prototype.g=function(){return new XMLHttpRequest},e0.prototype.i=function(){return{}},o=new e0;var e3=45e3,e4={},e6={};function e5(e,t,n){e.L=1,e.v=tp(tu(t)),e.s=n,e.S=!0,e8(e,null)}function e8(e,t){e.G=Date.now(),te(e),e.A=tu(e.v);var n,r,i,s,o,a,l=e.A,u=e.W;Array.isArray(u)||(u=[String(u)]),tk(l.i,"t",u),e.C=0,l=e.l.J,e.h=new e2,e.g=nm(e.l,l?t:null,!e.s),0<e.O&&(e.M=new eN(I(e.Pa,e,e.g),e.O)),eP(e.U,e.g,"readystatechange",e.nb),t=e.I?Z(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),ej(),n=e.j,r=e.u,i=e.A,s=e.m,o=e.W,a=e.s,n.info(function(){if(n.g)if(a)for(var e="",t=a.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");e=2<=c.length&&"type"==c[1]?e+(h+"=")+u+"&":e+(h+"=redacted&")}}else e=null;else e=a;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+r+"\n"+i+"\n"+e})}function e9(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function e7(e,t,n){let r=!0,i;for(;!e.J&&e.C<n.length;)if((i=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?e6:isNaN(n=Number(t.substring(n,r)))?e4:(r+=1)+n>t.length?e6:(t=t.slice(r,r+n),e.C=r+n,t)}(e,n))==e6){4==t&&(e.o=4,ez(14),r=!1),eL(e.j,e.m,null,"[Incomplete Response]");break}else if(i==e4){e.o=4,ez(15),eL(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else eL(e.j,e.m,i,null),ts(e,i);e9(e)&&i!=e6&&i!=e4&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,ez(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),nl(t),t.M=!0,ez(11))):(eL(e.j,e.m,n,"[Invalid Chunked Response]"),ti(e),tr(e))}function te(e){e.Y=Date.now()+e.P,tt(e,e.P)}function tt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=e$(I(e.lb,e),t)}function tn(e){e.B&&(y.clearTimeout(e.B),e.B=null)}function tr(e){0==e.l.H||e.J||nc(e.l,e)}function ti(e){tn(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,ex(e.V),eO(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function ts(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||tO(n.i,e))){if(!e.K&&tO(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.G+3e3<e.G)nh(n),ne(n);else break e;na(n),ez(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=e$(I(n.ib,n),6e3));if(1>=tP(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else nf(n,11)}else if((e.K||n.g==e)&&nh(n),!D(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let a=i[t];if(n.V=a[0],a=a[1],2==n.H)if("c"==a[0]){n.K=a[1],n.pa=a[2];let t=a[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));let i=a[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));let l=a[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(tM(s,s.h),s.h=null))}if(r.F){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,tf(r.I,r.F,e))}}if(n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),(r=n).wa=ng(r,r.J?r.pa:null,r.Y),e.K){tL(r.i,e);var o=r.L;o&&e.setTimeout(o),e.B&&(tn(e),te(e)),r.g=e}else no(r);0<n.j.length&&nn(n)}else"stop"!=a[0]&&"close"!=a[0]||nf(n,7);else 3==n.H&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?nf(n,7):t7(n):"noop"!=a[0]&&n.h&&n.h.Aa(a),n.A=0)}}ej(4)}catch(e){}}function to(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(v(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(v(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(v(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(u=e1.prototype).setTimeout=function(e){this.P=e},u.nb=function(e){e=e.target;let t=this.M;t&&3==t3(e)?t.l():this.Pa(e)},u.Pa=function(e){try{if(e==this.g)e:{let v=t3(this.g);var t=this.g.Ia();let _=this.g.da();if(!(3>v)&&(3!=v||U||this.g&&(this.h.h||this.g.ja()||t4(this.g)))){this.J||4!=v||7==t||(8==t||0>=_?ej(3):ej(2)),tn(this);var n=this.g.da();this.ca=n;t:if(e9(this)){var r=t4(this.g);e="";var i=r.length,s=4==t3(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ti(this),tr(this);var o="";break t}this.h.i=new y.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,a=this.j,l=this.u,u=this.A,h=this.m,c=this.W,d=n,a.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+c+"]: "+l+"\n"+u+"\n"+v+" "+d}),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l,u,h,c,d,p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(p)){var m=p;break t}}m=null}if(n=m)eL(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ts(this,n);else{this.i=!1,this.o=3,ez(12),ti(this),tr(this);break e}}this.S?(e7(this,v,o),U&&this.i&&3==v&&(eP(this.U,this.V,"tick",this.mb),this.V.start())):(eL(this.j,this.m,o,null),ts(this,o)),4==v&&ti(this),this.i&&!this.J&&(4==v?nc(this.l,this):(this.i=!1,te(this)))}else(function(e){let t={};e=(e.g&&2<=t3(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(D(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,ez(12)):(this.o=0,ez(13)),ti(this),tr(this)}}}catch(e){}finally{}},u.mb=function(){if(this.g){var e=t3(this.g),t=this.g.ja();this.C<t.length&&(tn(this),e7(this,e,t),this.i&&4!=e&&te(this))}},u.cancel=function(){this.J=!0,ti(this)},u.lb=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(ej(),ez(17)),ti(this),this.o=2,tr(this)):tt(this,this.Y-n)};var ta=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tl(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof tl){this.h=e.h,th(this,e.j),this.s=e.s,this.g=e.g,tc(this,e.m),this.l=e.l;var t=e.i,n=new tT;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),td(this,n),this.o=e.o}else e&&(t=String(e).match(ta))?(this.h=!1,th(this,t[1]||"",!0),this.s=tg(t[2]||""),this.g=tg(t[3]||"",!0),tc(this,t[4]),this.l=tg(t[5]||"",!0),td(this,t[6]||"",!0),this.o=tg(t[7]||"")):(this.h=!1,this.i=new tT(null,this.h))}function tu(e){return new tl(e)}function th(e,t,n){e.j=n?tg(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tc(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function td(e,t,n){var r,i;t instanceof tT?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tE(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tC(this,t),tk(this,n,e))},r)),r.j=i):(n||(t=tm(t,tb)),e.i=new tT(t,e.h))}function tf(e,t,n){e.i.set(t,n)}function tp(e){return tf(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function tg(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tm(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ty),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ty(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tl.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tm(t,tv,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tm(t,tv,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tm(n,"/"==n.charAt(0)?tw:t_,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tm(n,tI)),e.join("")};var tv=/[#\/\?@]/g,t_=/[#\?:]/g,tw=/[#\?]/g,tb=/[#\?@]/g,tI=/#/g;function tT(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tE(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tC(e,t){tE(e),t=tx(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tS(e,t){return tE(e),t=tx(e,t),e.g.has(t)}function tk(e,t,n){tC(e,t),0<n.length&&(e.i=null,e.g.set(tx(e,t),k(n)),e.h+=n.length)}function tx(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(u=tT.prototype).add=function(e,t){tE(this),this.i=null,e=tx(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},u.forEach=function(e,t){tE(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},u.ta=function(){tE(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},u.Z=function(e){tE(this);let t=[];if("string"==typeof e)tS(this,e)&&(t=t.concat(this.g.get(tx(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},u.set=function(e,t){return tE(this),this.i=null,tS(this,e=tx(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},u.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},u.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var tA=class{constructor(e,t){this.g=e,this.map=t}};function tN(e){this.l=e||tD,e=y.PerformanceNavigationTiming?0<(e=y.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(y.g&&y.g.Ka&&y.g.Ka()&&y.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tD=10;function tR(e){return!!e.h||!!e.g&&e.g.size>=e.j}function tP(e){return e.h?1:e.g?e.g.size:0}function tO(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function tM(e,t){e.g?e.g.add(t):e.h=t}function tL(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function tF(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return k(e.i)}tN.prototype.cancel=function(){if(this.i=tF(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var tU=class{stringify(e){return y.JSON.stringify(e,void 0)}parse(e){return y.JSON.parse(e,void 0)}};function tV(){this.g=new tU}function tq(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function tj(e){this.l=e.fc||null,this.j=e.ob||!1}function tB(e,t){ep.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=tz,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}E(tj,eW),tj.prototype.g=function(){return new tB(this.l,this.j)},tj.prototype.i=(r={},function(){return r}),E(tB,ep);var tz=0;function tK(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function t$(e){e.readyState=4,e.l=null,e.j=null,e.A=null,tG(e)}function tG(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(u=tB.prototype).open=function(e,t){if(this.readyState!=tz)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,tG(this)},u.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||y).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},u.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,t$(this)),this.readyState=tz},u.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tG(this)),this.g&&(this.readyState=3,tG(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==y.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;tK(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},u.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?t$(this):tG(this),3==this.readyState&&tK(this)}},u.Za=function(e){this.g&&(this.response=this.responseText=e,t$(this))},u.Ya=function(e){this.g&&(this.response=e,t$(this))},u.ka=function(){this.g&&t$(this)},u.setRequestHeader=function(e,t){this.v.append(e,t)},u.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},u.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tB.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var tH=y.JSON.parse;function tW(e){ep.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=tQ,this.L=this.M=!1}E(tW,ep);var tQ="",tY=/^https?$/i,tX=["POST","PUT"];function tJ(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,tZ(e),t1(e)}function tZ(e){e.F||(e.F=!0,eg(e,"complete"),eg(e,"error"))}function t0(e){if(e.h&&void 0!==m&&(!e.C[1]||4!=t3(e)||2!=e.da())){if(e.v&&4==t3(e))eA(e.La,0,e);else if(eg(e,"readystatechange"),4==t3(e)){e.h=!1;try{let o=e.da();switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===o){var i=String(e.I).match(ta)[1]||null;!i&&y.self&&y.self.location&&(i=y.self.location.protocol.slice(0,-1)),n=!tY.test(i?i.toLowerCase():"")}t=n}if(t)eg(e,"complete"),eg(e,"success");else{e.m=6;try{var s=2<t3(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",tZ(e)}}finally{t1(e)}}}}function t1(e,t){if(e.g){t2(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||eg(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function t2(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(y.clearTimeout(e.A),e.A=null)}function t3(e){return e.g?e.g.readyState:0}function t4(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case tQ:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function t6(e){let t="";return J(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function t5(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=t6(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tf(e,t,n))}function t8(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function t9(e){this.Ga=0,this.j=[],this.l=new eM,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=t8("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=t8("baseRetryDelayMs",5e3,e),this.hb=t8("retryDelaySeedMs",1e4,e),this.eb=t8("forwardChannelMaxRetries",2,e),this.xa=t8("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new tN(e&&e.concurrentRequestLimit),this.Ja=new tV,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function t7(e){if(nt(e),3==e.H){var t=e.W++,n=tu(e.I);if(tf(n,"SID",e.K),tf(n,"RID",t),tf(n,"TYPE","terminate"),ni(e,n),(t=new e1(e,e.l,t)).L=2,t.v=tp(tu(n)),n=!1,y.navigator&&y.navigator.sendBeacon)try{n=y.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&y.Image&&((new Image).src=t.v,n=!0),n||(t.g=nm(t.l,null),t.g.ha(t.v)),t.G=Date.now(),te(t)}np(e)}function ne(e){e.g&&(nl(e),e.g.cancel(),e.g=null)}function nt(e){ne(e),e.u&&(y.clearTimeout(e.u),e.u=null),nh(e),e.i.cancel(),e.m&&("number"==typeof e.m&&y.clearTimeout(e.m),e.m=null)}function nn(e){if(!tR(e.i)&&!e.m){e.m=!0;var t=e.Na;eI||eC(),eT||(eI(),eT=!0),eE.add(t,e),e.C=0}}function nr(e,t){var n;n=t?t.m:e.W++;let r=tu(e.I);tf(r,"SID",e.K),tf(r,"RID",n),tf(r,"AID",e.V),ni(e,r),e.o&&e.s&&t5(r,e.o,e.s),n=new e1(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=ns(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),tM(e.i,n),e5(n,r,t)}function ni(e,t){e.na&&J(e.na,function(e,n){tf(t,n,e)}),e.h&&to({},function(e,n){tf(t,n,e)})}function ns(e,t,n){n=Math.min(e.j.length,n);var r=e.h?I(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g,a=i[o].map;if(0>(n-=t))t=Math.max(0,i[o].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{to(e,function(e,n){let i=e;_(e)&&(i=ey(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return t.F=e=e.j.splice(0,n),r}function no(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;eI||eC(),eT||(eI(),eT=!0),eE.add(t,e),e.A=0}}function na(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.ba++,e.u=e$(I(e.Ma,e),nd(e,e.A)),e.A++,!0)}function nl(e){null!=e.B&&(y.clearTimeout(e.B),e.B=null)}function nu(e){e.g=new e1(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=tu(e.wa);tf(t,"RID","rpc"),tf(t,"SID",e.K),tf(t,"AID",e.V),tf(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&tf(t,"TO",e.qa),tf(t,"TYPE","xmlhttp"),ni(e,t),e.o&&e.s&&t5(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=tp(tu(t)),n.s=null,n.S=!0,e8(n,e)}function nh(e){null!=e.v&&(y.clearTimeout(e.v),e.v=null)}function nc(e,t){var n,r=null;if(e.g==t){nh(e),nl(e),e.g=null;var i=2}else{if(!tO(e.i,t))return;r=t.F,tL(e.i,t),i=1}if(0!=e.H){if(t.i)if(1==i){r=t.s?t.s.length:0,t=Date.now()-t.G;var s=e.C;eg(i=eV(),new eK(i,r)),nn(e)}else no(e);else if(3==(s=t.o)||0==s&&0<t.ca||!(1==i&&(n=t,!(tP(e.i)>=e.i.j-!!e.m)&&(e.m?(e.j=n.F.concat(e.j),!0):1!=e.H&&2!=e.H&&!(e.C>=(e.cb?0:e.eb))&&(e.m=e$(I(e.Na,e,n),nd(e,e.C)),e.C++,!0)))||2==i&&na(e)))switch(r&&0<r.length&&((t=e.i).i=t.i.concat(r)),s){case 1:nf(e,5);break;case 4:nf(e,10);break;case 3:nf(e,6);break;default:nf(e,2)}}}function nd(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function nf(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=I(e.pb,e);n||(n=new tl("//www.google.com/images/cleardot.gif"),y.location&&"http"==y.location.protocol||th(n,"https"),tp(n));var i=n.toString();let t=new eM;if(y.Image){let e=new Image;e.onload=T(tq,t,e,"TestLoadImage: loaded",!0,r),e.onerror=T(tq,t,e,"TestLoadImage: error",!1,r),e.onabort=T(tq,t,e,"TestLoadImage: abort",!1,r),e.ontimeout=T(tq,t,e,"TestLoadImage: timeout",!1,r),y.setTimeout(function(){e.ontimeout&&e.ontimeout()},1e4),e.src=i}else r(!1)}else ez(2);e.H=0,e.h&&e.h.za(t),np(e),nt(e)}function np(e){if(e.H=0,e.ma=[],e.h){let t=tF(e.i);(0!=t.length||0!=e.j.length)&&(x(e.ma,t),x(e.ma,e.j),e.i.i.length=0,k(e.j),e.j.length=0),e.h.ya()}}function ng(e,t,n){var r=n instanceof tl?tu(n):new tl(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tc(r,r.m);else{var i=y.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new tl(null);r&&th(s,r),t&&(s.g=t),i&&tc(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&tf(r,n,t),tf(r,"VER",e.ra),ni(e,r),r}function nm(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tW(n&&e.Ha&&!e.va?new tj({ob:!0}):e.va)).Oa(e.J),t}function ny(){}function nv(){if(L&&!(10<=Number($)))throw Error("Environmental error: no available transport.")}function n_(e,t){ep.call(this),this.g=new t9(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!D(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!D(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nI(this)}function nw(e){eJ.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nb(){eZ.call(this),this.status=1}function nI(e){this.g=e}function nT(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function nE(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+0xd76aa478|0;o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[1]+0xe8c7b756|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[2]+0x242070db|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[3]+0xc1bdceee|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[4]+0xf57c0faf|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[5]+0x4787c62a|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[6]+0xa8304613|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[7]+0xfd469501|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[8]+0x698098d8|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[9]+0x8b44f7af|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[10]+0xffff5bb1|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[11]+0x895cd7be|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[12]+0x6b901122|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[13]+0xfd987193|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[14]+0xa679438e|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(o<<22|o>>>10),o=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,o=t+((n=i+(o<<20|o>>>12))^i^s)+r[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[8]+0x8771f681|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[11]+0x6d9d6122|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[14]+0xfde5380c|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[4]+0x4bdecfa9|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[7]+0xf6bb4b60|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[10]+0xbebfbc70|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[0]+0xeaa127fa|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[3]+0xd4ef3085|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[6]+0x4881d05|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[12]+0xe6db99e5|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[15]+0x1fa27cf8|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(o<<23|o>>>9),o=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function nC(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(u=tW.prototype).Oa=function(e){this.M=e},u.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():o.g(),this.C=this.u?eQ(this.u):eQ(o),this.g.onreadystatechange=I(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){tJ(this,e);return}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())n.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r));for(let[s,o]of(r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=y.FormData&&e instanceof y.FormData,!(0<=S(tX,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{var s;t2(this),0<this.B&&((this.L=(s=this.g,L&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=I(this.ua,this)):this.A=eA(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){tJ(this,e)}},u.ua=function(){void 0!==m&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,eg(this,"timeout"),this.abort(8))},u.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,eg(this,"complete"),eg(this,"abort"),t1(this))},u.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),t1(this,!0)),tW.$.N.call(this)},u.La=function(){this.s||(this.G||this.v||this.l?t0(this):this.kb())},u.kb=function(){t0(this)},u.isActive=function(){return!!this.g},u.da=function(){try{return 2<t3(this)?this.g.status:-1}catch(e){return -1}},u.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},u.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),tH(t)}},u.Ia=function(){return this.m},u.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(u=t9.prototype).ra=8,u.H=1,u.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new e1(this,this.l,e),s=this.s;if(this.U&&(s?et(s=Z(s),this.U):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ns(this,i,t),tf(n=tu(this.I),"RID",e),tf(n,"CVER",22),this.F&&tf(n,"X-HTTP-Session-Id",this.F),ni(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(t6(s)))+"&"+t:this.o&&t5(n,this.o,s)),tM(this.i,i),this.bb&&tf(n,"TYPE","init"),this.P?(tf(n,"$req",t),tf(n,"SID","null"),i.aa=!0,e5(i,n,null)):e5(i,n,t),this.H=2}}else 3==this.H&&(e?nr(this,e):0==this.j.length||tR(this.i)||nr(this))},u.Ma=function(){if(this.u=null,nu(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=e$(I(this.jb,this),e)}},u.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ez(10),ne(this),nu(this))},u.ib=function(){null!=this.v&&(this.v=null,ne(this),na(this),ez(19))},u.pb=function(e){e?(this.l.info("Successfully pinged google.com"),ez(2)):(this.l.info("Failed to ping google.com"),ez(1))},u.isActive=function(){return!!this.h&&this.h.isActive(this)},(u=ny.prototype).Ba=function(){},u.Aa=function(){},u.za=function(){},u.ya=function(){},u.isActive=function(){return!0},u.Va=function(){},nv.prototype.g=function(e,t){return new n_(e,t)},E(n_,ep),n_.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;ez(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=ng(e,null,e.Y),nn(e)},n_.prototype.close=function(){t7(this.g)},n_.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ey(e),e=n);t.j.push(new tA(t.fb++,e)),3==t.H&&nn(t)},n_.prototype.N=function(){this.g.h=null,delete this.j,t7(this.g),delete this.g,n_.$.N.call(this)},E(nw,eJ),E(nb,eZ),E(nI,ny),nI.prototype.Ba=function(){eg(this.g,"a")},nI.prototype.Aa=function(e){eg(this.g,new nw(e))},nI.prototype.za=function(e){eg(this.g,new nb)},nI.prototype.ya=function(){eg(this.g,"b")},E(nT,function(){this.blockSize=-1}),nT.prototype.reset=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.i=this.h=0},nT.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)nE(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){nE(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){nE(this,r),i=0;break}}this.h=i,this.i+=t},nT.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var nS={};function nk(e){var t;return -128<=e&&128>e?(t=function(e){return new nC([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(nS,e)?nS[e]:nS[e]=t(e)):new nC([0|e],0>e?-1:0)}function nx(e){if(isNaN(e)||!isFinite(e))return nN;if(0>e)return nM(nx(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=nA;return new nC(t,0)}var nA=0x100000000,nN=nk(0),nD=nk(1),nR=nk(0x1000000);function nP(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function nO(e){return -1==e.h}function nM(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new nC(n,~e.h).add(nD)}function nL(e,t){return e.add(nM(t))}function nF(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function nU(e,t){this.g=e,this.h=t}function nV(e,t){if(nP(t))throw Error("division by zero");if(nP(e))return new nU(nN,nN);if(nO(e))return t=nV(nM(e),t),new nU(nM(t.g),nM(t.h));if(nO(t))return t=nV(e,nM(t)),new nU(nM(t.g),t.h);if(30<e.g.length){if(nO(e)||nO(t))throw Error("slowDivide_ only works with positive integers.");for(var n=nD,r=t;0>=r.X(e);)n=nq(n),r=nq(r);var i=nj(n,1),s=nj(r,1);for(r=nj(r,2),n=nj(n,2);!nP(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=nj(r,1),n=nj(n,1)}return t=nL(e,i.R(t)),new nU(i,t)}for(i=nN;0<=e.X(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,r-48),o=(s=nx(n)).R(t);nO(o)||0<o.X(e);)n-=r,o=(s=nx(n)).R(t);nP(s)&&(s=nD),i=i.add(s),e=nL(e,o)}return new nU(i,e)}function nq(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new nC(n,e.h)}function nj(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new nC(i,e.h)}(u=nC.prototype).ea=function(){if(nO(this))return-nM(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:nA+r)*t,t*=nA}return e},u.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(nP(this))return"0";if(nO(this))return"-"+nM(this).toString(e);for(var t=nx(Math.pow(e,6)),n=this,r="";;){var i=nV(n,t).g,s=((0<(n=nL(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(nP(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},u.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},u.X=function(e){return nO(e=nL(this,e))?-1:+!nP(e)},u.abs=function(){return nO(this)?nM(this):this},u.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new nC(n,-0x80000000&n[n.length-1]?-1:0)},u.R=function(e){if(nP(this)||nP(e))return nN;if(nO(this))return nO(e)?nM(this).R(nM(e)):nM(nM(this).R(e));if(nO(e))return nM(this.R(nM(e)));if(0>this.X(nR)&&0>e.X(nR))return nx(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,l=65535&e.D(i);n[2*r+2*i]+=o*l,nF(n,2*r+2*i),n[2*r+2*i+1]+=s*l,nF(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,nF(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,nF(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new nC(n,0)},u.gb=function(e){return nV(this,e).h},u.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new nC(n,this.h&e.h)},u.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new nC(n,this.h|e.h)},u.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new nC(n,this.h^e.h)},nv.prototype.createWebChannel=nv.prototype.g,n_.prototype.send=n_.prototype.u,n_.prototype.open=n_.prototype.m,n_.prototype.close=n_.prototype.close,eG.NO_ERROR=0,eG.TIMEOUT=8,eG.HTTP_ERROR=6,eH.COMPLETE="complete",eY.EventType=eX,eX.OPEN="a",eX.CLOSE="b",eX.ERROR="c",eX.MESSAGE="d",ep.prototype.listen=ep.prototype.O,tW.prototype.listenOnce=tW.prototype.P,tW.prototype.getLastError=tW.prototype.Sa,tW.prototype.getLastErrorCode=tW.prototype.Ia,tW.prototype.getStatus=tW.prototype.da,tW.prototype.getResponseJson=tW.prototype.Wa,tW.prototype.getResponseText=tW.prototype.ja,tW.prototype.send=tW.prototype.ha,tW.prototype.setWithCredentials=tW.prototype.Oa,nT.prototype.digest=nT.prototype.l,nT.prototype.reset=nT.prototype.reset,nT.prototype.update=nT.prototype.j,nC.prototype.add=nC.prototype.add,nC.prototype.multiply=nC.prototype.R,nC.prototype.modulo=nC.prototype.gb,nC.prototype.compare=nC.prototype.X,nC.prototype.toNumber=nC.prototype.ea,nC.prototype.toString=nC.prototype.toString,nC.prototype.getBits=nC.prototype.D,nC.fromNumber=nx,nC.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return nM(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=nx(Math.pow(n,8)),i=nN,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=nx(Math.pow(n,o)),i=i.R(o).add(nx(a))):i=(i=i.R(r)).add(nx(a))}return i};var nB=g.createWebChannelTransport=function(){return new nv},nz=g.getStatEventTarget=function(){return eV()},nK=g.ErrorCode=eG,n$=g.EventType=eH,nG=g.Event=eF,nH=g.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},nW=g.FetchXmlHttpFactory=tj,nQ=g.WebChannel=eY,nY=g.XhrIo=tW,nX=g.Md5=nT,nJ=g.Integer=nC,nZ=n(5364);let n0="@firebase/firestore";class n1{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}n1.UNAUTHENTICATED=new n1(null),n1.GOOGLE_CREDENTIALS=new n1("google-credentials-uid"),n1.FIRST_PARTY=new n1("first-party-uid"),n1.MOCK_USER=new n1("mock-user");let n2="9.23.0",n3=new d.Vy("@firebase/firestore");function n4(){return n3.logLevel}function n6(e,...t){if(n3.logLevel<=d.$b.DEBUG){let n=t.map(n9);n3.debug(`Firestore (${n2}): ${e}`,...n)}}function n5(e,...t){if(n3.logLevel<=d.$b.ERROR){let n=t.map(n9);n3.error(`Firestore (${n2}): ${e}`,...n)}}function n8(e,...t){if(n3.logLevel<=d.$b.WARN){let n=t.map(n9);n3.warn(`Firestore (${n2}): ${e}`,...n)}}function n9(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function n7(e="Unexpected state"){let t=`FIRESTORE (${n2}) INTERNAL ASSERTION FAILED: `+e;throw n5(t),Error(t)}let re={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rt extends p.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class rn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ri{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(n1.UNAUTHENTICATED))}shutdown(){}}class rs{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ro{constructor(e){this.t=e,this.currentUser=n1.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new rn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new rn,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{n6("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(n6("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rn)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(n6("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||n7(),new rr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||n7(),new n1(e)}}class ra{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=n1.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);let e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class rl{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new ra(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(n1.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ru{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rh{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){let n=e=>{null!=e.error&&n6("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.T;return this.T=e.token,n6("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{n6("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.I.getImmediate({optional:!0});e?r(e):n6("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||n7(),this.T=e.token,new ru(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class rc{static A(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function rd(e,t){return e<t?-1:+(e>t)}function rf(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class rp{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rt(re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new rt(re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return rp.fromMillis(Date.now())}static fromDate(e){return rp.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new rp(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?rd(this.nanoseconds,e.nanoseconds):rd(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rg{constructor(e){this.timestamp=e}static fromTimestamp(e){return new rg(e)}static min(){return new rg(new rp(0,0))}static max(){return new rg(new rp(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class rm{constructor(e,t,n){void 0===t?t=0:t>e.length&&n7(),void 0===n?n=e.length-t:n>e.length-t&&n7(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===rm.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rm?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:+(e.length>t.length)}}class ry extends rm{construct(e,t,n){return new ry(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new rt(re.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new ry(t)}static emptyPath(){return new ry([])}}let rv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class r_ extends rm{construct(e,t,n){return new r_(e,t,n)}static isValidIdentifier(e){return rv.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r_.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new r_(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new rt(re.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new rt(re.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rt(re.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new rt(re.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r_(t)}static emptyPath(){return new r_([])}}class rw{constructor(e){this.path=e}static fromPath(e){return new rw(ry.fromString(e))}static fromName(e){return new rw(ry.fromString(e).popFirst(5))}static empty(){return new rw(ry.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ry.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ry.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rw(new ry(e.slice()))}}class rb{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function rI(e){return e.fields.find(e=>2===e.kind)}function rT(e){return e.fields.filter(e=>2!==e.kind)}rb.UNKNOWN_ID=-1;class rE{constructor(e,t){this.fieldPath=e,this.kind=t}}class rC{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rC(0,rx.min())}}function rS(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new rx(rg.fromTimestamp(1e9===r?new rp(n+1,0):new rp(n,r)),rw.empty(),t)}function rk(e){return new rx(e.readTime,e.key,-1)}class rx{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new rx(rg.min(),rw.empty(),-1)}static max(){return new rx(rg.max(),rw.empty(),-1)}}function rA(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=rw.comparator(e.documentKey,t.documentKey))?n:rd(e.largestBatchId,t.largestBatchId)}let rN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rD{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rR(e){if(e.code!==re.FAILED_PRECONDITION||e.message!==rN)throw e;n6("LocalStore","Unexpectedly lost primary lease")}class rP{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&n7(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rP((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rP?t:rP.resolve(t)}catch(e){return rP.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rP.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rP.reject(t)}static resolve(e){return new rP((t,n)=>{t(e)})}static reject(e){return new rP((t,n)=>{n(e)})}static waitFor(e){return new rP((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=rP.resolve(!1);for(let n of e)t=t.next(e=>e?rP.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new rP((n,r)=>{let i=e.length,s=Array(i),o=0;for(let a=0;a<i;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new rP((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class rO{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new rn,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new rF(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{let n=rB(t.target.error);this.v.reject(new rF(e,n))}}static open(e,t,n,r){try{return new rO(t,e.transaction(r,n))}catch(e){throw new rF(t,e)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(n6("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new rV(this.transaction.objectStore(e))}}class rM{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===rM.S((0,p.ZQ)())&&n5("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return n6("SimpleDb","Removing database:",e),rq(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,p.zW)())return!1;if(rM.C())return!0;let e=(0,p.ZQ)(),t=rM.S(e),n=rM.N(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static C(){var e;return void 0!==nZ&&"YES"===(null==(e=nZ.env)?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}static N(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}async $(e){return this.db||(n6("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new rF(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new rt(re.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new rt(re.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new rF(e,r))},r.onupgradeneeded=e=>{n6("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.V.O(t,r.transaction,e.oldVersion,this.version).next(()=>{n6("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.$(e);let t=rO.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.P(),e)).catch(e=>(t.abort(e),rP.reject(e))).toPromise();return s.catch(()=>{}),await t.R,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(n6("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class rL{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return rq(this.L.delete())}}class rF extends rt{constructor(e,t){super(re.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rU(e){return"IndexedDbTransactionError"===e.name}class rV{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(n6("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(n6("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),rq(n)}add(e){return n6("SimpleDb","ADD",this.store.name,e,e),rq(this.store.add(e))}get(e){return rq(this.store.get(e)).next(t=>(void 0===t&&(t=null),n6("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return n6("SimpleDb","DELETE",this.store.name,e),rq(this.store.delete(e))}count(){return n6("SimpleDb","COUNT",this.store.name),rq(this.store.count())}j(e,t){let n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){let e=this.cursor(n),t=[];return this.W(e,(e,n)=>{t.push(n)}).next(()=>t)}{let e=this.store.getAll(n.range);return new rP((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}H(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new rP((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}J(e,t){n6("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.Y=!1;let r=this.cursor(n);return this.W(r,(e,t,n)=>n.delete())}X(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.W(r,t)}Z(e){let t=this.cursor({});return new rP((n,r)=>{t.onerror=e=>{r(rB(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}W(e,t){let n=[];return new rP((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new rL(i),o=t(i.primaryKey,i.value,s);if(o instanceof rP){let e=o.catch(e=>(s.done(),rP.reject(e)));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}}).next(()=>rP.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rq(e){return new rP((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(rB(e.target.error))}})}let rj=!1;function rB(e){let t=rM.S((0,p.ZQ)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new rt("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return rj||(rj=!0,setTimeout(()=>{throw e},0)),e}}return e}class rz{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){n6("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{n6("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){rU(e)?n6("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await rR(e)}await this.et(6e4)})}}class rK{constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.st(t,e))}st(e,t){let n=new Set,r=t,i=!0;return rP.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return n6("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.rt(r,n)).next(n=>(n6("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}rt(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=rk(t);rA(r,n)>0&&(n=r)}),new rx(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class r${constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ut&&this.ut(e),e}}function rG(e){return null==e}function rH(e){return 0===e&&1/e==-1/0}function rW(e){return"number"==typeof e&&Number.isInteger(e)&&!rH(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function rQ(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}r$.ct=-1;function rY(e){let t=e.length;if(t>=2||n7(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||n7(),ry.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&n7(),e.charAt(t+1)){case"\x01":let o,a=e.substring(s,t);0===i.length?o=a:(i+=a,o=i,i=""),r.push(o);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:n7()}s=t+2}return new ry(r)}let rX=["userId","batchId"],rJ={},rZ=["prefixPath","collectionGroup","readTime","documentId"],r0=["prefixPath","collectionGroup","documentId"],r1=["collectionGroup","readTime","prefixPath","documentId"],r2=["canonicalId","targetId"],r3=["targetId","path"],r4=["path","targetId"],r6=["collectionId","parent"],r5=["indexId","uid"],r8=["uid","sequenceNumber"],r9=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],r7=["indexId","uid","orderedDocumentKey"],ie=["userId","collectionPath","documentId"],it=["userId","collectionPath","largestBatchId"],ir=["userId","collectionGroup","largestBatchId"],ii=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],is=[...ii,"documentOverlays"],io=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ia=[...io,"indexConfiguration","indexState","indexEntries"];class il extends rD{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function iu(e,t){return rM.M(e.ht,t)}function ih(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ic(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function id(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class ip{constructor(e,t){this.comparator=e,this.root=t||im.EMPTY}insert(e,t){return new ip(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,im.BLACK,null,null))}remove(e){return new ip(this.comparator,this.root.remove(e,this.comparator).copy(null,null,im.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ig(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ig(this.root,e,this.comparator,!1)}getReverseIterator(){return new ig(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ig(this.root,e,this.comparator,!0)}}class ig{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class im{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:im.RED,this.left=null!=r?r:im.EMPTY,this.right=null!=i?i:im.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new im(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return im.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return im.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,im.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,im.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw n7();let e=this.left.check();if(e!==this.right.check())throw n7();return e+ +!this.isRed()}}im.EMPTY=null,im.RED=!0,im.BLACK=!1,im.EMPTY=new class{constructor(){this.size=0}get key(){throw n7()}get value(){throw n7()}get color(){throw n7()}get left(){throw n7()}get right(){throw n7()}copy(e,t,n,r,i){return this}insert(e,t,n){return new im(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class iy{constructor(e){this.comparator=e,this.data=new ip(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iv(this.data.getIterator())}getIteratorFrom(e){return new iv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof iy)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new iy(this.comparator);return t.data=e,t}}class iv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function i_(e){return e.hasNext()?e.getNext():void 0}class iw{constructor(e){this.fields=e,e.sort(r_.comparator)}static empty(){return new iw([])}unionWith(e){let t=new iy(r_.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new iw(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rf(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ib extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class iI{constructor(e){this.binaryString=e}static fromBase64String(e){return new iI(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ib("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new iI(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rd(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}iI.EMPTY_BYTE_STRING=new iI("");let iT=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function iE(e){if(e||n7(),"string"==typeof e){let t=0,n=iT.exec(e);if(n||n7(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:iC(e.seconds),nanos:iC(e.nanos)}}function iC(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function iS(e){return"string"==typeof e?iI.fromBase64String(e):iI.fromUint8Array(e)}function ik(e){var t,n;return"server_timestamp"===(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{}).__type__)?void 0:n.stringValue)}function ix(e){let t=e.mapValue.fields.__previous_value__;return ik(t)?ix(t):t}function iA(e){let t=iE(e.mapValue.fields.__local_write_time__.timestampValue);return new rp(t.seconds,t.nanos)}class iN{constructor(e,t,n,r,i,s,o,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l}}class iD{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new iD("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof iD&&e.projectId===this.projectId&&e.database===this.database}}let iR={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},iP={nullValue:"NULL_VALUE"};function iO(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ik(e)?4:iH(e)?0x1fffffffffffff:10:n7()}function iM(e,t){if(e===t)return!0;let n=iO(e);if(n!==iO(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return iA(e).isEqual(iA(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=iE(e.timestampValue),i=iE(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return iS(e.bytesValue).isEqual(iS(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return iC(e.geoPointValue.latitude)===iC(t.geoPointValue.latitude)&&iC(e.geoPointValue.longitude)===iC(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return iC(e.integerValue)===iC(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=iC(e.doubleValue),r=iC(t.doubleValue);return n===r?rH(n)===rH(r):isNaN(n)&&isNaN(r)}return!1;case 9:return rf(e.arrayValue.values||[],t.arrayValue.values||[],iM);case 10:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(ih(s)!==ih(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!iM(s[e],o[e])))return!1;return!0;default:return n7()}}function iL(e,t){return void 0!==(e.values||[]).find(e=>iM(e,t))}function iF(e,t){if(e===t)return 0;let n=iO(e),r=iO(t);if(n!==r)return rd(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return rd(e.booleanValue,t.booleanValue);case 2:let i=iC(e.integerValue||e.doubleValue),s=iC(t.integerValue||t.doubleValue);return i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return iU(e.timestampValue,t.timestampValue);case 4:return iU(iA(e),iA(t));case 5:return rd(e.stringValue,t.stringValue);case 6:return function(e,t){let n=iS(e),r=iS(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=rd(n[e],r[e]);if(0!==t)return t}return rd(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=rd(iC(e.latitude),iC(t.latitude));return 0!==n?n:rd(iC(e.longitude),iC(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=iF(n[e],r[e]);if(t)return t}return rd(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===iR.mapValue&&t===iR.mapValue)return 0;if(e===iR.mapValue)return 1;if(t===iR.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=rd(r[e],s[e]);if(0!==t)return t;let o=iF(n[r[e]],i[s[e]]);if(0!==o)return o}return rd(r.length,s.length)}(e.mapValue,t.mapValue);default:throw n7()}}function iU(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rd(e,t);let n=iE(e),r=iE(t),i=rd(n.seconds,r.seconds);return 0!==i?i:rd(n.nanos,r.nanos)}function iV(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=iE(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?iS(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,rw.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=iV(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${iV(e.fields[i])}`;return n+"}"}(e.mapValue):n7()}function iq(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ij(e){return!!e&&"integerValue"in e}function iB(e){return!!e&&"arrayValue"in e}function iz(e){return!!e&&"nullValue"in e}function iK(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function i$(e){return!!e&&"mapValue"in e}function iG(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return ic(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=iG(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=iG(e.arrayValue.values[n]);return t}return Object.assign({},e)}function iH(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function iW(e,t){let n=iF(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function iQ(e,t){let n=iF(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class iY{constructor(e){this.value=e}static empty(){return new iY({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!i$(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=iG(t)}setAll(e){let t=r_.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=iG(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());i$(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return iM(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];i$(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(ic(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new iY(iG(this.value))}}class iX{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new iX(e,0,rg.min(),rg.min(),rg.min(),iY.empty(),0)}static newFoundDocument(e,t,n,r){return new iX(e,1,t,rg.min(),n,r,0)}static newNoDocument(e,t){return new iX(e,2,t,rg.min(),rg.min(),iY.empty(),0)}static newUnknownDocument(e,t){return new iX(e,3,t,rg.min(),rg.min(),iY.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rg.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=iY.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=iY.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rg.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof iX&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new iX(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class iJ{constructor(e,t){this.position=e,this.inclusive=t}}function iZ(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(r=s.field.isKeyField()?rw.comparator(rw.fromName(o.referenceValue),n.key):iF(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function i0(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!iM(e.position[n],t.position[n]))return!1;return!0}class i1{constructor(e,t="asc"){this.field=e,this.dir=t}}class i2{}class i3 extends i2{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new se(e,t,n):"array-contains"===t?new si(e,n):"in"===t?new ss(e,n):"not-in"===t?new so(e,n):"array-contains-any"===t?new sa(e,n):new i3(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new st(e,n):new sn(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(iF(t,this.value)):null!==t&&iO(this.value)===iO(t)&&this.matchesComparison(iF(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return n7()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class i4 extends i2{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new i4(e,t)}matches(e){return i6(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){let e=this.ft(e=>e.isInequality());return null!==e?e.field:null}ft(e){for(let t of this.getFlattenedFilters())if(e(t))return t;return null}}function i6(e){return"and"===e.op}function i5(e){return"or"===e.op}function i8(e){return i9(e)&&i6(e)}function i9(e){for(let t of e.filters)if(t instanceof i4)return!1;return!0}function i7(e,t){let n=e.filters.concat(t);return i4.create(n,e.op)}class se extends i3{constructor(e,t,n){super(e,t,n),this.key=rw.fromName(n.referenceValue)}matches(e){let t=rw.comparator(e.key,this.key);return this.matchesComparison(t)}}class st extends i3{constructor(e,t){super(e,"in",t),this.keys=sr("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class sn extends i3{constructor(e,t){super(e,"not-in",t),this.keys=sr("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function sr(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>rw.fromName(e.referenceValue))}class si extends i3{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return iB(t)&&iL(t.arrayValue,this.value)}}class ss extends i3{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&iL(this.value.arrayValue,t)}}class so extends i3{constructor(e,t){super(e,"not-in",t)}matches(e){if(iL(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!iL(this.value.arrayValue,t)}}class sa extends i3{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!iB(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>iL(this.value.arrayValue,e))}}class sl{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.dt=null}}function su(e,t=null,n=[],r=[],i=null,s=null,o=null){return new sl(e,t,n,r,i,s,o)}function sh(e){if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof i3)return t.field.canonicalString()+t.op.toString()+iV(t.value);if(i8(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),rG(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>iV(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>iV(e)).join(",")),e.dt=t}return e.dt}function sc(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof i3?n instanceof i3&&t.op===n.op&&t.field.isEqual(n.field)&&iM(t.value,n.value):t instanceof i4?n instanceof i4&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void n7()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!i0(e.startAt,t.startAt)&&i0(e.endAt,t.endAt)}function sd(e){return rw.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function sf(e,t){return e.filters.filter(e=>e instanceof i3&&e.field.isEqual(t))}function sp(e,t,n){let r=iP,i=!0;for(let n of sf(e,t)){let e=iP,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?iP:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?iq(iD.empty(),rw.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?{mapValue:{}}:n7();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=iP}0>iW({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>iW({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function sg(e,t,n){let r=iR,i=!0;for(let n of sf(e,t)){let e=iR,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?iq(iD.empty(),rw.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?{mapValue:{}}:"mapValue"in s?iR:n7(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=iR}iQ({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];iQ({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class sm{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function sy(e){return new sm(e)}function sv(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function s_(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function sw(e){for(let t of e.filters){let e=t.getFirstInequalityField();if(null!==e)return e}return null}function sb(e){return null!==e.collectionGroup}function sI(e){if(null===e.wt){e.wt=[];let t=sw(e),n=s_(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new i1(t)),e.wt.push(new i1(r_.keyField(),"asc"));else{let t=!1;for(let n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){let t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new i1(r_.keyField(),t))}}}return e.wt}function sT(e){if(!e._t)if("F"===e.limitType)e._t=su(e.path,e.collectionGroup,sI(e),e.filters,e.limit,e.startAt,e.endAt);else{let t=[];for(let n of sI(e)){let e="desc"===n.dir?"asc":"desc";t.push(new i1(n.field,e))}let n=e.endAt?new iJ(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new iJ(e.startAt.position,e.startAt.inclusive):null;e._t=su(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e._t}function sE(e,t){t.getFirstInequalityField(),sw(e);let n=e.filters.concat([t]);return new sm(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function sC(e,t,n){return new sm(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function sS(e,t){return sc(sT(e),sT(t))&&e.limitType===t.limitType}function sk(e){return`${sh(sT(e))}|lt:${e.limitType}`}function sx(e){var t;let n;return`Query(target=${n=(t=sT(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof i3?`${t.field.canonicalString()} ${t.op} ${iV(t.value)}`:t instanceof i4?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),rG(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>iV(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>iV(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function sA(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):rw.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of sI(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=iZ(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,sI(e),t))&&(!e.endAt||!!function(e,t,n){let r=iZ(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,sI(e),t))}function sN(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function sD(e){return(t,n)=>{let r=!1;for(let i of sI(e)){let e=function(e,t,n){let r=e.field.isKeyField()?rw.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?iF(r,i):n7()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return n7()}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class sR{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ic(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return id(this.inner)}size(){return this.innerSize}}let sP=new ip(rw.comparator),sO=new ip(rw.comparator);function sM(...e){let t=sO;for(let n of e)t=t.insert(n.key,n);return t}function sL(e){let t=sO;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function sF(){return new sR(e=>e.toString(),(e,t)=>e.isEqual(t))}let sU=new ip(rw.comparator),sV=new iy(rw.comparator);function sq(...e){let t=sV;for(let n of e)t=t.add(n);return t}let sj=new iy(rd);function sB(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rH(t)?"-0":t}}function sz(e){return{integerValue:""+e}}function sK(e,t){return rW(t)?sz(t):sB(e,t)}class s${constructor(){this._=void 0}}function sG(e,t){return e instanceof sJ?ij(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class sH extends s${}class sW extends s${constructor(e){super(),this.elements=e}}function sQ(e,t){let n=s0(t);for(let t of e.elements)n.some(e=>iM(e,t))||n.push(t);return{arrayValue:{values:n}}}class sY extends s${constructor(e){super(),this.elements=e}}function sX(e,t){let n=s0(t);for(let t of e.elements)n=n.filter(e=>!iM(e,t));return{arrayValue:{values:n}}}class sJ extends s${constructor(e,t){super(),this.serializer=e,this.gt=t}}function sZ(e){return iC(e.integerValue||e.doubleValue)}function s0(e){return iB(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class s1{constructor(e,t){this.field=e,this.transform=t}}class s2{constructor(e,t){this.version=e,this.transformResults=t}}class s3{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new s3}static exists(e){return new s3(void 0,e)}static updateTime(e){return new s3(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function s4(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class s6{}function s5(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new oi(e.key,s3.none()):new s7(e.key,e.data,s3.none());{let n=e.data,r=iY.empty(),i=new iy(r_.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new oe(e.key,r,new iw(i.toArray()),s3.none())}}function s8(e,t,n,r){return e instanceof s7?function(e,t,n,r){if(!s4(e.precondition,t))return n;let i=e.value.clone(),s=or(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof oe?function(e,t,n,r){if(!s4(e.precondition,t))return n;let i=or(e.fieldTransforms,r,t),s=t.data;return(s.setAll(ot(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):s4(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function s9(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&rf(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof sW&&r instanceof sW||n instanceof sY&&r instanceof sY?rf(n.elements,r.elements,iM):n instanceof sJ&&r instanceof sJ?iM(n.gt,r.gt):n instanceof sH&&r instanceof sH)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class s7 extends s6{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class oe extends s6{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ot(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function on(e,t,n){var r;let i=new Map;e.length===n.length||n7();for(let s=0;s<n.length;s++){let o=e[s],a=o.transform,l=t.data.field(o.field);i.set(o.field,(r=n[s],a instanceof sW?sQ(a,l):a instanceof sY?sX(a,l):r))}return i}function or(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof sH?function(e,t){let n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ik(t)&&(t=ix(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(t,s):e instanceof sW?sQ(e,s):e instanceof sY?sX(e,s):function(e,t){let n=sG(e,t),r=sZ(n)+sZ(e.gt);return ij(n)&&ij(e.gt)?sz(r):sB(e.serializer,r)}(e,s))}return r}class oi extends s6{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class os extends s6{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class oo{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){e instanceof s7?function(e,t,n){let r=e.value.clone(),i=on(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof oe?function(e,t,n){if(!s4(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=on(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ot(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=s8(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=s8(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=sF();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,o=this.applyToLocalView(s,i.mutatedFields),a=s5(s,o=t.has(r.key)?null:o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(rg.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sq())}isEqual(e){return this.batchId===e.batchId&&rf(this.mutations,e.mutations,(e,t)=>s9(e,t))&&rf(this.baseMutations,e.baseMutations,(e,t)=>s9(e,t))}}class oa{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){e.mutations.length===n.length||n7();let r=sU,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new oa(e,t,n,r)}}class ol{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ou{constructor(e,t){this.count=e,this.unchangedNames=t}}function oh(e){switch(e){default:return n7();case re.CANCELLED:case re.UNKNOWN:case re.DEADLINE_EXCEEDED:case re.RESOURCE_EXHAUSTED:case re.INTERNAL:case re.UNAVAILABLE:case re.UNAUTHENTICATED:return!1;case re.INVALID_ARGUMENT:case re.NOT_FOUND:case re.ALREADY_EXISTS:case re.PERMISSION_DENIED:case re.FAILED_PRECONDITION:case re.ABORTED:case re.OUT_OF_RANGE:case re.UNIMPLEMENTED:case re.DATA_LOSS:return!0}}function oc(e){if(void 0===e)return n5("GRPC error has no .code"),re.UNKNOWN;switch(e){case a.OK:return re.OK;case a.CANCELLED:return re.CANCELLED;case a.UNKNOWN:return re.UNKNOWN;case a.DEADLINE_EXCEEDED:return re.DEADLINE_EXCEEDED;case a.RESOURCE_EXHAUSTED:return re.RESOURCE_EXHAUSTED;case a.INTERNAL:return re.INTERNAL;case a.UNAVAILABLE:return re.UNAVAILABLE;case a.UNAUTHENTICATED:return re.UNAUTHENTICATED;case a.INVALID_ARGUMENT:return re.INVALID_ARGUMENT;case a.NOT_FOUND:return re.NOT_FOUND;case a.ALREADY_EXISTS:return re.ALREADY_EXISTS;case a.PERMISSION_DENIED:return re.PERMISSION_DENIED;case a.FAILED_PRECONDITION:return re.FAILED_PRECONDITION;case a.ABORTED:return re.ABORTED;case a.OUT_OF_RANGE:return re.OUT_OF_RANGE;case a.UNIMPLEMENTED:return re.UNIMPLEMENTED;case a.DATA_LOSS:return re.DATA_LOSS;default:return n7()}}(l=a||(a={}))[l.OK=0]="OK",l[l.CANCELLED=1]="CANCELLED",l[l.UNKNOWN=2]="UNKNOWN",l[l.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",l[l.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",l[l.NOT_FOUND=5]="NOT_FOUND",l[l.ALREADY_EXISTS=6]="ALREADY_EXISTS",l[l.PERMISSION_DENIED=7]="PERMISSION_DENIED",l[l.UNAUTHENTICATED=16]="UNAUTHENTICATED",l[l.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",l[l.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",l[l.ABORTED=10]="ABORTED",l[l.OUT_OF_RANGE=11]="OUT_OF_RANGE",l[l.UNIMPLEMENTED=12]="UNIMPLEMENTED",l[l.INTERNAL=13]="INTERNAL",l[l.UNAVAILABLE=14]="UNAVAILABLE",l[l.DATA_LOSS=15]="DATA_LOSS";class od{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return of}static getOrCreateInstance(){return null===of&&(of=new od),of}onExistenceFilterMismatch(e){let t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let of=null,op=new nJ([0xffffffff,0xffffffff],0);function og(e){let t=(new TextEncoder).encode(e),n=new nX;return n.update(t),new Uint8Array(n.digest())}function om(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new nJ([n,r],0),new nJ([i,s],0)]}class oy{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ov(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new ov(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ov(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=nJ.fromNumber(this.It)}Et(e,t,n){let r=e.add(t.multiply(nJ.fromNumber(n)));return 1===r.compare(op)&&(r=new nJ([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;let[t,n]=om(og(e));for(let e=0;e<this.hashCount;e++){let r=this.Et(t,n,e);if(!this.At(r))return!1}return!0}static create(e,t,n){let r=new oy(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.It)return;let[t,n]=om(og(e));for(let e=0;e<this.hashCount;e++){let r=this.Et(t,n,e);this.Rt(r)}}Rt(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ov extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class o_{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,ow.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new o_(rg.min(),r,new ip(rd),sP,sq())}}class ow{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ow(n,t,sq(),sq(),sq())}}class ob{constructor(e,t,n,r){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=r}}class oI{constructor(e,t){this.targetId=e,this.Vt=t}}class oT{constructor(e,t,n=iI.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class oE{constructor(){this.St=0,this.Dt=ok(),this.Ct=iI.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=sq(),t=sq(),n=sq();return this.Dt.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:n7()}}),new ow(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=ok()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class oC{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=sP,this.zt=oS(),this.Wt=new ip(rd)}Ht(e){for(let t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(let t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{let n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:n7()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((e,n)=>{this.te(n)&&t(n)})}ne(e){var t;let n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){let s=i.target;if(sd(s))if(0===r){let e=new rw(s.path);this.Yt(n,e,iX.newNoDocument(e,rg.min()))}else 1===r||n7();else{let i=this.ie(n);if(i!==r){let r=this.re(e,i);0!==r&&(this.ee(n),this.Wt=this.Wt.insert(n,2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==(t=od.instance)||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,s,o,a,l;let u={localCacheCount:t,existenceFilterCount:n.count},h=n.unchangedNames;return h&&(u.bloomFilter={applied:0===e,hashCount:null!=(r=null==h?void 0:h.hashCount)?r:0,bitmapLength:null!=(o=null==(s=null==(i=null==h?void 0:h.bits)?void 0:i.bitmap)?void 0:s.length)?o:0,padding:null!=(l=null==(a=null==h?void 0:h.bits)?void 0:a.padding)?l:0}),u}(r,i,e.Vt))}}}}re(e,t){let n,r,{unchangedNames:i,count:s}=e.Vt;if(!i||!i.bits)return 1;let{bits:{bitmap:o="",padding:a=0},hashCount:l=0}=i;try{n=iS(o).toUint8Array()}catch(e){if(e instanceof ib)return n8("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{r=new oy(n,a,l)}catch(e){return n8(e instanceof ov?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===r.It?1:2*(s!==t-this.oe(e.targetId,r))}oe(e,t){let n=this.Gt.getRemoteKeysForTarget(e),r=0;return n.forEach(n=>{let i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),r++)}),r}ce(e){let t=new Map;this.Qt.forEach((n,r)=>{let i=this.se(r);if(i){if(n.current&&sd(i.target)){let t=new rw(i.target.path);null!==this.jt.get(t)||this.ae(r,t)||this.Yt(r,t,iX.newNoDocument(t,e))}n.Mt&&(t.set(r,n.Ot()),n.Ft())}});let n=sq();this.zt.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.jt.forEach((t,n)=>n.setReadTime(e));let r=new o_(e,t,this.Wt,this.jt,n);return this.jt=sP,this.zt=oS(),this.Wt=new ip(rd),r}Jt(e,t){if(!this.te(e))return;let n=2*!!this.ae(e,t.key);this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;let r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){let t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new oE,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new iy(rd),this.zt=this.zt.insert(e,t)),t}te(e){let t=null!==this.se(e);return t||n6("WatchChangeAggregator","Detected inactive target",e),t}se(e){let t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new oE),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function oS(){return new ip(rw.comparator)}function ok(){return new ip(rw.comparator)}let ox={asc:"ASCENDING",desc:"DESCENDING"},oA={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oN={and:"AND",or:"OR"};class oD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function oR(e,t){return e.useProto3Json||rG(t)?t:{value:t}}function oP(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function oO(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function oM(e){return e||n7(),rg.fromTimestamp(function(e){let t=iE(e);return new rp(t.seconds,t.nanos)}(e))}function oL(e,t){return new ry(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function oF(e){let t=ry.fromString(e);return oZ(t)||n7(),t}function oU(e,t){return oL(e.databaseId,t.path)}function oV(e,t){let n=oF(t);if(n.get(1)!==e.databaseId.projectId)throw new rt(re.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new rt(re.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new rw(oz(n))}function oq(e,t){return oL(e.databaseId,t)}function oj(e){let t=oF(e);return 4===t.length?ry.emptyPath():oz(t)}function oB(e){return new ry(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function oz(e){return e.length>4&&"documents"===e.get(4)||n7(),e.popFirst(5)}function oK(e,t,n){return{name:oU(e,t),fields:n.value.mapValue.fields}}function o$(e,t,n){let r=oV(e,t.name),i=oM(t.updateTime),s=t.createTime?oM(t.createTime):rg.min(),o=new iY({mapValue:{fields:t.fields}}),a=iX.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function oG(e,t){var n;let r;if(t instanceof s7)r={update:oK(e,t.key,t.value)};else if(t instanceof oi)r={delete:oU(e,t.key)};else if(t instanceof oe)r={update:oK(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof os))return n7();r={verify:oU(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof sH)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof sW)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof sY)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof sJ)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw n7()})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:oP(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:n7()),r}function oH(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?s3.updateTime(oM(n.updateTime)):void 0!==n.exists?s3.exists(n.exists):s3.none():s3.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{var n,r;let i;return n=e,i=null,"setToServerValue"in(r=t)?("REQUEST_TIME"===r.setToServerValue||n7(),i=new sH):"appendMissingElements"in r?i=new sW(r.appendMissingElements.values||[]):"removeAllFromArray"in r?i=new sY(r.removeAllFromArray.values||[]):"increment"in r?i=new sJ(n,r.increment):n7(),new s1(r_.fromServerFormat(r.fieldPath),i)}):[];if(t.update){t.update.name;let n=oV(e,t.update.name),s=new iY({mapValue:{fields:t.update.fields}});return t.updateMask?new oe(n,s,new iw((t.updateMask.fieldPaths||[]).map(e=>r_.fromServerFormat(e))),r,i):new s7(n,s,r,i)}return t.delete?new oi(oV(e,t.delete),r):t.verify?new os(oV(e,t.verify),r):n7()}function oW(e,t){return{documents:[oq(e,t.path)]}}function oQ(e,t){var n,r;let i={structuredQuery:{}},s=t.path;null!==t.collectionGroup?(i.parent=oq(e,s),i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i.parent=oq(e,s.popLast()),i.structuredQuery.from=[{collectionId:s.lastSegment()}]);let o=function(e){if(0!==e.length)return function e(t){return t instanceof i3?function(e){if("=="===e.op){if(iK(e.value))return{unaryFilter:{field:oX(e.field),op:"IS_NAN"}};if(iz(e.value))return{unaryFilter:{field:oX(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(iK(e.value))return{unaryFilter:{field:oX(e.field),op:"IS_NOT_NAN"}};if(iz(e.value))return{unaryFilter:{field:oX(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oX(e.field),op:oA[e.op],value:e.value}}}(t):t instanceof i4?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:oN[t.op],filters:n}}}(t):n7()}(i4.create(e,"and"))}(t.filters);o&&(i.structuredQuery.where=o);let a=function(e){if(0!==e.length)return e.map(e=>({field:oX(e.field),direction:ox[e.dir]}))}(t.orderBy);a&&(i.structuredQuery.orderBy=a);let l=oR(e,t.limit);return null!==l&&(i.structuredQuery.limit=l),t.startAt&&(i.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(i.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),i}function oY(e){var t;let n,r=oj(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,o=null;if(s>0){1===s||n7();let e=i.from[0];e.allDescendants?o=e.collectionId:r=r.child(e.collectionId)}let a=[];i.where&&(a=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=oJ(e.unaryFilter.field);return i3.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=oJ(e.unaryFilter.field);return i3.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=oJ(e.unaryFilter.field);return i3.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=oJ(e.unaryFilter.field);return i3.create(i,"!=",{nullValue:"NULL_VALUE"});default:return n7()}}(t):void 0!==t.fieldFilter?i3.create(oJ(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return n7()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?i4.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return n7()}}(t.compositeFilter.op)):n7()}(e);return t instanceof i4&&i8(t)?t.getFilters():[t]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new i1(oJ(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=rG(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let h=null;i.startAt&&(h=function(e){let t=!!e.before;return new iJ(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new iJ(e.values||[],t)}(i.endAt)),new sm(r,o,l,a,u,"F",h,c)}function oX(e){return{fieldPath:e.canonicalString()}}function oJ(e){return r_.fromServerFormat(e.fieldPath)}function oZ(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class o0{constructor(e,t,n,r,i=rg.min(),s=rg.min(),o=iI.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new o0(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new o0(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new o0(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new o0(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class o1{constructor(e){this.fe=e}}function o2(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:o3(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:oU(i=e.fe,t.key),fields:t.data.value.mapValue.fields,updateTime:oP(i,t.version.toTimestamp()),createTime:oP(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:o4(t.version)};else{if(!t.isUnknownDocument())return n7();r.unknownDocument={path:n.path.toArray(),version:o4(t.version)}}return r}function o3(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function o4(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function o6(e){let t=new rp(e.seconds,e.nanoseconds);return rg.fromTimestamp(t)}function o5(e,t){let n=(t.baseMutations||[]).map(t=>oH(e.fe,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>oH(e.fe,t)),i=rp.fromMillis(t.localWriteTimeMs);return new oo(t.batchId,i,n,r)}function o8(e){var t;let n,r=o6(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?o6(e.lastLimboFreeSnapshotVersion):rg.min();return void 0!==e.query.documents?(1===(t=e.query).documents.length||n7(),n=sT(sy(oj(t.documents[0])))):n=sT(oY(e.query)),new o0(n,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,iI.fromBase64String(e.resumeToken))}function o9(e,t){let n,r=o4(t.snapshotVersion),i=o4(t.lastLimboFreeSnapshotVersion);n=sd(t.target)?oW(e.fe,t.target):oQ(e.fe,t.target);let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:sh(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function o7(e){let t=oY({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?sC(t,t.limit,"L"):t}function ae(e,t){return new ol(t.largestBatchId,oH(e.fe,t.overlayMutation))}function at(e,t){let n=t.path.lastSegment();return[e,rQ(t.path.popLast()),n]}function an(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:o4(r.readTime),documentKey:rQ(r.documentKey.path),largestBatchId:r.largestBatchId}}class ar{getBundleMetadata(e,t){return ai(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:o6(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return ai(e).put({bundleId:t.id,createTime:o4(oM(t.createTime)),version:t.version})}getNamedQuery(e,t){return as(e).get(t).next(e=>{if(e)return{name:e.name,query:o7(e.bundledQuery),readTime:o6(e.readTime)}})}saveNamedQuery(e,t){return as(e).put({name:t.name,readTime:o4(oM(t.readTime)),bundledQuery:t.bundledQuery})}}function ai(e){return iu(e,"bundles")}function as(e){return iu(e,"namedQueries")}class ao{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){return new ao(e,t.uid||"")}getOverlay(e,t){return aa(e).get(at(this.userId,t)).next(e=>e?ae(this.serializer,e):null)}getOverlays(e,t){let n=sF();return rP.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new ol(t,i);r.push(this.we(e,s))}),rP.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(rQ(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(aa(e).J("collectionPathOverlayIndex",r))}),rP.waitFor(i)}getOverlaysForCollection(e,t,n){let r=sF(),i=rQ(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return aa(e).j("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let e=ae(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=sF(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return aa(e).X({index:"collectionGroupOverlayIndex",range:o},(e,t,n)=>{let o=ae(this.serializer,t);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()}).next(()=>s)}we(e,t){return aa(e).put(function(e,t,n){let[r,i,s]=at(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:oG(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}function aa(e){return iu(e,"documentOverlays")}class al{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(+!!e.booleanValue);else if("integerValue"in e)this.ye(t,15),t.pe(iC(e.integerValue));else if("doubleValue"in e){let n=iC(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),rH(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(iS(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?iH(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):n7()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){let n=e.fields||{};for(let e of(this.ye(t,55),Object.keys(n)))this.Te(e,t),this.me(n[e],t)}Pe(e,t){let n=e.values||[];for(let e of(this.ye(t,50),n))this.me(e,t)}ve(e,t){this.ye(t,37),rw.fromName(e).path.forEach(e=>{this.ye(t,60),this.be(e,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function au(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}al.Ve=new al;class ah{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.De(n.value),n=t.next();this.Ce()}xe(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ne(n.value),n=t.next();this.ke()}Me(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.De(e);else if(e<2048)this.De(960|e>>>6),this.De(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.De(480|e>>>12),this.De(128|63&e>>>6),this.De(128|63&e);else{let e=t.codePointAt(0);this.De(240|e>>>18),this.De(128|63&e>>>12),this.De(128|63&e>>>6),this.De(128|63&e)}}this.Ce()}$e(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ne(e);else if(e<2048)this.Ne(960|e>>>6),this.Ne(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e);else{let e=t.codePointAt(0);this.Ne(240|e>>>18),this.Ne(128|63&e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e)}}this.ke()}Oe(e){let t=this.Fe(e),n=au(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Le(e){let t=this.Fe(e),n=au(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!n;return t}De(e){let t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){let t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ac{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class ad{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class af{constructor(){this.je=new ah,this.ze=new ac(this.je),this.We=new ad(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class ap{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Je(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new ap(this.indexId,this.documentKey,this.arrayValue,n)}}function ag(e,t){let n=e.indexId-t.indexId;return 0!==n||0!==(n=am(e.arrayValue,t.arrayValue))||0!==(n=am(e.directionalValue,t.directionalValue))?n:rw.comparator(e.documentKey,t.documentKey)}function am(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class ay{constructor(e){for(let t of(this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[],e.filters))t.isInequality()?this.Ze=t:this.Xe.push(t)}tn(e){e.collectionGroup===this.collectionId||n7();let t=rI(e);if(void 0!==t&&!this.en(t))return!1;let n=rT(e),r=new Set,i=0,s=0;for(;i<n.length&&this.en(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){let e=n[i];if(!this.nn(this.Ze,e)||!this.sn(this.Ye[s++],e))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.Ye.length||!this.sn(this.Ye[s++],e))return!1}return!0}en(e){for(let t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function av(e){return e instanceof i3}function a_(e){return e instanceof i4&&i8(e)}function aw(e){return av(e)||a_(e)||function(e){if(e instanceof i4&&i5(e)){for(let t of e.getFilters())if(!av(t)&&!a_(t))return!1;return!0}return!1}(e)}function ab(e,t){return e instanceof i3||e instanceof i4||n7(),t instanceof i3||t instanceof i4||n7(),aT(e instanceof i3?t instanceof i3?i4.create([e,t],"and"):aI(e,t):t instanceof i3?aI(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||n7(),i6(e)&&i6(t))return i7(e,t.getFilters());let n=i5(e)?e:t,r=i5(e)?t:e,i=n.filters.map(e=>ab(e,r));return i4.create(i,"or")}(e,t))}function aI(e,t){if(i6(t))return i7(t,e.getFilters());{let n=t.filters.map(t=>ab(e,t));return i4.create(n,"or")}}function aT(e){if(e instanceof i3||e instanceof i4||n7(),e instanceof i3)return e;let t=e.getFilters();if(1===t.length)return aT(t[0]);if(i9(e))return e;let n=t.map(e=>aT(e)),r=[];return n.forEach(t=>{t instanceof i3?r.push(t):t instanceof i4&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:i4.create(r,e.op)}class aE{constructor(){this.rn=new aC}addToCollectionParentIndex(e,t){return this.rn.add(t),rP.resolve()}getCollectionParents(e,t){return rP.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return rP.resolve()}deleteFieldIndex(e,t){return rP.resolve()}getDocumentsMatchingTarget(e,t){return rP.resolve(null)}getIndexType(e,t){return rP.resolve(0)}getFieldIndexes(e,t){return rP.resolve([])}getNextCollectionGroupToUpdate(e){return rP.resolve(null)}getMinOffset(e,t){return rP.resolve(rx.min())}getMinOffsetFromCollectionGroup(e,t){return rP.resolve(rx.min())}updateCollectionGroup(e,t,n){return rP.resolve()}updateIndexEntries(e,t){return rP.resolve()}}class aC{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new iy(ry.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new iy(ry.comparator)).toArray()}}let aS=new Uint8Array(0);class ak{constructor(e,t){this.user=e,this.databaseId=t,this.on=new aC,this.un=new sR(e=>sh(e),(e,t)=>sc(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.on.add(t)});let i={collectionId:n,parent:rQ(r)};return ax(e).put(i)}return rP.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return ax(e).j(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(rY(r.parent))}return n})}addFieldIndex(e,t){let n=aN(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=aD(e);return i.next(e=>{n.put(an(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=aN(e),r=aD(e),i=aA(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){let n=aA(e),r=!0,i=new Map;return rP.forEach(this.cn(t),t=>this.an(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=sq(),r=[];return rP.forEach(i,(i,s)=>{n6("IndexedDbIndexManager",`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${sh(t)}`);let o=function(e,t){let n=rI(t);if(void 0===n)return null;for(let t of sf(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),a=function(e,t){let n=new Map;for(let r of rT(t))for(let t of sf(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of rT(t)){let t=0===i.kind?sp(e,i.fieldPath,e.startAt):sg(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new iJ(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of rT(t)){let t=0===i.kind?sg(e,i.fieldPath,e.endAt):sp(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new iJ(n,r)}(s,i),h=this.hn(i,s,l),c=this.hn(i,s,u),d=this.ln(i,s,a),p=this.fn(i.indexId,o,h,l.inclusive,c,u.inclusive,d);return rP.forEach(p,i=>n.H(i,t.limit).next(t=>{t.forEach(t=>{let n=rw.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return rP.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof i3||t instanceof i4||n7(),t instanceof i3)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=i4.create(n,t.op);return aw(r=aT(r))?r:(r instanceof i4||n7(),i6(r)||n7(),r.filters.length>1||n7(),r.filters.reduce((e,t)=>ab(e,t)))}(function e(t){var n,r;if(t instanceof i3||t instanceof i4||n7(),t instanceof i3){if(t instanceof ss){let e=(null==(r=null==(n=t.value.arrayValue)?void 0:n.values)?void 0:r.map(e=>i3.create(t.field,"==",e)))||[];return i4.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return i4.create(i,t.op)}(e));return aw(t)||n7(),av(t)||a_(t)?[t]:t.getFilters()})(i4.create(e.filters,"and")).map(t=>su(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t)),t}fn(e,t,n,r,i,s,o){let a=(null!=t?t.length:1)*Math.max(n.length,i.length),l=a/(null!=t?t.length:1),u=[];for(let h=0;h<a;++h){let a=t?this.dn(t[h/l]):aS,c=this.wn(e,a,n[h%l],r),d=this._n(e,a,i[h%l],s),p=o.map(t=>this.wn(e,a,t,!0));u.push(...this.createRange(c,d,p))}return u}wn(e,t,n,r){let i=new ap(e,rw.empty(),t,n);return r?i:i.Je()}_n(e,t,n,r){let i=new ap(e,rw.empty(),t,n);return r?i.Je():i}an(e,t){let n=new ay(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.cn(t);return rP.forEach(r,t=>this.an(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new iy(r_.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}mn(e,t){let n=new af;for(let r of rT(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.He(r.kind);al.Ve._e(e,i)}return n.Qe()}dn(e){let t=new af;return al.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){let n=new af;return al.Ve._e(iq(this.databaseId,t),n.He(function(e){let t=rT(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}ln(e,t,n){if(null===n)return[];let r=[];r.push(new af);let i=0;for(let s of rT(e)){let e=n[i++];for(let n of r)if(this.yn(t,s.fieldPath)&&iB(e))r=this.pn(r,s,e);else{let t=n.He(s.kind);al.Ve._e(e,t)}}return this.In(r)}hn(e,t,n){return this.ln(e,t,n.position)}In(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Qe();return t}pn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new af;r.seed(n.Qe()),al.Ve._e(e,r.He(t.kind)),i.push(r)}return i}yn(e,t){return!!e.filters.find(e=>e instanceof i3&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=aN(e),r=aD(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next(e=>{let t=[];return rP.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new rC(t.sequenceNumber,new rx(o6(t.readTime),new rw(rY(t.documentKey)),t.largestBatchId)):rC.empty(),r=e.fields.map(([e,t])=>new rE(r_.fromServerFormat(e),t));return new rb(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:rd(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=aN(e),i=aD(e);return this.Tn(e).next(e=>r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>rP.forEach(t,t=>i.put(an(t.indexId,this.user,e,n)))))}updateIndexEntries(e,t){let n=new Map;return rP.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?rP.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),rP.forEach(i,n=>this.En(e,t,n).next(t=>{let i=this.An(r,n);return t.isEqual(i)?rP.resolve():this.vn(e,r,n,t,i)}))))})}Rn(e,t,n,r){return aA(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,n,r){return aA(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}En(e,t,n){let r=aA(e),i=new iy(ag);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},(e,r)=>{i=i.add(new ap(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}An(e,t){let n=new iy(ag),r=this.mn(t,e);if(null==r)return n;let i=rI(t);if(null!=i){let s=e.data.field(i.fieldPath);if(iB(s))for(let i of s.arrayValue.values||[])n=n.add(new ap(t.indexId,e.key,this.dn(i),r))}else n=n.add(new ap(t.indexId,e.key,aS,r));return n}vn(e,t,n,r,i){n6("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),o=t.getIterator(),a=i_(s),l=i_(o);for(;a||l;){let e=!1,t=!1;if(a&&l){let r=n(a,l);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(l),l=i_(o)):t?(i(a),a=i_(s)):(a=i_(s),l=i_(o))}}(r,i,ag,r=>{s.push(this.Rn(e,t,n,r))},r=>{s.push(this.Pn(e,t,n,r))}),rP.waitFor(s)}Tn(e){let t=1;return aD(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>ag(e,t)).filter((e,t,n)=>!t||0!==ag(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=ag(i,e),s=ag(i,t);if(0===n)r[0]=e.Je();else if(n>0&&s<0)r.push(i),r.push(i.Je());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.bn(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,aS,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,aS,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return ag(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(aR)}getMinOffset(e,t){return rP.mapArray(this.cn(t),t=>this.an(e,t).next(e=>e||n7())).next(aR)}}function ax(e){return iu(e,"collectionParents")}function aA(e){return iu(e,"indexEntries")}function aN(e){return iu(e,"indexConfiguration")}function aD(e){return iu(e,"indexState")}function aR(e){0!==e.length||n7();let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>rA(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new rx(t.readTime,t.documentKey,n)}let aP={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class aO{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new aO(e,aO.DEFAULT_COLLECTION_PERCENTILE,aO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function aM(e,t,n){let r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId),a=0,l=r.X({range:o},(e,t,n)=>(a++,n.delete()));s.push(l.next(()=>{1===a||n7()}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,rQ(h),c]);s.push(i.delete(r)),u.push(e.key)}return rP.waitFor(s).next(()=>u)}function aL(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw n7();t=e.noDocument}return JSON.stringify(t).length}aO.DEFAULT_COLLECTION_PERCENTILE=10,aO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,aO.DEFAULT=new aO(0x2800000,aO.DEFAULT_COLLECTION_PERCENTILE,aO.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),aO.DISABLED=new aO(-1,0,0);class aF{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(e,t,n,r){return""!==e.uid||n7(),new aF(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aV(e).X({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=aq(e),s=aV(e);return s.add({}).next(o=>{var a,l;"number"==typeof o||n7();let u=new oo(o,t,n,r),h=function(e,t,n){let r=n.baseMutations.map(t=>oG(e.fe,t)),i=n.mutations.map(t=>oG(e.fe,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,u),c=[],d=new iy((e,t)=>rd(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(a=this.userId,l=e.key.path,[a,rQ(l),o]);d=d.add(e.key.path.popLast()),c.push(s.put(h)),c.push(i.put(t,rJ))}return d.forEach(t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Vn[o]=u.keys()}),rP.waitFor(c).next(()=>u)})}lookupMutationBatch(e,t){return aV(e).get(t).next(e=>e?(e.userId===this.userId||n7(),o5(this.serializer,e)):null)}Sn(e,t){return this.Vn[t]?rP.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Vn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return aV(e).X({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(t.batchId>=n||n7(),i=o5(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return aV(e).X({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return aV(e).j("userMutationsIndex",t).next(e=>e.map(e=>o5(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,rQ(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return aq(e).X({range:r},(n,r,s)=>{let[o,a,l]=n,u=rY(a);if(o===this.userId&&t.path.isEqual(u))return aV(e).get(l).next(e=>{if(!e)throw n7();e.userId===this.userId||n7(),i.push(o5(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iy(rd),r=[];return t.forEach(t=>{let i=[this.userId,rQ(t.path)],s=IDBKeyRange.lowerBound(i),o=aq(e).X({range:s},(e,r,i)=>{let[s,o,a]=e,l=rY(o);s===this.userId&&t.path.isEqual(l)?n=n.add(a):i.done()});r.push(o)}),rP.waitFor(r).next(()=>this.Dn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,rQ(n)],s=IDBKeyRange.lowerBound(i),o=new iy(rd);return aq(e).X({range:s},(e,t,i)=>{let[s,a,l]=e,u=rY(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(l)):i.done()}).next(()=>this.Dn(e,o))}Dn(e,t){let n=[],r=[];return t.forEach(t=>{r.push(aV(e).get(t).next(e=>{if(null===e)throw n7();e.userId===this.userId||n7(),n.push(o5(this.serializer,e))}))}),rP.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return aM(e.ht,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Cn(t.batchId)}),rP.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rP.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return aq(e).X({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=rY(e[1]);r.push(t)}else n.done()}).next(()=>{0===r.length||n7()})})}containsKey(e,t){return aU(e,this.userId,t)}xn(e){return aj(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function aU(e,t,n){let r=[t,rQ(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return aq(e).X({range:s,Y:!0},(e,n,r)=>{let[s,a,l]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function aV(e){return iu(e,"mutations")}function aq(e){return iu(e,"documentMutations")}function aj(e){return iu(e,"mutationQueues")}class aB{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new aB(0)}static Mn(){return new aB(-1)}}class az{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next(t=>{let n=new aB(t.highestTargetId);return t.highestTargetId=n.next(),this.On(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.$n(e).next(e=>rg.fromTimestamp(new rp(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.$n(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.$n(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.On(e,r)))}addTargetData(e,t){return this.Fn(e,t).next(()=>this.$n(e).next(n=>(n.targetCount+=1,this.Bn(t,n),this.On(e,n))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>aK(e).delete(t.targetId)).next(()=>this.$n(e)).next(t=>(t.targetCount>0||n7(),t.targetCount-=1,this.On(e,t)))}removeTargets(e,t,n){let r=0,i=[];return aK(e).X((s,o)=>{let a=o8(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>rP.waitFor(i)).next(()=>r)}forEachTarget(e,t){return aK(e).X((e,n)=>{t(o8(n))})}$n(e){return a$(e).get("targetGlobalKey").next(e=>(null!==e||n7(),e))}On(e,t){return a$(e).put("targetGlobalKey",t)}Fn(e,t){return aK(e).put(o9(this.serializer,t))}Bn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.$n(e).next(e=>e.targetCount)}getTargetData(e,t){let n=sh(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return aK(e).X({range:r,index:"queryTargetsIndex"},(e,n,r)=>{let s=o8(n);sc(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=aG(e);return t.forEach(t=>{let s=rQ(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),rP.waitFor(r)}removeMatchingKeys(e,t,n){let r=aG(e);return rP.forEach(t,t=>{let i=rQ(t.path);return rP.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=aG(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=aG(e),i=sq();return r.X({range:n,Y:!0},(e,t,n)=>{let r=new rw(rY(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=rQ(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return aG(e).X({index:"documentTargetsIndex",Y:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}le(e,t){return aK(e).get(t).next(e=>e?o8(e):null)}}function aK(e){return iu(e,"targets")}function a$(e){return iu(e,"targetGlobal")}function aG(e){return iu(e,"targetDocuments")}function aH([e,t],[n,r]){let i=rd(e,n);return 0===i?rd(t,r):i}class aW{constructor(e){this.Ln=e,this.buffer=new iy(aH),this.qn=0}Un(){return++this.qn}Kn(e){let t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>aH(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class aQ{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){n6("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rU(e)?n6("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await rR(e)}await this.Qn(3e5)})}}class aY{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rP.resolve(r$.ct);let n=new aW(t);return this.jn.forEachTarget(e,e=>n.Kn(e.sequenceNumber)).next(()=>this.jn.Wn(e,e=>n.Kn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(n6("LruGarbageCollector","Garbage collection skipped; disabled"),rP.resolve(aP)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(n6("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),aP):this.Hn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let n,r,i,s,o,a,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(n6("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),n4()<=d.$b.DEBUG&&n6("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(o-s)+"ms\n"+`	Removed ${i} targets in `+(a-o)+"ms\n"+`	Removed ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-u}ms`),rP.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class aX{constructor(e,t){this.db=e,this.garbageCollector=new aY(this,t)}zn(e){let t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Jn(e){let t=0;return this.Wn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,(e,n)=>t(n))}addReference(e,t,n){return aJ(e,n)}removeReference(e,t,n){return aJ(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return aJ(e,t)}Xn(e,t){let n;return n=!1,aj(e).Z(r=>aU(e,r,t).next(e=>(e&&(n=!0),rP.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.Yn(e,(s,o)=>{if(o<=t){let t=this.Xn(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,rg.min()),aG(e).delete([0,rQ(s.path)])))});r.push(t)}}).next(()=>rP.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return aJ(e,t)}Yn(e,t){let n=aG(e),r,i=r$.ct;return n.X({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==r$.ct&&t(new rw(rY(r)),i),i=o,r=s):i=r$.ct}).next(()=>{i!==r$.ct&&t(new rw(rY(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function aJ(e,t){var n;return aG(e).put((n=e.currentSequenceNumber,{targetId:0,path:rQ(t.path),sequenceNumber:n}))}class aZ{constructor(){this.changes=new sR(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,iX.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?rP.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class a0{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return a3(e).put(n)}removeEntry(e,t,n){return a3(e).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],o3(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Zn(e,n)))}getEntry(e,t){let n=iX.newInvalidDocument(t);return a3(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(a4(t))},(e,r)=>{n=this.ts(t,r)}).next(()=>n)}es(e,t){let n={size:0,document:iX.newInvalidDocument(t)};return a3(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(a4(t))},(e,r)=>{n={document:this.ts(t,r),size:aL(r)}}).next(()=>n)}getEntries(e,t){let n=sP;return this.ns(e,t,(e,t)=>{let r=this.ts(e,t);n=n.insert(e,r)}).next(()=>n)}ss(e,t){let n=sP,r=new ip(rw.comparator);return this.ns(e,t,(e,t)=>{let i=this.ts(e,t);n=n.insert(e,i),r=r.insert(e,aL(t))}).next(()=>({documents:n,rs:r}))}ns(e,t,n){if(t.isEmpty())return rP.resolve();let r=new iy(a5);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(a4(r.first()),a4(r.last())),s=r.getIterator(),o=s.getNext();return a3(e).X({index:"documentKeyIndex",range:i},(e,t,r)=>{let i=rw.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&0>a5(o,i);)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.G(a4(o)):r.done()}).next(()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r){let i=t.path,s=[i.popLast().toArray(),i.lastSegment(),o3(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return a3(e).j(IDBKeyRange.bound(s,o,!0)).next(e=>{let n=sP;for(let i of e){let e=this.ts(rw.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(sA(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=sP,s=a6(t,n),o=a6(t,rx.max());return a3(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},(e,t,n)=>{let s=this.ts(rw.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new a1(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return a2(e).get("remoteDocumentGlobalKey").next(e=>(e||n7(),e))}Zn(e,t){return a2(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){let e=function(e,t){let n;if(t.document)n=o$(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rw.fromSegments(t.noDocument.path),r=o6(t.noDocument.readTime);n=iX.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return n7();{let e=rw.fromSegments(t.unknownDocument.path),r=o6(t.unknownDocument.version);n=iX.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){let t=new rp(e[0],e[1]);return rg.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(rg.min())))return e}return iX.newInvalidDocument(e)}}class a1 extends aZ{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new sR(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new iy((e,t)=>rd(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let o=this.us.get(i);if(t.push(this.os.removeEntry(e,i,o.readTime)),s.isValidDocument()){let a=o2(this.os.serializer,s);r=r.add(i.path.popLast());let l=aL(a);n+=l-o.size,t.push(this.os.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){let n=o2(this.os.serializer,s.convertToNoDocument(rg.min()));t.push(this.os.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.os.updateMetadata(e,n)),rP.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next(e=>(this.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.os.ss(e,t).next(({documents:e,rs:t})=>(t.forEach((t,n)=>{this.us.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function a2(e){return iu(e,"remoteDocumentGlobal")}function a3(e){return iu(e,"remoteDocumentsV14")}function a4(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function a6(e,t){let n=t.documentKey.path.toArray();return[e,o3(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function a5(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=rd(n[e],r[e]))return i;return(i=rd(n.length,r.length))||(i=rd(n[n.length-2],r[r.length-2]))||rd(n[n.length-1],r[r.length-1])}class a8{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class a9{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&s8(n.mutation,e,iw.empty(),rp.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sq()).next(()=>t))}getLocalViewOfDocuments(e,t,n=sq()){let r=sF();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=sM();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=sF();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,sq()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=sP,s=sF(),o=sF();return t.forEach((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof oe)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),s8(o.mutation,t,o.mutation.getFieldMask(),rp.now())):s.set(t.key,iw.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new a8(t,null!=(n=s.get(e))?n:null))}),o))}recalculateAndSaveOverlays(e,t){let n=sF(),r=new ip((e,t)=>e-t),i=sq();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||iw.empty();o=i.applyToLocalView(s,o),n.set(e,o);let a=(r.get(i.batchId)||sq()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{let s=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),a=r.key,l=r.value,u=sF();l.forEach(e=>{if(!i.has(e)){let r=s5(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return rP.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return rw.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):sb(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):rP.resolve(sF()),o=-1,a=i;return s.next(t=>rP.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?rP.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,sq())).next(e=>({batchId:o,changes:sL(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rw(t)).next(e=>{let t=sM();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){let r=t.collectionGroup,i=sM();return this.indexManager.getCollectionParents(e,r).next(s=>rP.forEach(s,s=>{let o=new sm(s.child(r),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r))).next(e=>{r.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,iX.newInvalidDocument(r)))});let n=sM();return e.forEach((e,i)=>{let s=r.get(e);void 0!==s&&s8(s.mutation,i,iw.empty(),rp.now()),sA(t,i)&&(n=n.insert(e,i))}),n})}}class a7{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return rP.resolve(this.cs.get(t))}saveBundleMetadata(e,t){return this.cs.set(t.id,{id:t.id,version:t.version,createTime:oM(t.createTime)}),rP.resolve()}getNamedQuery(e,t){return rP.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,{name:t.name,query:o7(t.bundledQuery),readTime:oM(t.readTime)}),rP.resolve()}}class le{constructor(){this.overlays=new ip(rw.comparator),this.ls=new Map}getOverlay(e,t){return rP.resolve(this.overlays.get(t))}getOverlays(e,t){let n=sF();return rP.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.we(e,t,r)}),rP.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.ls.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.ls.delete(n)),rP.resolve()}getOverlaysForCollection(e,t,n){let r=sF(),i=t.length+1,s=new rw(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return rP.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new ip((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=sF(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=sF(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return rP.resolve(o)}we(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ol(t,n));let i=this.ls.get(t);void 0===i&&(i=sq(),this.ls.set(t,i)),this.ls.set(t,i.add(n.key))}}class lt{constructor(){this.fs=new iy(ln.ds),this.ws=new iy(ln._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){let n=new ln(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.ys(new ln(e,t))}ps(e,t){e.forEach(e=>this.removeReference(e,t))}Is(e){let t=new rw(new ry([])),n=new ln(t,e),r=new ln(t,e+1),i=[];return this.ws.forEachInRange([n,r],e=>{this.ys(e),i.push(e.key)}),i}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){let t=new rw(new ry([])),n=new ln(t,e),r=new ln(t,e+1),i=sq();return this.ws.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new ln(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ln{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return rw.comparator(e.key,t.key)||rd(e.As,t.As)}static _s(e,t){return rd(e.As,t.As)||rw.comparator(e.key,t.key)}}class lr{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new iy(ln.ds)}checkEmpty(e){return rP.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new oo(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Rs=this.Rs.add(new ln(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rP.resolve(s)}lookupMutationBatch(e,t){return rP.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.bs(t+1),r=n<0?0:n;return rP.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return rP.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return rP.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new ln(t,0),r=new ln(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],e=>{let t=this.Ps(e.As);i.push(t)}),rP.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new iy(rd);return t.forEach(e=>{let t=new ln(e,0),r=new ln(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,r],e=>{n=n.add(e.As)})}),rP.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;rw.isDocumentKey(i)||(i=i.child(""));let s=new ln(new rw(i),0),o=new iy(rd);return this.Rs.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.As)),!0)},s),rP.resolve(this.Vs(o))}Vs(e){let t=[];return e.forEach(e=>{let n=this.Ps(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Ss(t.batchId,"removed")||n7(),this.mutationQueue.shift();let n=this.Rs;return rP.forEach(t.mutations,r=>{let i=new ln(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Rs=n})}Cn(e){}containsKey(e,t){let n=new ln(t,0),r=this.Rs.firstAfterOrEqual(n);return rP.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,rP.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){let t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class li{constructor(e){this.Ds=e,this.docs=new ip(rw.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return rP.resolve(n?n.document.mutableCopy():iX.newInvalidDocument(t))}getEntries(e,t){let n=sP;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():iX.newInvalidDocument(e))}),rP.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=sP,s=t.path,o=new rw(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=rA(rk(o),n)||(r.has(o.key)||sA(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return rP.resolve(i)}getAllFromCollectionGroup(e,t,n,r){n7()}Cs(e,t){return rP.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ls(this)}getSize(e){return rP.resolve(this.size)}}class ls extends aZ{constructor(e){super(),this.os=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(n)}),rP.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class lo{constructor(e){this.persistence=e,this.xs=new sR(e=>sh(e),sc),this.lastRemoteSnapshotVersion=rg.min(),this.highestTargetId=0,this.Ns=0,this.ks=new lt,this.targetCount=0,this.Ms=aB.kn()}forEachTarget(e,t){return this.xs.forEach((e,n)=>t(n)),rP.resolve()}getLastRemoteSnapshotVersion(e){return rP.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rP.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),rP.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),rP.resolve()}Fn(e){this.xs.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Ms=new aB(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,rP.resolve()}updateTargetData(e,t){return this.Fn(t),rP.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,rP.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.xs.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),rP.waitFor(i).next(()=>r)}getTargetCount(e){return rP.resolve(this.targetCount)}getTargetData(e,t){let n=this.xs.get(t)||null;return rP.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),rP.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),rP.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),rP.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ks.Es(t);return rP.resolve(n)}containsKey(e,t){return rP.resolve(this.ks.containsKey(t))}}class la{constructor(e,t){this.$s={},this.overlays={},this.Os=new r$(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new lo(this),this.indexManager=new aE,this.remoteDocumentCache=new li(e=>this.referenceDelegate.Ls(e)),this.serializer=new o1(t),this.qs=new a7(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new le,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new lr(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){n6("MemoryPersistence","Starting transaction:",e);let r=new ll(this.Os.next());return this.referenceDelegate.Us(),n(r).next(e=>this.referenceDelegate.Ks(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Gs(e,t){return rP.or(Object.values(this.$s).map(n=>()=>n.containsKey(e,t)))}}class ll extends rD{constructor(e){super(),this.currentSequenceNumber=e}}class lu{constructor(e){this.persistence=e,this.Qs=new lt,this.js=null}static zs(e){return new lu(e)}get Ws(){if(this.js)return this.js;throw n7()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),rP.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),rP.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),rP.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(e=>this.Ws.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ws.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rP.forEach(this.Ws,n=>{let r=rw.fromPath(n);return this.Hs(e,r).next(e=>{e||t.removeEntry(r,rg.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return rP.or([()=>rP.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class lh{constructor(e,t){this.persistence=e,this.Js=new sR(e=>rQ(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new aY(this,t)}static zs(e,t){return new lh(e,t)}Us(){}Ks(e){return rP.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}zn(e){let t=this.Jn(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Jn(e){let t=0;return this.Wn(e,e=>{t++}).next(()=>t)}Wn(e,t){return rP.forEach(this.Js,(n,r)=>this.Xn(e,n,r).next(e=>e?rP.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.Cs(e,r=>this.Xn(e,r,t).next(e=>{e||(n++,i.removeEntry(r,rg.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Js.set(t,e.currentSequenceNumber),rP.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Js.set(n,e.currentSequenceNumber),rP.resolve()}removeReference(e,t,n){return this.Js.set(n,e.currentSequenceNumber),rP.resolve()}updateLimboDocument(e,t){return this.Js.set(t,e.currentSequenceNumber),rP.resolve()}Ls(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(iO(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=ix(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return iS(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:var r;let i;return r=t.mapValue,i=0,ic(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw n7()}}(e.data.value)),t}Xn(e,t,n){return rP.or([()=>this.persistence.Gs(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.Js.get(t);return rP.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class lc{constructor(e){this.serializer=e}O(e,t,n,r){let i=new rO("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore("owner"),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rX,{unique:!0}),e.createObjectStore("documentMutations"),ld(e),e.createObjectStore("remoteDocuments"));let s=rP.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),ld(e)),s=s.next(()=>(function(e){let t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rg.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)})(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store("mutations").j().next(t=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rX,{unique:!0});let n=i.store("mutations"),r=t.map(e=>n.put(e));return rP.waitFor(r)}))),s=s.next(()=>{e.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.Ys(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore("remoteDocumentGlobal"),this.Xs(i)))),n<7&&r>=7&&(s=s.next(()=>this.Zs(i))),n<8&&r>=8&&(s=s.next(()=>this.ti(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.ei(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore("bundles",{keyPath:"bundleId"}),e.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t=e.createObjectStore("documentOverlays",{keyPath:ie});t.createIndex("collectionPathOverlayIndex",it,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",ir,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore("remoteDocumentsV14",{keyPath:rZ});t.createIndex("documentKeyIndex",r0),t.createIndex("collectionGroupIndex",r1)})(e)).next(()=>this.ni(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(s=s.next(()=>this.si(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:r5}).createIndex("sequenceNumberIndex",r8,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:r9}).createIndex("documentKeyIndex",r7,{unique:!1})})),s}Xs(e){let t=0;return e.store("remoteDocuments").X((e,n)=>{t+=aL(n)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Ys(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next(t=>rP.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next(n=>rP.forEach(n,n=>{n.userId===t.userId||n7();let r=o5(this.serializer,n);return aM(e,t.userId,r).next(()=>{})}))}))}Zs(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let r=[];return n.X((n,i)=>{let s=new ry(n),o=[0,rQ(s)];r.push(t.get(o).next(n=>n?rP.resolve():t.put({targetId:0,path:rQ(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>rP.waitFor(r))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:r6});let n=t.store("collectionParents"),r=new aC,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:rQ(r)})}};return t.store("remoteDocuments").X({Y:!0},(e,t)=>i(new ry(e).popLast())).next(()=>t.store("documentMutations").X({Y:!0},([e,t,n],r)=>i(rY(t).popLast())))}ei(e){let t=e.store("targets");return t.X((e,n)=>{let r=o8(n),i=o9(this.serializer,r);return t.put(i)})}ni(e,t){let n=t.store("remoteDocuments"),r=[];return n.X((e,n)=>{let i=t.store("remoteDocumentsV14"),s=(n.document?new rw(ry.fromString(n.document.name).popFirst(5)):n.noDocument?rw.fromSegments(n.noDocument.path):n.unknownDocument?rw.fromSegments(n.unknownDocument.path):n7()).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))}).next(()=>rP.waitFor(r))}si(e,t){let n=t.store("mutations"),r=new a0(this.serializer),i=new la(lu.zs,this.serializer.fe);return n.j().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!=(t=n.get(e.userId))?t:sq();o5(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),rP.forEach(n,(e,n)=>{let s=new n1(n),o=ao.de(this.serializer,s),a=i.getIndexManager(s);return new a9(r,aF.de(s,this.serializer,a,i.referenceDelegate),o,a).recalculateAndSaveOverlaysForDocumentKeys(new il(t,r$.ct),e).next()})})}}function ld(e){e.createObjectStore("targetDocuments",{keyPath:r3}).createIndex("documentTargetsIndex",r4,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",r2,{unique:!0}),e.createObjectStore("targetGlobal")}let lf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class lp{constructor(e,t,n,r,i,s,o,a,l,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ii=i,this.window=s,this.document=o,this.ri=l,this.oi=u,this.ui=h,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!lp.D())throw new rt(re.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new aX(this,r),this.di=t+"main",this.serializer=new o1(a),this.wi=new rM(this.di,this.ui,new lc(this.serializer)),this.Bs=new az(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new a0(this.serializer),this.qs=new ar,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&n5("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rt(re.FAILED_PRECONDITION,lf);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Bs.getHighestSequenceNumber(e))}).then(e=>{this.Os=new r$(e,this.ri)}).then(()=>{this.Fs=!0}).catch(e=>(this.wi&&this.wi.close(),Promise.reject(e)))}Ii(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>lm(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ti(e).next(e=>{e||(this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Ei(e)).next(t=>this.isPrimary&&!t?this.Ai(e).next(()=>!1):!!t&&this.vi(e).next(()=>!0))).catch(e=>{if(rU(e))return n6("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return n6("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ii.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Ti(e){return lg(e).get("owner").next(e=>rP.resolve(this.Ri(e)))}Pi(e){return lm(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=iu(e,"clientMetadata");return t.j().next(e=>{let n=this.Si(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return rP.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this._i)for(let t of e)this._i.removeItem(this.Di(t.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.bi()).then(()=>this.pi()))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?rP.resolve(!0):lg(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new rt(re.FAILED_PRECONDITION,lf);return!1}}return!(!this.networkEnabled||!this.inForeground)||lm(e).j().next(e=>void 0===this.Si(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&n6("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new il(e,r$.ct);return this.Ai(t).next(()=>this.Pi(t))}),this.wi.close(),this.Mi()}Si(e,t){return e.filter(e=>this.Vi(e.updateTimeMs,t)&&!this.Ci(e.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>lm(e).j().next(e=>this.Si(e,18e5).map(e=>e.clientId)))}get started(){return this.Fs}getMutationQueue(e,t){return aF.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ak(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return ao.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,n){var r;let i;n6("IndexedDbPersistence","Starting transaction:",e);let s=15===(r=this.ui)?ia:14===r||13===r?io:12===r?is:11===r?ii:void n7();return this.wi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new il(r,this.Os?this.Os.next():r$.ct),"readwrite-primary"===t?this.Ti(i).next(e=>!!e||this.Ei(i)).next(t=>{if(!t)throw n5(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)),new rt(re.FAILED_PRECONDITION,rN);return n(i)}).next(e=>this.vi(i).next(()=>e)):this.Oi(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Oi(e){return lg(e).get("owner").next(e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)&&!this.Ri(e)&&!(this.oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new rt(re.FAILED_PRECONDITION,lf)})}vi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return lg(e).put("owner",t)}static D(){return rM.D()}Ai(e){let t=lg(e);return t.get("owner").next(e=>this.Ri(e)?(n6("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):rP.resolve())}Vi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(n5(`Detected an update time that is in the future: ${e} > ${n}`),!1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;(0,p.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{let n=null!==(null==(t=this._i)?void 0:t.getItem(this.Di(e)));return n6("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return n5("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){n5("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function lg(e){return iu(e,"owner")}function lm(e){return iu(e,"clientMetadata")}function ly(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class lv{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=r}static Li(e,t){let n=sq(),r=sq();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new lv(e,t.fromCache,n,r)}}class l_{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ki(e,t).next(i=>i||this.Gi(e,t,r,n)).next(n=>n||this.Qi(e,t))}Ki(e,t){if(sv(t))return rP.resolve(null);let n=sT(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=sT(t=sC(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=sq(...r);return this.Ui.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.ji(t,r);return this.zi(t,s,i,n.readTime)?this.Ki(e,sC(t,null,"F")):this.Wi(e,s,t,n)}))})))}Gi(e,t,n,r){return sv(t)||r.isEqual(rg.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next(i=>{let s=this.ji(t,i);return this.zi(t,s,n,r)?this.Qi(e,t):(n4()<=d.$b.DEBUG&&n6("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),sx(t)),this.Wi(e,s,t,rS(r,-1)))})}ji(e,t){let n=new iy(sD(e));return t.forEach((t,r)=>{sA(e,r)&&(n=n.add(r))}),n}zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return n4()<=d.$b.DEBUG&&n6("QueryEngine","Using full collection scan to execute query:",sx(t)),this.Ui.getDocumentsMatchingQuery(e,t,rx.min())}Wi(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class lw{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new ip(rd),this.Yi=new sR(e=>sh(e),sc),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new a9(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}async function lb(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.tr(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],o=sq();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({er:e,removedBatchIds:i,addedBatchIds:s}))})})}function lI(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Bs.getLastRemoteSnapshotVersion(t))}function lT(e,t,n){let r=sq(),i=sq();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=sP;return n.forEach((n,s)=>{let o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(rg.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):n6("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{nr:r,sr:i}})}function lE(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Bs.getTargetData(n,t).next(i=>i?(r=i,rP.resolve(r)):e.Bs.allocateTargetId(n).next(i=>(r=new o0(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Bs.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.Ji.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.Ji=e.Ji.insert(n.targetId,n),e.Yi.set(t,n.targetId)),n})}async function lC(e,t,n){let r=e.Ji.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!rU(e))throw e;n6("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ji=e.Ji.remove(t),e.Yi.delete(r.target)}function lS(e,t,n){let r=rg.min(),i=sq();return e.persistence.runTransaction("Execute query","readonly",s=>(function(e,t,n){let r=e.Yi.get(n);return void 0!==r?rP.resolve(e.Ji.get(r)):e.Bs.getTargetData(t,n)})(e,s,sT(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Bs.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Hi.getDocumentsMatchingQuery(s,t,n?r:rg.min(),n?i:sq())).next(n=>(lA(e,sN(t),n),{documents:n,ir:i})))}function lk(e,t){let n=e.Bs,r=e.Ji.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.le(e,t).next(e=>e?e.target:null))}function lx(e,t){let n=e.Xi.get(t)||rg.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.Zi.getAllFromCollectionGroup(r,t,rS(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(lA(e,t,n),n))}function lA(e,t,n){let r=e.Xi.get(t)||rg.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Xi.set(t,r)}async function lN(e,t,n,r){let i=sq(),s=sP;for(let e of n){let n=t.rr(e.metadata.name);e.document&&(i=i.add(n));let r=t.ur(e);r.setReadTime(t.cr(e.metadata.readTime)),s=s.insert(n,r)}let o=e.Zi.newChangeBuffer({trackRemovals:!0}),a=await lE(e,sT(sy(ry.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>lT(t,o,s).next(e=>(o.apply(t),e)).next(n=>e.Bs.removeMatchingKeysForTargetId(t,a.targetId).next(()=>e.Bs.addMatchingKeys(t,i,a.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.nr,n.sr)).next(()=>n.nr)))}async function lD(e,t,n=sq()){let r=await lE(e,sT(o7(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=oM(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.qs.saveNamedQuery(i,t);let o=r.withResumeToken(iI.EMPTY_BYTE_STRING,s);return e.Ji=e.Ji.insert(o.targetId,o),e.Bs.updateTargetData(i,o).next(()=>e.Bs.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Bs.addMatchingKeys(i,n,r.targetId)).next(()=>e.qs.saveNamedQuery(i,t))})}function lR(e,t){return`firestore_clients_${e}_${t}`}function lP(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function lO(e,t){return`firestore_targets_${e}_${t}`}class lM{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static ar(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new rt(r.error.code,r.error.message)),s?new lM(e,t,r.state,i):(n5("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}hr(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lL{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static ar(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new rt(n.error.code,n.error.message)),i?new lL(e,n.state,r):(n5("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lF{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=sj;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=rW(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new lF(e,i):(n5("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class lU{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new lU(t.clientId,t.onlineState):(n5("SharedClientState",`Failed to parse online state: ${e}`),null)}}class lV{constructor(){this.activeTargetIds=sj}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lq{constructor(e,t,n,r,i){var s,o,a;this.window=e,this.ii=t,this.persistenceKey=n,this.wr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new ip(rd),this.started=!1,this.yr=[];let l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.pr=lR(this.persistenceKey,this.wr),this.Ir=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.gr=this.gr.insert(this.wr,new lV),this.Tr=RegExp(`^firestore_clients_${l}_([^_]*)$`),this.Er=RegExp(`^firestore_mutations_${l}_(\\d+)(?:_(.*))?$`),this.Ar=RegExp(`^firestore_targets_${l}_(\\d+)$`),this.vr=(o=this.persistenceKey,`firestore_online_state_${o}`),this.Rr=(a=this.persistenceKey,`firestore_bundle_loaded_v2_${a}`),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.$i())){if(e===this.wr)continue;let t=this.getItem(lR(this.persistenceKey,e));if(t){let n=lF.ar(e,t);n&&(this.gr=this.gr.insert(n.clientId,n))}}this.Pr();let e=this.storage.getItem(this.vr);if(e){let t=this.br(e);t&&this.Vr(t)}for(let e of this.yr)this.mr(e);this.yr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,n){this.Dr(e,t,n),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(lO(this.persistenceKey,e));if(n){let r=lL.ar(e,n);r&&(t=r.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(lO(this.persistenceKey,e))}updateQueryState(e,t,n){this.kr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Cr(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return n6("SharedClientState","READ",e,t),t}setItem(e,t){n6("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){n6("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){if(e.storageArea===this.storage){if(n6("SharedClientState","EVENT",e.key,e.newValue),e.key===this.pr)return void n5("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.Tr.test(e.key)){if(null==e.newValue){let t=this.Or(e.key);return this.Fr(t,null)}{let t=this.Br(e.key,e.newValue);if(t)return this.Fr(t.clientId,t)}}else if(this.Er.test(e.key)){if(null!==e.newValue){let t=this.Lr(e.key,e.newValue);if(t)return this.qr(t)}}else if(this.Ar.test(e.key)){if(null!==e.newValue){let t=this.Ur(e.key,e.newValue);if(t)return this.Kr(t)}}else if(e.key===this.vr){if(null!==e.newValue){let t=this.br(e.newValue);if(t)return this.Vr(t)}}else if(e.key===this.Ir){let t=function(e){let t=r$.ct;if(null!=e)try{let n=JSON.parse(e);"number"==typeof n||n7(),t=n}catch(e){n5("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==r$.ct&&this.sequenceNumberHandler(t)}else if(e.key===this.Rr){let t=this.Gr(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Qr(e)))}}}else this.yr.push(e)})}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,n){let r=new lM(this.currentUser,e,t,n),i=lP(this.persistenceKey,this.currentUser,e);this.setItem(i,r.hr())}Cr(e){let t=lP(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){let t={clientId:this.wr,onlineState:e};this.storage.setItem(this.vr,JSON.stringify(t))}kr(e,t,n){let r=lO(this.persistenceKey,e),i=new lL(e,t,n);this.setItem(r,i.hr())}$r(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){let t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){let n=this.Or(e);return lF.ar(n,t)}Lr(e,t){let n=this.Er.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return lM.ar(new n1(i),r,t)}Ur(e,t){let n=Number(this.Ar.exec(e)[1]);return lL.ar(n,t)}br(e){return lU.ar(e)}Gr(e){return JSON.parse(e)}async qr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.jr(e.batchId,e.state,e.error);n6("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){let n=t?this.gr.insert(e,t):this.gr.remove(e),r=this.Sr(this.gr),i=this.Sr(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.Wr(s,o).then(()=>{this.gr=n})}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=sj;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class lj{constructor(){this.Hr=new lV,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new lV,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lB{Yr(e){}shutdown(){}}class lz{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){for(let e of(n6("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.so))e(0)}no(){for(let e of(n6("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.so))e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lK=null;function l$(){return null===lK?lK=0x10000000+Math.round(0x80000000*Math.random()):lK++,"0x"+lK.toString(16)}let lG={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lH{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}let lW="WebChannelConnection";class lQ extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,r,i){let s=l$(),o=this.To(e,t);n6("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);let a={};return this.Eo(a,r,i),this.Ao(e,o,a,n).then(t=>(n6("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw n8("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}vo(e,t,n,r,i,s){return this.Io(e,t,n,r,i)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+n2,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}To(e,t){let n=lG[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,r){let i=l$();return new Promise((s,o)=>{let a=new nY;a.setWithCredentials(!0),a.listenOnce(n$.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case nK.NO_ERROR:let t=a.getResponseJson();n6(lW,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case nK.TIMEOUT:n6(lW,`RPC '${e}' ${i} timed out`),o(new rt(re.DEADLINE_EXCEEDED,"Request time out"));break;case nK.HTTP_ERROR:let n=a.getStatus();if(n6(lW,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(re).indexOf(t)>=0?t:re.UNKNOWN}(t.status);o(new rt(e,t.message))}else o(new rt(re.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new rt(re.UNAVAILABLE,"Connection failed."));break;default:n7()}}finally{n6(lW,`RPC '${e}' ${i} completed.`)}});let l=JSON.stringify(r);n6(lW,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",l,n,15)})}Ro(e,t,n){let r=l$(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=nB(),o=nz(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.xmlHttpFactory=new nW({})),this.Eo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;let h=i.join("");n6(lW,`Creating RPC '${e}' stream ${r}: ${h}`,l);let c=s.createWebChannel(h,l),d=!1,p=!1,g=new lH({ro:t=>{p?n6(lW,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(n6(lW,`Opening RPC '${e}' stream ${r} transport.`),c.open(),d=!0),n6(lW,`RPC '${e}' stream ${r} sending:`,t),c.send(t))},oo:()=>c.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(c,nQ.EventType.OPEN,()=>{p||n6(lW,`RPC '${e}' stream ${r} transport opened.`)}),m(c,nQ.EventType.CLOSE,()=>{p||(p=!0,n6(lW,`RPC '${e}' stream ${r} transport closed`),g.wo())}),m(c,nQ.EventType.ERROR,t=>{p||(p=!0,n8(lW,`RPC '${e}' stream ${r} transport errored:`,t),g.wo(new rt(re.UNAVAILABLE,"The operation could not be completed")))}),m(c,nQ.EventType.MESSAGE,t=>{var n;if(!p){let i=t.data[0];i||n7();let s=i.error||(null==(n=i[0])?void 0:n.error);if(s){n6(lW,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=a[e];if(void 0!==t)return oc(t)}(t),i=s.message;void 0===n&&(n=re.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),p=!0,g.wo(new rt(n,i)),c.close()}else n6(lW,`RPC '${e}' stream ${r} received:`,i),g._o(i)}}),m(o,nG.STAT_EVENT,t=>{t.stat===nH.PROXY?n6(lW,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===nH.NOPROXY&&n6(lW,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{g.fo()},0),g}}function lY(){return"undefined"!=typeof window?window:null}function lX(){return"undefined"!=typeof document?document:null}function lJ(e){return new oD(e,!0)}class lZ{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();let t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-n);r>0&&n6("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class l0{constructor(e,t,n,r,i,s,o,a){this.ii=e,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new lZ(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===re.RESOURCE_EXHAUSTED?(n5(t.toString()),n5("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===re.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;let e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.Fo===t&&this.Zo(e,n)},t=>{e(()=>{let e=new rt(re.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)})})}Zo(e,t){let n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{n(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(e=>{n(()=>this.tu(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Go(){this.state=5,this.qo.No(async()=>{this.state=0,this.start()})}tu(e){return n6("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(n6("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class l1 extends l0{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:n7(),o=t.targetChange.targetIds||[],a=(i=t.targetChange.resumeToken,e.useProto3Json?(void 0===i||"string"==typeof i||n7(),iI.fromBase64String(i||"")):(void 0===i||i instanceof Uint8Array||n7(),iI.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new oT(s,o,a,l&&new rt(void 0===l.code?re.UNKNOWN:oc(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=oV(e,r.document.name),s=oM(r.document.updateTime),o=r.document.createTime?oM(r.document.createTime):rg.min(),a=new iY({mapValue:{fields:r.document.fields}}),l=iX.newFoundDocument(i,s,o,a);n=new ob(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=oV(e,r.document),s=r.readTime?oM(r.readTime):rg.min(),o=iX.newNoDocument(i,s);n=new ob([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=oV(e,r.document);n=new ob([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return n7();{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ou(r,i);n=new oI(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return rg.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?rg.min():t.readTime?oM(t.readTime):rg.min()}(e);return this.listener.nu(t,n)}su(e){let t={};t.database=oB(this.serializer),t.addTarget=function(e,t){let n,r=t.target;if((n=sd(r)?{documents:oW(e,r)}:{query:oQ(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=oO(e,t.resumeToken);let r=oR(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(rg.min())>0){n.readTime=oP(e,t.snapshotVersion.toTimestamp());let r=oR(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return n7()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){let t={};t.database=oB(this.serializer),t.removeTarget=e,this.Wo(t)}}class l2 extends l0{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){var t,n;if(e.streamToken||n7(),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||n7(),t.map(e=>{let t;return(t=e.updateTime?oM(e.updateTime):oM(n)).isEqual(rg.min())&&(t=oM(n)),new s2(t,e.transformResults||[])})):[]),i=oM(e.commitTime);return this.listener.cu(i,r)}return e.writeResults&&0!==e.writeResults.length&&n7(),this.ru=!0,this.listener.au()}hu(){let e={};e.database=oB(this.serializer),this.Wo(e)}uu(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>oG(this.serializer,e))};this.Wo(t)}}class l3 extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new rt(re.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Io(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rt(re.UNKNOWN,e.toString())})}vo(e,t,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.vo(e,t,n,i,s,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rt(re.UNKNOWN,e.toString())})}terminate(){this.lu=!0}}class l4{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(n5(t),this.mu=!1):n6("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class l6{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr(e=>{n.enqueueAndForget(async()=>{ui(this)&&(n6("RemoteStore","Restarting streams for network reachability change."),await async function(e){e.vu.add(4),await l8(e),e.bu.set("Unknown"),e.vu.delete(4),await l5(e)}(this))})}),this.bu=new l4(n,r)}}async function l5(e){if(ui(e))for(let t of e.Ru)await t(!0)}async function l8(e){for(let t of e.Ru)await t(!1)}function l9(e,t){e.Au.has(t.targetId)||(e.Au.set(t.targetId,t),ur(e)?un(e):u_(e).Ko()&&ue(e,t))}function l7(e,t){let n=u_(e);e.Au.delete(t),n.Ko()&&ut(e,t),0===e.Au.size&&(n.Ko()?n.jo():ui(e)&&e.bu.set("Unknown"))}function ue(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(rg.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}u_(e).su(t)}function ut(e,t){e.Vu.qt(t),u_(e).iu(t)}function un(e){e.Vu=new oC({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),u_(e).start(),e.bu.gu()}function ur(e){return ui(e)&&!u_(e).Uo()&&e.Au.size>0}function ui(e){return 0===e.vu.size}async function us(e){e.Au.forEach((t,n)=>{ue(e,t)})}async function uo(e,t){e.Vu=void 0,ur(e)?(e.bu.Iu(t),un(e)):e.bu.set("Unknown")}async function ua(e,t,n){if(e.bu.set("Online"),t instanceof oT&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Au.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Au.delete(r),e.Vu.removeTarget(r))}(e,t)}catch(n){n6("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ul(e,n)}else if(t instanceof ob?e.Vu.Ht(t):t instanceof oI?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(rg.min()))try{let t=await lI(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.Vu.ce(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.Au.get(t);if(!r)return;e.Au.set(t,r.withResumeToken(iI.EMPTY_BYTE_STRING,r.snapshotVersion)),ut(e,t);let i=new o0(r.target,t,n,r.sequenceNumber);ue(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){n6("RemoteStore","Failed to raise snapshot:",t),await ul(e,t)}}async function ul(e,t,n){if(!rU(t))throw t;e.vu.add(1),await l8(e),e.bu.set("Offline"),n||(n=()=>lI(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{n6("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await l5(e)})}function uu(e,t){return t().catch(n=>ul(e,n,t))}async function uh(e){var t;let n=uw(e),r=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;ui(t=e)&&t.Eu.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Eu.length&&n.jo();break}r=t.batchId,function(e,t){e.Eu.push(t);let n=uw(e);n.Ko()&&n.ou&&n.uu(t.mutations)}(e,t)}catch(t){await ul(e,t)}uc(e)&&ud(e)}function uc(e){return ui(e)&&!uw(e).Uo()&&e.Eu.length>0}function ud(e){uw(e).start()}async function uf(e){uw(e).hu()}async function up(e){let t=uw(e);for(let n of e.Eu)t.uu(n.mutations)}async function ug(e,t,n){let r=e.Eu.shift(),i=oa.from(r,t,n);await uu(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await uh(e)}async function um(e,t){t&&uw(e).ou&&await async function(e,t){var n;if(oh(n=t.code)&&n!==re.ABORTED){let n=e.Eu.shift();uw(e).Qo(),await uu(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await uh(e)}}(e,t),uc(e)&&ud(e)}async function uy(e,t){e.asyncQueue.verifyOperationInProgress(),n6("RemoteStore","RemoteStore received new credentials");let n=ui(e);e.vu.add(3),await l8(e),n&&e.bu.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.vu.delete(3),await l5(e)}async function uv(e,t){t?(e.vu.delete(2),await l5(e)):t||(e.vu.add(2),await l8(e),e.bu.set("Unknown"))}function u_(e){var t,n,r;return e.Su||(t=e.datastore,n=e.asyncQueue,r={uo:us.bind(null,e),ao:uo.bind(null,e),nu:ua.bind(null,e)},t.fu(),e.Su=new l1(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ru.push(async t=>{t?(e.Su.Qo(),ur(e)?un(e):e.bu.set("Unknown")):(await e.Su.stop(),e.Vu=void 0)})),e.Su}function uw(e){var t,n,r;return e.Du||(t=e.datastore,n=e.asyncQueue,r={uo:uf.bind(null,e),ao:um.bind(null,e),au:up.bind(null,e),cu:ug.bind(null,e)},t.fu(),e.Du=new l2(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ru.push(async t=>{t?(e.Du.Qo(),await uh(e)):(await e.Du.stop(),e.Eu.length>0&&(n6("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))})),e.Du}class ub{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){let s=new ub(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rt(re.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function uI(e,t){if(n5("AsyncQueue",`${t}: ${e}`),rU(e))return new rt(re.UNAVAILABLE,`${t}: ${e}`);throw e}class uT{constructor(e){this.comparator=e?(t,n)=>e(t,n)||rw.comparator(t.key,n.key):(e,t)=>rw.comparator(e.key,t.key),this.keyedMap=sM(),this.sortedSet=new ip(this.comparator)}static emptySet(e){return new uT(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uT)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new uT;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class uE{constructor(){this.Cu=new ip(rw.comparator)}track(e){let t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):n7():this.Cu=this.Cu.insert(t,e)}xu(){let e=[];return this.Cu.inorderTraversal((t,n)=>{e.push(n)}),e}}class uC{constructor(e,t,n,r,i,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new uC(e,t,uT.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sS(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class uS{constructor(){this.Nu=void 0,this.listeners=[]}}class uk{constructor(){this.queries=new sR(e=>sk(e),sS),this.onlineState="Unknown",this.ku=new Set}}async function ux(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i||(r=!0,i=new uS),r)try{i.Nu=await e.onListen(n)}catch(n){let e=uI(n,`Initialization of query '${sx(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.listeners.push(t),t.Mu(e.onlineState),i.Nu&&t.$u(i.Nu)&&uR(e)}async function uA(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i){let e=i.listeners.indexOf(t);e>=0&&(i.listeners.splice(e,1),r=0===i.listeners.length)}if(r)return e.queries.delete(n),e.onUnlisten(n)}function uN(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.listeners)e.$u(r)&&(n=!0);i.Nu=r}}n&&uR(e)}function uD(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.listeners)e.onError(n);e.queries.delete(t)}function uR(e){e.ku.forEach(e=>{e.next()})}class uP{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new uC(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){return!e.fromCache||(!this.options.Ku||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;let t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=uC.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class uO{constructor(e,t){this.Gu=e,this.byteLength=t}Qu(){return"metadata"in this.Gu}}class uM{constructor(e){this.serializer=e}rr(e){return oV(this.serializer,e)}ur(e){return e.metadata.exists?o$(this.serializer,e.document,!1):iX.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}cr(e){return oM(e)}}class uL{constructor(e){this.key=e}}class uF{constructor(e){this.key=e}}class uU{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=sq(),this.mutatedKeys=sq(),this.tc=sD(e),this.ec=new uT(this.tc)}get nc(){return this.Yu}sc(e,t){let n=t?t.ic:new uE,r=t?t.ec:this.ec,i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1,a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=sA(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),p=!0):this.rc(u,h)||(n.track({type:2,doc:h}),p=!0,(a&&this.tc(h,a)>0||l&&0>this.tc(h,l))&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),p=!0):u&&!h&&(n.track({type:1,doc:u}),p=!0,(a||l)&&(o=!0)),p&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;let i=e.ic.xu();i.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return n7()}};return n(e)-n(t)})(e.type,t.type)||this.tc(e.doc,t.doc)),this.oc(n);let s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return(this.Xu=o,0!==i.length||a)?{snapshot:new uC(this.query,e.ec,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new uE,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(e=>this.Yu=this.Yu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Yu=this.Yu.delete(e)),this.current=e.current)}uc(){if(!this.current)return[];let e=this.Zu;this.Zu=sq(),this.ec.forEach(e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))});let t=[];return e.forEach(e=>{this.Zu.has(e)||t.push(new uF(e))}),this.Zu.forEach(n=>{e.has(n)||t.push(new uL(n))}),t}hc(e){this.Yu=e.ir,this.Zu=sq();let t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return uC.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class uV{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class uq{constructor(e){this.key=e,this.fc=!1}}class uj{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new sR(e=>sk(e),sS),this._c=new Map,this.mc=new Set,this.gc=new ip(rw.comparator),this.yc=new Map,this.Ic=new lt,this.Tc={},this.Ec=new Map,this.Ac=aB.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function uB(e,t){let n,r,i=hs(e),s=i.wc.get(t);if(s)n=s.targetId,i.sharedClientState.addLocalQueryTarget(n),r=s.view.lc();else{let e=await lE(i.localStore,sT(t)),s=i.sharedClientState.addLocalQueryTarget(e.targetId);n=e.targetId,r=await uz(i,t,n,"current"===s,e.resumeToken),i.isPrimaryClient&&l9(i.remoteStore,e)}return r}async function uz(e,t,n,r,i){e.Rc=(t,n,r)=>(async function(e,t,n,r){let i=t.view.sc(n);i.zi&&(i=await lS(e.localStore,t.query,!1).then(({documents:e})=>t.view.sc(e,i)));let s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return u1(e,t.targetId,o.cc),o.snapshot})(e,t,n,r);let s=await lS(e.localStore,t,!0),o=new uU(t,s.ir),a=o.sc(s.documents),l=ow.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,l);u1(e,n,u.cc);let h=new uV(t,n,o);return e.wc.set(t,h),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}async function uK(e,t){let n=e.wc.get(t),r=e._c.get(n.targetId);if(r.length>1)return e._c.set(n.targetId,r.filter(e=>!sS(e,t))),void e.wc.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await lC(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),l7(e.remoteStore,n.targetId),uZ(e,n.targetId)}).catch(rR)):(uZ(e,n.targetId),await lC(e.localStore,n.targetId,!0))}async function u$(e,t,n){let r=ho(e);try{var i;let e,s=await function(e,t){let n,r,i=rp.now(),s=t.reduce((e,t)=>e.add(t.key),sq());return e.persistence.runTransaction("Locally write mutations","readwrite",o=>{let a=sP,l=sq();return e.Zi.getEntries(o,s).next(e=>{(a=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(o,a)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=sG(r.transform,e||null);null!=i&&(null===n&&(n=iY.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new oe(e.key,t,function e(t){let n=[];return ic(t.fields,(t,r)=>{let i=new r_([t]);if(i$(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new iw(n)}(t.value.mapValue),s3.exists(!0)))}return e.mutationQueue.addMutationBatch(o,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(o,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:sL(n)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),i=s.batchId,(e=r.Tc[r.currentUser.toKey()])||(e=new ip(rd)),e=e.insert(i,n),r.Tc[r.currentUser.toKey()]=e,await u3(r,s.changes),await uh(r.remoteStore)}catch(t){let e=uI(t,"Failed to persist write");n.reject(e)}}async function uG(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.Ji;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let s=e.Zi.newChangeBuffer({trackRemovals:!0});r=e.Ji;let o=[];t.targetChanges.forEach((s,a)=>{var l;let u=r.get(a);if(!u)return;o.push(e.Bs.removeMatchingKeys(i,s.removedDocuments,a).next(()=>e.Bs.addMatchingKeys(i,s.addedDocuments,a)));let h=u.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(a)?h=h.withResumeToken(iI.EMPTY_BYTE_STRING,rg.min()).withLastLimboFreeSnapshotVersion(rg.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),r=r.insert(a,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&o.push(e.Bs.updateTargetData(i,h))});let a=sP,l=sq();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&o.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),o.push(lT(i,s,t.documentUpdates).next(e=>{a=e.nr,l=e.sr})),!n.isEqual(rg.min())){let t=e.Bs.getLastRemoteSnapshotVersion(i).next(t=>e.Bs.setTargetsMetadata(i,i.currentSequenceNumber,n));o.push(t)}return rP.waitFor(o).next(()=>s.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,a,l)).next(()=>a)}).then(t=>(e.Ji=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.yc.get(n);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||n7(),t.addedDocuments.size>0?r.fc=!0:t.modifiedDocuments.size>0?r.fc||n7():t.removedDocuments.size>0&&(r.fc||n7(),r.fc=!1))}),await u3(e,n,t)}catch(e){await rR(e)}}function uH(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.wc.forEach((e,n)=>{let r=n.view.Mu(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.listeners)e.Mu(t)&&(n=!0)}),n&&uR(r),i.length&&e.dc.nu(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function uW(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.yc.get(t),i=r&&r.key;if(i){let n=new ip(rw.comparator);n=n.insert(i,iX.newNoDocument(i,rg.min()));let r=sq().add(i),s=new o_(rg.min(),new Map,new ip(rd),n,r);await uG(e,s),e.gc=e.gc.remove(i),e.yc.delete(t),u2(e)}else await lC(e.localStore,t,!1).then(()=>uZ(e,t,n)).catch(rR)}async function uQ(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),o=rP.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);null!==s||n7(),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sq();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))}));uJ(e,r,null),uX(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await u3(e,i)}catch(e){await rR(e)}}async function uY(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||n7(),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));uJ(e,t,n),uX(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await u3(e,i)}catch(e){await rR(e)}}function uX(e,t){(e.Ec.get(t)||[]).forEach(e=>{e.resolve()}),e.Ec.delete(t)}function uJ(e,t,n){let r=e.Tc[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Tc[e.currentUser.toKey()]=r}}function uZ(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e._c.get(t)))e.wc.delete(r),n&&e.dc.Pc(r,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach(t=>{e.Ic.containsKey(t)||u0(e,t)})}function u0(e,t){e.mc.delete(t.path.canonicalString());let n=e.gc.get(t);null!==n&&(l7(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),u2(e))}function u1(e,t,n){for(let r of n)r instanceof uL?(e.Ic.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(n6("SyncEngine","New document in limbo: "+n),e.mc.add(r),u2(e))}(e,r)):r instanceof uF?(n6("SyncEngine","Document no longer in limbo: "+r.key),e.Ic.removeReference(r.key,t),e.Ic.containsKey(r.key)||u0(e,r.key)):n7()}function u2(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){let t=e.mc.values().next().value;e.mc.delete(t);let n=new rw(ry.fromString(t)),r=e.Ac.next();e.yc.set(r,new uq(n)),e.gc=e.gc.insert(n,r),l9(e.remoteStore,new o0(sT(sy(n.path)),r,"TargetPurposeLimboResolution",r$.ct))}}async function u3(e,t,n){let r=[],i=[],s=[];e.wc.isEmpty()||(e.wc.forEach((o,a)=>{s.push(e.Rc(a,t,n).then(t=>{if((t||n)&&e.isPrimaryClient&&e.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);let e=lv.Li(a.targetId,t);i.push(e)}}))}),await Promise.all(s),e.dc.nu(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>rP.forEach(t,t=>rP.forEach(t.Fi,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>rP.forEach(t.Bi,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!rU(e))throw e;n6("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ji.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ji=e.Ji.insert(t,i)}}}(e.localStore,i))}async function u4(e,t){if(!e.currentUser.isEqual(t)){n6("SyncEngine","User change. New user:",t.toKey());let n=await lb(e.localStore,t);e.currentUser=t,e.Ec.forEach(e=>{e.forEach(e=>{e.reject(new rt(re.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ec.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await u3(e,n.er)}}function u6(e,t){let n=e.yc.get(t);if(n&&n.fc)return sq().add(n.key);{let n=sq(),r=e._c.get(t);if(!r)return n;for(let t of r){let r=e.wc.get(t);n=n.unionWith(r.view.nc)}return n}}async function u5(e,t){let n=await lS(e.localStore,t.query,!0),r=t.view.hc(n);return e.isPrimaryClient&&u1(e,t.targetId,r.cc),r}async function u8(e,t){return lx(e.localStore,t).then(t=>u3(e,t))}async function u9(e,t,n,r){var i;let s=await function(e,t){let n=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",r=>n.Sn(r,t).next(t=>t?e.localDocuments.getDocuments(r,t):rP.resolve(null)))}(e.localStore,t);null!==s?("pending"===n?await uh(e.remoteStore):"acknowledged"===n||"rejected"===n?(uJ(e,t,r||null),uX(e,t),i=e.localStore,i.mutationQueue.Cn(t)):n7(),await u3(e,s)):n6("SyncEngine","Cannot apply mutation batch with id: "+t)}async function u7(e,t){if(hs(e),ho(e),!0===t&&!0!==e.vc){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await he(e,t.toArray());for(let t of(e.vc=!0,await uv(e.remoteStore,!0),n))l9(e.remoteStore,t)}else if(!1===t&&!1!==e.vc){let t=[],n=Promise.resolve();e._c.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(uZ(e,i),lC(e.localStore,i,!0))),l7(e.remoteStore,i)}),await n,await he(e,t),e.yc.forEach((t,n)=>{l7(e.remoteStore,n)}),e.Ic.Ts(),e.yc=new Map,e.gc=new ip(rw.comparator),e.vc=!1,await uv(e.remoteStore,!1)}}async function he(e,t,n){let r=[],i=[];for(let n of t){let t,s=e._c.get(n);if(s&&0!==s.length)for(let n of(t=await lE(e.localStore,sT(s[0])),s)){let t=e.wc.get(n),r=await u5(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await lk(e.localStore,n);t=await lE(e.localStore,r),await uz(e,ht(r),n,!1,t.resumeToken)}r.push(t)}return e.dc.nu(i),r}function ht(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new sm(t,n,r,i,s,"F",e.startAt,e.endAt)}function hn(e){return e.localStore.persistence.$i()}async function hr(e,t,n,r){if(e.vc)return void n6("SyncEngine","Ignoring unexpected query state notification.");let i=e._c.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await lx(e.localStore,sN(i[0])),s=o_.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,iI.EMPTY_BYTE_STRING);await u3(e,r,s);break}case"rejected":await lC(e.localStore,t,!0),uZ(e,t,r);break;default:n7()}}async function hi(e,t,n){let r=hs(e);if(r.vc){for(let e of t){if(r._c.has(e)){n6("SyncEngine","Adding an already active target "+e);continue}let t=await lk(r.localStore,e),n=await lE(r.localStore,t);await uz(r,ht(t),n.targetId,!1,n.resumeToken),l9(r.remoteStore,n)}for(let e of n)r._c.has(e)&&await lC(r.localStore,e,!1).then(()=>{l7(r.remoteStore,e),uZ(r,e)}).catch(rR)}}function hs(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=uG.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=u6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uW.bind(null,e),e.dc.nu=uN.bind(null,e.eventManager),e.dc.Pc=uD.bind(null,e.eventManager),e}function ho(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=uQ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=uY.bind(null,e),e}class ha{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=lJ(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){var t,n;return t=this.persistence,n=new l_,new lw(t,n,e.initialUser,this.serializer)}createPersistence(e){return new la(lu.zs,this.serializer)}createSharedClientState(e){return new lj}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class hl extends ha{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return this.persistence.referenceDelegate instanceof lh||n7(),new aQ(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?aO.withCacheSize(this.cacheSizeBytes):aO.DEFAULT;return new la(e=>lh.zs(e,t),this.serializer)}}class hu extends ha{constructor(e,t,n){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Vc.initialize(this,e),await ho(this.Vc.syncEngine),await uh(this.Vc.remoteStore),await this.persistence.Ii(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){var t,n;return t=this.persistence,n=new l_,new lw(t,n,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new aQ(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new rK(t,this.persistence);return new rz(e.asyncQueue,n)}createPersistence(e){let t=ly(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?aO.withCacheSize(this.cacheSizeBytes):aO.DEFAULT;return new lp(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,lY(),lX(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new lj}}class hh extends hu{constructor(e,t){super(e,t,!1),this.Vc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Vc.syncEngine;this.sharedClientState instanceof lq&&(this.sharedClientState.syncEngine={jr:u9.bind(null,t),zr:hr.bind(null,t),Wr:hi.bind(null,t),$i:hn.bind(null,t),Qr:u8.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ii(async e=>{await u7(this.Vc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=lY();if(!lq.D(t))throw new rt(re.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=ly(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new lq(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class hc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>uH(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=u4.bind(null,this.syncEngine),await uv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new uk}createDatastore(e){var t;let n=lJ(e.databaseInfo.databaseId),r=new lQ(e.databaseInfo);return t=e.authCredentials,new l3(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new l6(t,n,e.asyncQueue,e=>uH(this.syncEngine,e,0),lz.D()?new lz:new lB)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){let a=new uj(e,t,n,r,i,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){n6("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await l8(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class hd{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):n5("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class hf{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new rt(re.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let t=await async function(e,t){let n=oB(e.serializer)+"/documents",r={documents:t.map(t=>oU(e.serializer,t))},i=await e.vo("BatchGetDocuments",n,r,t.length),s=new Map;i.forEach(t=>{var n;let r=(n=e.serializer,"found"in t?function(e,t){t.found||n7(),t.found.name,t.found.updateTime;let n=oV(e,t.found.name),r=oM(t.found.updateTime),i=t.found.createTime?oM(t.found.createTime):rg.min(),s=new iY({mapValue:{fields:t.found.fields}});return iX.newFoundDocument(n,r,i,s)}(n,t):"missing"in t?function(e,t){t.missing||n7(),t.readTime||n7();let n=oV(e,t.missing),r=oM(t.readTime);return iX.newNoDocument(n,r)}(n,t):n7());s.set(r.key.toString(),r)});let o=[];return t.forEach(e=>{let t=s.get(e.toString());t||n7(),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new oi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=rw.fromPath(t);this.mutations.push(new os(n,this.precondition(n)))}),await async function(e,t){let n=oB(e.serializer)+"/documents",r={writes:t.map(t=>oG(e.serializer,t))};await e.Io("Commit",n,r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw n7();t=rg.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new rt(re.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(rg.min())?s3.exists(!1):s3.updateTime(t):s3.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(rg.min()))throw new rt(re.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return s3.updateTime(t)}return s3.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class hp{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Bc=n.maxAttempts,this.qo=new lZ(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){this.qo.No(async()=>{let e=new hf(this.datastore),t=this.qc(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Uc(e)}))}).catch(e=>{this.Uc(e)})})}qc(e){try{let t=this.updateFunction(e);return!rG(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Lc(),Promise.resolve()))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!oh(t)}return!1}}class hg{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=n1.UNAUTHENTICATED,this.clientId=rc.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{n6("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(n6("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new rt(re.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=uI(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function hm(e,t){e.asyncQueue.verifyOperationInProgress(),n6("FirestoreClient","Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await lb(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function hy(e,t){e.asyncQueue.verifyOperationInProgress();let n=await h_(e);n6("FirestoreClient","Initializing OnlineComponentProvider");let r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>uy(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>uy(t.remoteStore,n)),e._onlineComponents=t}function hv(e){return"FirebaseError"===e.name?e.code===re.FAILED_PRECONDITION||e.code===re.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function h_(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){n6("FirestoreClient","Using user provided OfflineComponentProvider");try{await hm(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!hv(t))throw t;n8("Error using user provided cache. Falling back to memory cache: "+t),await hm(e,new ha)}}else n6("FirestoreClient","Using default OfflineComponentProvider"),await hm(e,new ha);return e._offlineComponents}async function hw(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(n6("FirestoreClient","Using user provided OnlineComponentProvider"),await hy(e,e._uninitializedComponentsProvider._online)):(n6("FirestoreClient","Using default OnlineComponentProvider"),await hy(e,new hc))),e._onlineComponents}async function hb(e){let t=await hw(e),n=t.eventManager;return n.onListen=uB.bind(null,t.syncEngine),n.onUnlisten=uK.bind(null,t.syncEngine),n}function hI(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let hT=new Map;function hE(e,t,n){if(!n)throw new rt(re.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function hC(e){if(!rw.isDocumentKey(e))throw new rt(re.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function hS(e){if(rw.isDocumentKey(e))throw new rt(re.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function hk(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":n7()}function hx(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new rt(re.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=hk(e);throw new rt(re.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class hA{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new rt(re.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new rt(re.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new rt(re.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hI(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rt(re.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new rt(re.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new rt(re.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hN{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hA({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new rt(re.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rt(re.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hA(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ri;switch(e.type){case"firstParty":return new rl(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rt(re.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=hT.get(e);t&&(n6("ComponentProvider","Removing Datastore"),hT.delete(e),t.terminate())}(this),Promise.resolve()}}class hD{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hP(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hD(this.firestore,e,this._key)}}class hR{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new hR(this.firestore,e,this._query)}}class hP extends hR{constructor(e,t,n){super(e,t,sy(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new hD(this.firestore,null,new rw(e))}withConverter(e){return new hP(this.firestore,e,this._path)}}function hO(e,t,...n){if(e=(0,p.Ku)(e),hE("collection","path",t),e instanceof hN){let r=ry.fromString(t,...n);return hS(r),new hP(e,null,r)}{if(!(e instanceof hD||e instanceof hP))throw new rt(re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(ry.fromString(t,...n));return hS(r),new hP(e.firestore,null,r)}}function hM(e,t,...n){if(e=(0,p.Ku)(e),1==arguments.length&&(t=rc.A()),hE("doc","path",t),e instanceof hN){let r=ry.fromString(t,...n);return hC(r),new hD(e,null,new rw(r))}{if(!(e instanceof hD||e instanceof hP))throw new rt(re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(ry.fromString(t,...n));return hC(r),new hD(e.firestore,e instanceof hP?e.converter:null,new rw(r))}}class hL{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new lZ(this,"async_queue_retry"),this.Xc=()=>{let e=lX();e&&n6("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};let e=lX();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;let t=lX();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});let t=new rn;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!rU(e))throw e;n6("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No(()=>this.ea())}}ta(e){let t=this.Gc.then(()=>(this.Hc=!0,e().catch(e=>{let t;throw this.Wc=e,this.Hc=!1,n5("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.Hc=!1,e))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);let r=ub.createAndSchedule(this,e,t,n,e=>this.na(e));return this.zc.push(r),r}Zc(){this.Wc&&n7()}verifyOperationInProgress(){}async sa(){let e;do e=this.Gc,await e;while(e!==this.Gc)}ia(e){for(let t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{for(let t of(this.zc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.zc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){let t=this.zc.indexOf(e);this.zc.splice(t,1)}}function hF(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class hU extends hN{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new hL,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||hj(this),this._firestoreClient.terminate()}}function hV(e,t){let n="object"==typeof e?e:(0,h.Sx)(),r=(0,h.j6)(n,"firestore").getImmediate({identifier:"string"==typeof e?e:t||"(default)"});if(!r._initialized){let e=(0,p.yU)("firestore");e&&function(e,t,n,r={}){var i;let s=(e=hx(e,hN))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&n8("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=n1.MOCK_USER;else{t=(0,p.Fy)(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new rt(re.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new n1(s)}e._authCredentials=new rs(new rr(t,n))}}(r,...e)}return r}function hq(e){return e._firestoreClient||hj(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function hj(e){var t,n,r,i,s;let o=e._freezeSettings(),a=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new iN(i,s,e._persistenceKey,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,hI(o.experimentalLongPollingOptions),o.useFetchStreams));e._firestoreClient=new hg(e._authCredentials,e._appCheckCredentials,e._queue,a),(null==(n=o.cache)?void 0:n._offlineComponentProvider)&&(null==(r=o.cache)?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:o.cache.kind,_offline:o.cache._offlineComponentProvider,_online:o.cache._onlineComponentProvider})}class hB{constructor(e){this._byteString=e}static fromBase64String(e){try{return new hB(iI.fromBase64String(e))}catch(e){throw new rt(re.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new hB(iI.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class hz{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rt(re.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new r_(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class hK{constructor(e){this._methodName=e}}class h${constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rt(re.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rt(re.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return rd(this._lat,e._lat)||rd(this._long,e._long)}}let hG=/^__.*__$/;class hH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new oe(e,this.data,this.fieldMask,t,this.fieldTransforms):new s7(e,this.data,t,this.fieldTransforms)}}class hW{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new oe(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hQ(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw n7()}}class hY{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new hY(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}da(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return cr(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(hQ(this.ca)&&hG.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class hX{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||lJ(e)}ya(e,t,n,r=!1){return new hY({ca:e,methodName:t,ga:n,path:r_.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hJ(e){let t=e._freezeSettings(),n=lJ(e._databaseId);return new hX(e._databaseId,!!t.ignoreUndefinedProperties,n)}function hZ(e,t,n,r,i,s={}){let o,a,l=e.ya(s.merge||s.mergeFields?2:0,t,n,i);h7("Data must be an object, but it was:",l,r);let u=h8(r,l);if(s.merge)o=new iw(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=ce(t,r,n);if(!l.contains(i))throw new rt(re.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);ci(e,i)||e.push(i)}o=new iw(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new hH(new iY(u),o,a)}class h0 extends hK{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof h0}}function h1(e,t,n){return new hY({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class h2 extends null{_toFieldTransform(e){return new s1(e.path,new sH)}isEqual(e){return e instanceof h2}}function h3(e,t,n,r){let i=e.ya(1,t,n);h7("Data must be an object, but it was:",i,r);let s=[],o=iY.empty();return ic(r,(e,r)=>{let a=cn(t,e,n);r=(0,p.Ku)(r);let l=i.da(a);if(r instanceof h0)s.push(a);else{let e=h5(r,l);null!=e&&(s.push(a),o.set(a,e))}}),new hW(o,new iw(s),i.fieldTransforms)}function h4(e,t,n,r,i,s){let o=e.ya(1,t,n),a=[ce(t,r,n)],l=[i];if(s.length%2!=0)throw new rt(re.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(ce(t,s[e])),l.push(s[e+1]);let u=[],h=iY.empty();for(let e=a.length-1;e>=0;--e)if(!ci(u,a[e])){let t=a[e],n=l[e];n=(0,p.Ku)(n);let r=o.da(t);if(n instanceof h0)u.push(t);else{let e=h5(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new hW(h,new iw(u),o.fieldTransforms)}function h6(e,t,n,r=!1){return h5(n,e.ya(r?4:3,t))}function h5(e,t){if(h9(e=(0,p.Ku)(e)))return h7("Unsupported field value:",t,e),h8(e,t);if(e instanceof hK)return function(e,t){if(!hQ(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=h5(i,t.wa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}var n=e;if(null===(n=(0,p.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return sK(t.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){let e=rp.fromDate(n);return{timestampValue:oP(t.serializer,e)}}if(n instanceof rp){let e=new rp(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:oP(t.serializer,e)}}if(n instanceof h$)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof hB)return{bytesValue:oO(t.serializer,n._byteString)};if(n instanceof hD){let e=t.databaseId,r=n.firestore._databaseId;if(!r.isEqual(e))throw t._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${e.projectId}/${e.database}`);return{referenceValue:oL(n.firestore._databaseId||t.databaseId,n._key.path)}}throw t._a(`Unsupported field value: ${hk(n)}`)}function h8(e,t){let n={};return id(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ic(e,(e,r)=>{let i=h5(r,t.ha(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function h9(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof rp||e instanceof h$||e instanceof hB||e instanceof hD||e instanceof hK)}function h7(e,t,n){if(!h9(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let r=hk(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function ce(e,t,n){if((t=(0,p.Ku)(t))instanceof hz)return t._internalPath;if("string"==typeof t)return cn(e,t);throw cr("Field path arguments must be of type string or ",e,!1,void 0,n)}let ct=RegExp("[~\\*/\\[\\]]");function cn(e,t,n){if(t.search(ct)>=0)throw cr(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new hz(...t.split("."))._internalPath}catch(r){throw cr(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function cr(e,t,n,r,i){let s=r&&!r.isEmpty(),o=void 0!==i,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new rt(re.INVALID_ARGUMENT,a+e+l)}function ci(e,t){return e.some(e=>e.isEqual(t))}class cs{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new hD(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new co(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ca("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class co extends cs{data(){return super.data()}}function ca(e,t){return"string"==typeof t?cn(e,t):t instanceof hz?t._internalPath:t._delegate._internalPath}function cl(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rt(re.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cu{}class ch extends cu{}function cc(e,t,...n){let r=[];for(let i of(t instanceof cu&&r.push(t),function(e){let t=e.filter(e=>e instanceof cp).length,n=e.filter(e=>e instanceof cd).length;if(t>1||t>0&&n>0)throw new rt(re.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class cd extends ch{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new cd(e,t,n)}_apply(e){let t=this._parse(e);return cT(e._query,t),new hR(e.firestore,e.converter,sE(e._query,t))}_parse(e){let t=hJ(e.firestore);return function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new rt(re.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){cI(o,s);let t=[];for(let n of o)t.push(cb(r,e,n));a={arrayValue:{values:t}}}else a=cb(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||cI(o,s),a=h6(n,t,o,"in"===s||"not-in"===s);return i3.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function cf(e,t,n){let r=ca("where",e);return cd._create(r,t,n)}class cp extends cu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new cp(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:i4.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())cT(n,e),n=sE(n,e)}(e._query,t),new hR(e.firestore,e.converter,sE(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class cg extends ch{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new cg(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new rt(re.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rt(re.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");let r=new i1(t,n);return function(e,t){if(null===s_(e)){let n=sw(e);null!==n&&cE(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new hR(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new sm(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function cm(e,t="asc"){let n=ca("orderBy",e);return cg._create(n,t)}class cy extends ch{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new cy(e,t,n)}_apply(e){return new hR(e.firestore,e.converter,sC(e._query,this._limit,this._limitType))}}class cv extends ch{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new cv(e,t,n)}_apply(e){var t;let n=cw(e,this.type,this._docOrFields,this._inclusive);return new hR(e.firestore,e.converter,(t=e._query,new sm(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}class c_ extends ch{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new c_(e,t,n)}_apply(e){var t;let n=cw(e,this.type,this._docOrFields,this._inclusive);return new hR(e.firestore,e.converter,(t=e._query,new sm(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function cw(e,t,n,r){if(n[0]=(0,p.Ku)(n[0]),n[0]instanceof cs)return function(e,t,n,r,i){if(!r)throw new rt(re.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of sI(e))if(n.field.isKeyField())s.push(iq(t,r.key));else{let e=r.data.field(n.field);if(ik(e))throw new rt(re.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new rt(re.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new iJ(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=hJ(e.firestore);return function(e,t,n,r,i,s){let o=e.explicitOrderBy;if(i.length>o.length)throw new rt(re.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let s=0;s<i.length;s++){let l=i[s];if(o[s].field.isKeyField()){if("string"!=typeof l)throw new rt(re.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!sb(e)&&-1!==l.indexOf("/"))throw new rt(re.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(ry.fromString(l));if(!rw.isDocumentKey(n))throw new rt(re.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new rw(n);a.push(iq(t,i))}else{let e=h6(n,r,l);a.push(e)}}return new iJ(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function cb(e,t,n){if("string"==typeof(n=(0,p.Ku)(n))){if(""===n)throw new rt(re.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sb(t)&&-1!==n.indexOf("/"))throw new rt(re.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(ry.fromString(n));if(!rw.isDocumentKey(r))throw new rt(re.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return iq(e,new rw(r))}if(n instanceof hD)return iq(e,n._key);throw new rt(re.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hk(n)}.`)}function cI(e,t){if(!Array.isArray(e)||0===e.length)throw new rt(re.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function cT(e,t){if(t.isInequality()){let n=sw(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new rt(re.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);let i=s_(e);null!==i&&cE(e,r,i)}let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new rt(re.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new rt(re.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function cE(e,t,n){if(!n.isEqual(t))throw new rt(re.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class cC{convertValue(e,t="none"){switch(iO(e)){case 0:return null;case 1:return e.booleanValue;case 2:return iC(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(iS(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw n7()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return ic(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new h$(iC(e.latitude),iC(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=ix(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(iA(e));default:return null}}convertTimestamp(e){let t=iE(e);return new rp(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ry.fromString(e);oZ(n)||n7();let r=new iD(n.get(1),n.get(3)),i=new rw(n.popFirst(5));return r.isEqual(t)||n5(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function cS(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class ck extends cC{constructor(e){super(),this.firestore=e}convertBytes(e){return new hB(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new hD(this.firestore,null,t)}}class cx{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class cA extends cs{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new cN(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(ca("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class cN extends cA{data(e={}){return super.data(e)}}class cD{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new cx(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new cN(this._firestore,this._userDataWriter,n.key,n,new cx(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rt(re.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new cN(e._firestore,e._userDataWriter,n.doc.key,n.doc,new cx(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new cN(e._firestore,e._userDataWriter,t.doc.key,t.doc,new cx(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return n7()}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function cR(e){e=hx(e,hD);let t=hx(e.firestore,hU);return(function(e,t,n={}){let r=new rn;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new hd({next:s=>{t.enqueueAndForget(()=>uA(e,o));let a=s.docs.has(n);!a&&s.fromCache?i.reject(new rt(re.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new rt(re.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new uP(sy(n.path),s,{includeMetadataChanges:!0,Ku:!0});return ux(e,o)})(await hb(e),e.asyncQueue,t,n,r)),r.promise})(hq(t),e._key).then(n=>cF(t,e,n))}class cP extends cC{constructor(e){super(),this.firestore=e}convertBytes(e){return new hB(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new hD(this.firestore,null,t)}}function cO(e){e=hx(e,hR);let t=hx(e.firestore,hU),n=hq(t),r=new cP(t);return cl(e._query),(function(e,t,n={}){let r=new rn;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new uP(n,new hd({next:n=>{t.enqueueAndForget(()=>uA(e,s)),n.fromCache&&"server"===r.source?i.reject(new rt(re.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),{includeMetadataChanges:!0,Ku:!0});return ux(e,s)})(await hb(e),e.asyncQueue,t,n,r)),r.promise})(n,e._query).then(n=>new cD(t,r,e,n))}function cM(e,t,n,...r){e=hx(e,hD);let i=hx(e.firestore,hU),s=hJ(i);return function(e,t){var n=hq(e);let r=new rn;return n.asyncQueue.enqueueAndForget(async()=>u$(await hw(n).then(e=>e.syncEngine),t,r)),r.promise}(i,[("string"==typeof(t=(0,p.Ku)(t))||t instanceof hz?h4(s,"updateDoc",e._key,t,n,r):h3(s,"updateDoc",e._key,t)).toMutation(e._key,s3.exists(!0))])}function cL(e,...t){let n,r,i;e=(0,p.Ku)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[0]||hF(t[o])||(s=t[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges};if(hF(t[o])){let e=t[o];t[o]=null==(l=e.next)?void 0:l.bind(e),t[o+1]=null==(u=e.error)?void 0:u.bind(e),t[o+2]=null==(h=e.complete)?void 0:h.bind(e)}if(e instanceof hD)r=hx(e.firestore,hU),i=sy(e._key.path),n={next:n=>{t[o]&&t[o](cF(r,e,n))},error:t[o+1],complete:t[o+2]};else{let s=hx(e,hR);r=hx(s.firestore,hU),i=s._query;let a=new cP(r);n={next:e=>{t[o]&&t[o](new cD(r,a,s,e))},error:t[o+1],complete:t[o+2]},cl(e._query)}var l,u,h,c=hq(r),d=i;let g=new hd(n),m=new uP(d,g,a);return c.asyncQueue.enqueueAndForget(async()=>ux(await hb(c),m)),()=>{g.Dc(),c.asyncQueue.enqueueAndForget(async()=>uA(await hb(c),m))}}function cF(e,t,n){let r=n.docs.get(t._key),i=new cP(e);return new cA(e,i,t._key,r,new cx(n.hasPendingWrites,n.fromCache),t.converter)}class cU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new hc,this._offlineComponentProvider=new hu(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}let cV={maxAttempts:5};function cq(e,t){if((e=(0,p.Ku)(e)).firestore!==t)throw new rt(re.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class cj extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=hJ(e)}get(e){let t=cq(e,this._firestore),n=new ck(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return n7();let r=e[0];if(r.isFoundDocument())return new cs(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new cs(this._firestore,n,t._key,null,t.converter);throw n7()})}set(e,t,n){let r=cq(e,this._firestore),i=cS(r.converter,t,n),s=hZ(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=cq(e,this._firestore);return i="string"==typeof(t=(0,p.Ku)(t))||t instanceof hz?h4(this._dataReader,"Transaction.update",s._key,t,n,r):h3(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=cq(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=cq(e,this._firestore),n=new cP(this._firestore);return super.get(e).then(e=>new cA(this._firestore,n,t._key,e._document,new cx(!1,!1),t.converter))}}function cB(e,t,n){e=hx(e,hU);let r=Object.assign(Object.assign({},cV),n);if(r.maxAttempts<1)throw new rt(re.INVALID_ARGUMENT,"Max attempts must be at least 1");return function(e,t,n){let r=new rn;return e.asyncQueue.enqueueAndForget(async()=>{let i=await hw(e).then(e=>e.datastore);new hp(e.asyncQueue,i,n,t,r).run()}),r.promise}(hq(e),n=>t(new cj(e,n)),r)}!function(e,t=!0){n2=h.MF,(0,h.om)(new c.uA("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new hU(new ro(e.getProvider("auth-internal")),new rh(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rt(re.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iD(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,h.KO)(n0,"3.13.0",void 0),(0,h.KO)(n0,"3.13.0","esm2017")}()},5861:e=>{!function(){var t={229:function(e){var t,n,r,i=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}var l=[],u=!1,h=-1;function c(){u&&r&&(u=!1,r.length?l=r.concat(l):h=-1,l.length&&d())}function d(){if(!u){var e=a(c);u=!0;for(var t=l.length;t;){for(r=l,l=[];++h<t;)r&&r[h].run();h=-1,t=l.length}r=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||u||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}},o=!0;try{t[e](s,s.exports,r),o=!1}finally{o&&delete n[e]}return s.exports}r.ab="//",e.exports=r(229)}()},5965:(e,t,n)=>{"use strict";let r,i,s,o,a,l,u,h,c,d,p,g;n.d(t,{qB:()=>ae,sh:()=>an});var m,y,v,_,w,b=n(4232);n(5282);var I=n(6614),T=n(8308),E=n(9207),C=n(6525),S=n(5364);let k="@firebase/database",x="0.14.4",A="";class N{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,E.As)(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,E.$L)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class D{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,E.gR)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let R=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new N(t)}}catch(e){}return new D},P=R("localStorage"),O=R("sessionStorage"),M=new C.Vy("@firebase/database"),L=function(){let e=1;return function(){return e++}}(),F=function(e){let t=(0,E.kj)(e),n=new E.gz;n.update(t);let r=n.digest();return E.K3.encodeByteArray(r)},U=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=U.apply(null,r):"object"==typeof r?t+=(0,E.As)(r):t+=r,t+=" "}return t},V=null,q=!0,j=function(e,t){(0,E.vA)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(M.logLevel=C.$b.VERBOSE,V=M.log.bind(M),t&&O.set("logging_enabled",!0)):"function"==typeof e?V=e:(V=null,O.remove("logging_enabled"))},B=function(...e){if(!0===q&&(q=!1,null===V&&!0===O.get("logging_enabled")&&j(!0)),V){let t=U.apply(null,e);V(t)}},z=function(e){return function(...t){B(e,...t)}},K=function(...e){let t="FIREBASE INTERNAL ERROR: "+U(...e);M.error(t)},$=function(...e){let t=`FIREBASE FATAL ERROR: ${U(...e)}`;throw M.error(t),Error(t)},G=function(...e){let t="FIREBASE WARNING: "+U(...e);M.warn(t)},H=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&G("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},W=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Q=function(e){if((0,E.$g)()||"complete"===document.readyState)e();else{let t=!1,n=function(){if(!document.body)return void setTimeout(n,Math.floor(10));t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},Y="[MIN_NAME]",X="[MAX_NAME]",J=function(e,t){if(e===t)return 0;{if(e===Y||t===X)return -1;if(t===Y||e===X)return 1;let n=eo(e),r=eo(t);if(null!==n)if(null!==r)return n-r==0?e.length-t.length:n-r;else return -1;return null!==r?1:e<t?-1:1}},Z=function(e,t){return e===t?0:e<t?-1:1},ee=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+(0,E.As)(t))},et=function(e){if("object"!=typeof e||null===e)return(0,E.As)(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=(0,E.As)(t[r]),n+=":",n+=et(e[t[r]]);return n+"}"},en=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function er(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let ei=function(e){let t,n,r,i,s;(0,E.vA)(!W(e),"Invalid JSON number");0===e?(n=0,r=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-0x10000000000000)):(n=0,r=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},es=RegExp("^-?(0*)\\d{1,10}$"),eo=function(e){if(es.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},ea=function(e){try{e()}catch(e){setTimeout(()=>{throw G("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},el=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class eu{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){G(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class eh{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(B("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',G(e)}}class ec{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ec.OWNER="owner";let ed=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ef="websocket",ep="long_polling";class eg{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=P.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&P.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function em(e,t,n){let r;if((0,E.vA)("string"==typeof t,"typeof type must == string"),(0,E.vA)("object"==typeof n,"typeof params must == object"),t===ef)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===ep)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let i=[];return er(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class ey{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,E.gR)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,E.A4)(this.counters_)}}let ev={},e_={};function ew(e){let t=e.toString();return ev[t]||(ev[t]=new ey),ev[t]}class eb{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&ea(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let eI="start";class eT{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=z(e),this.stats_=ew(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),em(t,ep,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new eb(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),Q(()=>{if(this.isClosed_)return;this.scriptTagHolder=new eE((...e)=>{let[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===eI)this.id=n,this.password=r;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[eI]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&ed.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){eT.forceAllow_=!0}static forceDisallow(){eT.forceDisallow_=!0}static isAvailable(){return!(0,E.$g)()&&(!!eT.forceAllow_||!eT.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=(0,E.As)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=en((0,E.KA)(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,E.$g)())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=(0,E.As)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class eE{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,E.$g)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=L(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=eE.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');let r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){B("frame writing exception"),e.stack&&B(e.stack),B(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||B("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){(0,E.$g)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{B("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let eC=null;"undefined"!=typeof MozWebSocket?eC=MozWebSocket:"undefined"!=typeof WebSocket&&(eC=WebSocket);class eS{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=z(this.connId),this.stats_=ew(t),this.connURL=eS.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){let s={};return s.v="5",!(0,E.$g)()&&"undefined"!=typeof location&&location.hostname&&ed.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),em(e,ef,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,P.set("previous_websocket_failure",!0);try{let e;if((0,E.$g)()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${A}/${S.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=S.env,r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new eC(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){eS.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==eC&&!eS.forceDisallow_}static previouslyFailed(){return P.isInMemoryStorage||!0===P.get("previous_websocket_failure")}markConnectionHealthy(){P.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=(0,E.$L)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,E.vA)(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=(0,E.As)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=en(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}eS.responsesRequiredToBeHealthy=2,eS.healthyTimeout=3e4;class ek{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[eT,eS]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){let t=eS&&eS.isAvailable(),n=t&&!eS.previouslyFailed();if(e.webSocketOnly&&(t||G("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[eS];else{let e=this.transports_=[];for(let t of ek.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ek.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ek.globalTransportInitialized_=!1;class ex{constructor(e,t,n,r,i,s,o,a,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=z("c:"+this.id+":"),this.transportManager_=new ek(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=el(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=ee("t",e),n=ee("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=ee("t",e),n=ee("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=ee("t",e);if("d"in e){let n=e.d;if("h"===t){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?K("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):K("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&G("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),el(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):el(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(P.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class eA{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class eN{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,E.vA)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){(0,E.vA)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class eD extends eN{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,E.jZ)()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new eD}getInitialEvent(e){return(0,E.vA)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class eR{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function eP(){return new eR("")}function eO(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function eM(e){return e.pieces_.length-e.pieceNum_}function eL(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new eR(e.pieces_,t)}function eF(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function eU(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function eV(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new eR(t,0)}function eq(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof eR)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new eR(n,0)}function ej(e){return e.pieceNum_>=e.pieces_.length}function eB(e,t){let n=eO(e),r=eO(t);if(null===n)return t;if(n===r)return eB(eL(e),eL(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ez(e,t){let n=eU(e,0),r=eU(t,0);for(let e=0;e<n.length&&e<r.length;e++){let t=J(n[e],r[e]);if(0!==t)return t}return n.length===r.length?0:n.length<r.length?-1:1}function eK(e,t){if(eM(e)!==eM(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function e$(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(eM(e)>eM(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class eG{constructor(e,t){this.errorPrefix_=t,this.parts_=eU(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=(0,E.OE)(this.parts_[e]);eH(this)}}function eH(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+eW(e))}function eW(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class eQ extends eN{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new eQ}getInitialEvent(e){return(0,E.vA)("visible"===e,"Unknown event type: "+e),[this.visible_]}}class eY extends eA{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=eY.nextPersistentConnectionId_++,this.log_=z("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!(0,E.$g)())throw Error("Auth override specified in options, but not supported on non Node.js platforms");eQ.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&eD.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_((0,E.As)(i)),(0,E.vA)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new E.cY,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),(0,E.vA)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,E.vA)(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);let i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{let s=i.d,o=i.s;eY.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&(0,E.gR)(e,"w")){let n=(0,E.yw)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();G(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,E.qc)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=(0,E.Cv)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,E.vA)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);let i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,E.As)(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):K("Unrecognized action received from server: "+(0,E.As)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,E.vA)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=new Date().getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+eY.nextConnectionId_++,i=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){(0,E.vA)(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,u]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?B("getToken() completed but was canceled"):(B("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=u&&u.token,o=new ex(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{G(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&G(e),a())}}}interrupt(e){B("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){B("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,E.Im)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>et(e)).join("$"):"default";let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){let n,r=new eR(e).toString();if(this.listens.has(r)){let e=this.listens.get(r);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(r)}else n=void 0;return n}onAuthRevoked_(e,t){B("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){B("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";(0,E.$g)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+A.replace(/\./g,"-")]=1,(0,E.jZ)()?e["framework.cordova"]=1:(0,E.lV)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=eD.getInstance().currentlyOnline();return(0,E.Im)(this.interruptReasons_)&&e}}eY.nextPersistentConnectionId_=0,eY.nextConnectionId_=0;class eX{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new eX(e,t)}}class eJ{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new eX(Y,e),r=new eX(Y,t);return 0!==this.compare(n,r)}minPost(){return eX.MIN}}class eZ extends eJ{static get __EMPTY_NODE(){return r}static set __EMPTY_NODE(e){r=e}compare(e,t){return J(e.name,t.name)}isDefinedOn(e){throw(0,E.Hk)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return eX.MIN}maxPost(){return new eX(X,r)}makePost(e,t){return(0,E.vA)("string"==typeof e,"KeyIndex indexValue must always be a string."),new eX(e,r)}toString(){return".key"}}let e0=new eZ;class e1{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class e2{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:e2.RED,this.left=null!=r?r:e4.EMPTY_NODE,this.right=null!=i?i:e4.EMPTY_NODE}copy(e,t,n,r,i){return new e2(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return e4.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return e4.EMPTY_NODE;else r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,e2.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,e2.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}e2.RED=!0,e2.BLACK=!1;class e3{copy(e,t,n,r,i){return this}insert(e,t,n){return new e2(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class e4{constructor(e,t=e4.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new e4(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,e2.BLACK,null,null))}remove(e){return new e4(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,e2.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(r)return r.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new e1(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new e1(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new e1(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new e1(this.root_,null,this.comparator_,!0,e)}}function e6(e,t){return J(e.name,t.name)}function e5(e,t){return J(e,t)}e4.EMPTY_NODE=new e3;let e8=function(e){return"number"==typeof e?"number:"+ei(e):"string:"+e},e9=function(e){if(e.isLeafNode()){let t=e.val();(0,E.vA)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,E.gR)(t,".sv"),"Priority must be a string or number.")}else(0,E.vA)(e===i||e.isEmpty(),"priority of unexpected type.");(0,E.vA)(e===i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class e7{constructor(e,t=e7.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,E.vA)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),e9(this.priorityNode_)}static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new e7(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:e7.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ej(e)?this:".priority"===eO(e)?this.priorityNode_:e7.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:e7.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=eO(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,E.vA)(".priority"!==n||1===eM(e),".priority must be the last token in a path"),this.updateImmediateChild(n,e7.__childrenNodeConstructor.EMPTY_NODE.updateChild(eL(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+e8(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=ei(this.value_):e+=this.value_,this.lazyHash_=F(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===e7.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof e7.__childrenNodeConstructor?-1:((0,E.vA)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,r=e7.VALUE_TYPE_ORDER.indexOf(t),i=e7.VALUE_TYPE_ORDER.indexOf(n);return((0,E.vA)(r>=0,"Unknown leaf type: "+t),(0,E.vA)(i>=0,"Unknown leaf type: "+n),r!==i)?i-r:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}e7.VALUE_TYPE_ORDER=["object","boolean","number","string"];class te extends eJ{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?J(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return eX.MIN}maxPost(){return new eX(X,new e7("[PRIORITY-POST]",a))}makePost(e,t){return new eX(t,new e7("[PRIORITY-POST]",o(e)))}toString(){return".priority"}}let tt=new te,tn=Math.log(2);class tr{constructor(e){this.count=parseInt(Math.log(e+1)/tn,10),this.current_=this.count-1;let t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let ti=function(e,t,n,r){e.sort(t);let i=function(t,r){let s,o,a=r-t;if(0===a)return null;if(1===a)return s=e[t],new e2(n?n(s):s,s.node,e2.BLACK,null,null);{let o=parseInt(a/2,10)+t,l=i(t,o),u=i(o+1,r);return s=e[o],new e2(n?n(s):s,s.node,e2.BLACK,l,u)}};return new e4(r||t,function(t){let r=null,s=null,o=e.length,a=function(t,r){let s=o-t,a=o;o-=t;let u=i(s+1,a),h=e[s];l(new e2(n?n(h):h,h.node,r,null,u))},l=function(e){r?r.left=e:s=e,r=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,e2.BLACK):(a(r,e2.BLACK),a(r,e2.RED))}return s}(new tr(e.length)))},ts={};class to{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,E.vA)(ts&&tt,"ChildrenNode.ts has not been loaded"),l=l||new to({".priority":ts},{".priority":tt})}get(e){let t=(0,E.yw)(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof e4?t:null}hasIndex(e){return(0,E.gR)(this.indexSet_,e.toString())}addIndex(e,t){let n;(0,E.vA)(e!==e0,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(eX.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();n=i?ti(r,e.getCompare()):ts;let a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;let u=Object.assign({},this.indexes_);return u[a]=n,new to(u,l)}addToIndexes(e,t){return new to((0,E.kH)(this.indexes_,(n,r)=>{let i=(0,E.yw)(this.indexSet_,r);if((0,E.vA)(i,"Missing index implementation for "+r),n===ts)if(!i.isDefinedOn(e.node))return ts;else{let n=[],r=t.getIterator(eX.Wrap),s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),ti(n,i.getCompare())}{let r=t.get(e.name),i=n;return r&&(i=i.remove(new eX(e.name,r))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new to((0,E.kH)(this.indexes_,n=>{if(n===ts)return n;{let r=t.get(e.name);return r?n.remove(new eX(e.name,r)):n}}),this.indexSet_)}}class ta{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&e9(this.priorityNode_),this.children_.isEmpty()&&(0,E.vA)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return u||(u=new ta(new e4(e5),null,to.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||u}updatePriority(e){return this.children_.isEmpty()?this:new ta(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?u:t}}getChild(e){let t=eO(e);return null===t?this:this.getImmediateChild(t).getChild(eL(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,E.vA)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,r,i=new eX(e,t);t.isEmpty()?(n=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));let s=n.isEmpty()?u:this.priorityNode_;return new ta(n,s,r)}}updateChild(e,t){let n=eO(e);if(null===n)return t;{(0,E.vA)(".priority"!==eO(e)||1===eM(e),".priority must be the last token in a path");let r=this.getImmediateChild(n).updateChild(eL(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,r=0,i=!0;if(this.forEachChild(tt,(s,o)=>{t[s]=o.val(e),n++,i&&ta.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),e||!i||!(r<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+e8(this.getPriority().val())+":"),this.forEachChild(tt,(t,n)=>{let r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":F(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);{let n=r.getPredecessorKey(new eX(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new eX(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new eX(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,eX.Wrap),r=n.peek();for(;null!=r&&0>t.compare(r,e);)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,eX.Wrap),r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===tu?-1:0}withIndex(e){if(e===e0||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new ta(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===e0||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(tt),n=e.getIterator(tt),r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}}resolveIndex_(e){return e===e0?null:this.indexMap_.get(e.toString())}}ta.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class tl extends ta{constructor(){super(new e4(e5),ta.EMPTY_NODE,to.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ta.EMPTY_NODE}isEmpty(){return!1}}let tu=new tl;function th(e,t=null){if(null===e)return ta.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,E.vA)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new e7(e,th(t));if(e instanceof Array){let n=ta.EMPTY_NODE;return er(e,(t,r)=>{if((0,E.gR)(e,t)&&"."!==t.substring(0,1)){let e=th(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(th(t))}{let n=[],r=!1;if(er(e,(e,t)=>{if("."!==e.substring(0,1)){let i=th(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new eX(e,i)))}}),0===n.length)return ta.EMPTY_NODE;let i=ti(n,e6,e=>e.name,e5);if(!r)return new ta(i,th(t),to.Default);{let e=ti(n,tt.getCompare());return new ta(i,th(t),new to({".priority":e},{".priority":tt}))}}}Object.defineProperties(eX,{MIN:{value:new eX(Y,ta.EMPTY_NODE)},MAX:{value:new eX(X,tu)}}),eZ.__EMPTY_NODE=ta.EMPTY_NODE,e7.__childrenNodeConstructor=ta,i=tu,a=tu,o=th;class tc extends eJ{constructor(e){super(),this.indexPath_=e,(0,E.vA)(!ej(e)&&".priority"!==eO(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?J(e.name,t.name):i}makePost(e,t){let n=th(e);return new eX(t,ta.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new eX(X,ta.EMPTY_NODE.updateChild(this.indexPath_,tu))}toString(){return eU(this.indexPath_,0).join("/")}}class td extends eJ{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?J(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return eX.MIN}maxPost(){return eX.MAX}makePost(e,t){return new eX(t,th(e))}toString(){return".value"}}let tf=new td;function tp(e){return{type:"value",snapshotNode:e}}function tg(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function tm(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function ty(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class tv{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){(0,E.vA)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(tm(t,o)):(0,E.vA)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(tg(t,n)):s.trackChildChange(ty(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(tt,(e,r)=>{t.hasChild(e)||n.trackChildChange(tm(e,r))}),t.isLeafNode()||t.forEachChild(tt,(t,r)=>{if(e.hasChild(t)){let i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(ty(t,r,i))}else n.trackChildChange(tg(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ta.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class t_{constructor(e){this.indexedFilter_=new tv(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t_.getStartPost_(e),this.endPost_=t_.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new eX(t,n))||(n=ta.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ta.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(ta.EMPTY_NODE);let i=this;return t.forEachChild(tt,(e,t)=>{i.matches(new eX(e,t))||(r=r.updateImmediateChild(e,ta.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class tw{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new t_(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return(this.rangedFilter_.matches(new eX(t,n))||(n=ta.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=ta.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=ta.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))r=r.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;r=(r=t.withIndex(this.index_)).updatePriority(ta.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,ta.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();(0,E.vA)(e.numChildren()===this.limit_,"");let o=new eX(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let u=e.getImmediateChild(t),h=r.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=h&&(h.name===t||e.hasChild(h.name));)h=r.getChildAfterChild(this.index_,h,this.reverse_);let c=null==h?1:s(h,o);if(l&&!n.isEmpty()&&c>=0)return null!=i&&i.trackChildChange(ty(t,n,u)),e.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(tm(t,u));let n=e.updateImmediateChild(t,ta.EMPTY_NODE);return null!=h&&this.rangedFilter_.matches(h)?(null!=i&&i.trackChildChange(tg(h.name,h.node)),n.updateImmediateChild(h.name,h.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=i&&(i.trackChildChange(tm(a.name,a.node)),i.trackChildChange(tg(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,ta.EMPTY_NODE)):e:e}}class tb{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=tt}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,E.vA)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return((0,E.vA)(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:Y}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,E.vA)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return((0,E.vA)(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:X}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,E.vA)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===tt}copy(){let e=new tb;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function tI(e,t,n){let r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function tT(e,t,n){let r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function tE(e,t){let n=e.copy();return n.index_=t,n}function tC(e){let t,n={};if(e.isDefault())return n;if(e.index_===tt?t="$priority":e.index_===tf?t="$value":e.index_===e0?t="$key":((0,E.vA)(e.index_ instanceof tc,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,E.As)(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=(0,E.As)(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+(0,E.As)(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=(0,E.As)(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+(0,E.As)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function tS(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==tt&&(t.i=e.index_.toString()),t}class tk extends eA{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=z("p:rest:"),this.listens_={}}reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,E.vA)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=tk.getListenId_(e,n),o={};this.listens_[s]=o;let a=tC(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),(0,E.yw)(this.listens_,s)===o){let t;r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}})}unlisten(e,t){let n=tk.getListenId_(e,t);delete this.listens_[n]}get(e){let t=tC(e._queryParams),n=e._path.toString(),r=new E.cY;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,E.Am)(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=(0,E.$L)(o.responseText)}catch(e){G("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&G("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class tx{constructor(){this.rootNode_=ta.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function tA(){return{value:null,children:new Map}}function tN(e,t,n){if(ej(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{let r=eO(t);e.children.has(r)||e.children.set(r,tA()),tN(e.children.get(r),t=eL(t),n)}}function tD(e,t,n){var r,i;null!==e.value?n(t,e.value):(r=e,i=(e,r)=>{tD(r,new eR(t.toString()+"/"+e),n)},r.children.forEach((e,t)=>{i(t,e)}))}class tR{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&er(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class tP{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new tR(e);let n=1e4+2e4*Math.random();el(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;er(e,(e,r)=>{r>0&&(0,E.gR)(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),el(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function tO(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tM(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function tL(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(m||(m={}));class tF{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=m.ACK_USER_WRITE,this.source=tO()}operationForChild(e){if(!ej(this.path))return(0,E.vA)(eO(this.path)===e,"operationForChild called for unrelated child."),new tF(eL(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return(0,E.vA)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new eR(e));return new tF(eP(),t,this.revert)}}}class tU{constructor(e,t){this.source=e,this.path=t,this.type=m.LISTEN_COMPLETE}operationForChild(e){return ej(this.path)?new tU(this.source,eP()):new tU(this.source,eL(this.path))}}class tV{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=m.OVERWRITE}operationForChild(e){return ej(this.path)?new tV(this.source,eP(),this.snap.getImmediateChild(e)):new tV(this.source,eL(this.path),this.snap)}}class tq{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=m.MERGE}operationForChild(e){if(!ej(this.path))return(0,E.vA)(eO(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new tq(this.source,eL(this.path),this.children);{let t=this.children.subtree(new eR(e));return t.isEmpty()?null:t.value?new tV(this.source,eP(),t.value):new tq(this.source,eP(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class tj{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ej(e))return this.isFullyInitialized()&&!this.filtered_;let t=eO(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class tB{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function tz(e,t,n,r,i,s){let o=r.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw(0,E.Hk)("Should only compare child_ events.");let r=new eX(t.childName,t.snapshotNode),i=new eX(n.childName,n.snapshotNode);return e.index_.compare(r,i)})(e,t,n)),o.forEach(n=>{var r,o,a;let l=(r=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,r.index_)),o);i.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(l,e.query_))})})}function tK(e,t){return{eventCache:e,serverCache:t}}function t$(e,t,n,r){return tK(new tj(t,n,r),e.serverCache)}function tG(e,t,n,r){return tK(e.eventCache,new tj(t,n,r))}function tH(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function tW(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let tQ=()=>(h||(h=new e4(Z)),h);class tY{constructor(e,t=tQ()){this.value=e,this.children=t}static fromObject(e){let t=new tY(null);return er(e,(e,n)=>{t=t.set(new eR(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:eP(),value:this.value};{if(ej(e))return null;let n=eO(e),r=this.children.get(n);if(null===r)return null;{let i=r.findRootMostMatchingPathAndValue(eL(e),t);return null!=i?{path:eq(new eR(n),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ej(e))return this;{let t=eO(e),n=this.children.get(t);return null!==n?n.subtree(eL(e)):new tY(null)}}set(e,t){if(ej(e))return new tY(t,this.children);{let n=eO(e),r=(this.children.get(n)||new tY(null)).set(eL(e),t),i=this.children.insert(n,r);return new tY(this.value,i)}}remove(e){if(ej(e))if(this.children.isEmpty())return new tY(null);else return new tY(null,this.children);{let t=eO(e),n=this.children.get(t);if(!n)return this;{let r,i=n.remove(eL(e));return(r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty())?new tY(null):new tY(this.value,r)}}}get(e){if(ej(e))return this.value;{let t=eO(e),n=this.children.get(t);return n?n.get(eL(e)):null}}setTree(e,t){if(ej(e))return t;{let n,r=eO(e),i=(this.children.get(r)||new tY(null)).setTree(eL(e),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new tY(this.value,n)}}fold(e){return this.fold_(eP(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(eq(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,eP(),t)}findOnPath_(e,t,n){let r=!!this.value&&n(t,this.value);if(r)return r;{if(ej(e))return null;let r=eO(e),i=this.children.get(r);return i?i.findOnPath_(eL(e),eq(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,eP(),t)}foreachOnPath_(e,t,n){if(ej(e))return this;{this.value&&n(t,this.value);let r=eO(e),i=this.children.get(r);return i?i.foreachOnPath_(eL(e),eq(t,r),n):new tY(null)}}foreach(e){this.foreach_(eP(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(eq(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class tX{constructor(e){this.writeTree_=e}static empty(){return new tX(new tY(null))}}function tJ(e,t,n){if(ej(t))return new tX(new tY(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){let i=r.path,s=r.value,o=eB(i,t);return s=s.updateChild(o,n),new tX(e.writeTree_.set(i,s))}{let r=new tY(n);return new tX(e.writeTree_.setTree(t,r))}}}function tZ(e,t,n){let r=e;return er(n,(e,n)=>{r=tJ(r,eq(t,e),n)}),r}function t0(e,t){return ej(t)?tX.empty():new tX(e.writeTree_.setTree(t,new tY(null)))}function t1(e,t){return null!=t2(e,t)}function t2(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(eB(n.path,t)):null}function t3(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(tt,(e,n)=>{t.push(new eX(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new eX(e,n.value))}),t}function t4(e,t){if(ej(t))return e;{let n=t2(e,t);return new tX(null!=n?new tY(n):e.writeTree_.subtree(t))}}function t6(e){return e.writeTree_.isEmpty()}function t5(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);{let i=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?((0,E.vA)(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=e(eq(t,n),s,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(eq(t,".priority"),i)),r}}(eP(),e.writeTree_,t)}function t8(e){return e.visible}function t9(e,t,n){let r=tX.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e,t=s.path;if(s.snap)e$(n,t)?r=tJ(r,e=eB(n,t),s.snap):e$(t,n)&&(e=eB(t,n),r=tJ(r,eP(),s.snap.getChild(e)));else if(s.children){if(e$(n,t))r=tZ(r,e=eB(n,t),s.children);else if(e$(t,n))if(ej(e=eB(t,n)))r=tZ(r,eP(),s.children);else{let t=(0,E.yw)(s.children,eO(e));if(t){let n=t.getChild(eL(e));r=tJ(r,eP(),n)}}}else throw(0,E.Hk)("WriteRecord should have .snap or .children")}}return r}function t7(e,t,n,r,i){if(r||i){let s=t4(e.visibleWrites,t);return!i&&t6(s)?n:i||null!=n||t1(s,eP())?t5(t9(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(e$(e.path,t)||e$(t,e.path))},t),n||ta.EMPTY_NODE):null}{let r=t2(e.visibleWrites,t);if(null!=r)return r;{let r=t4(e.visibleWrites,t);return t6(r)?n:null!=n||t1(r,eP())?t5(r,n||ta.EMPTY_NODE):null}}}function ne(e,t,n,r){return t7(e.writeTree,e.treePath,t,n,r)}function nt(e,t){return function(e,t,n){let r=ta.EMPTY_NODE,i=t2(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(tt,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(!n)return t3(t4(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r;{let i=t4(e.visibleWrites,t);return n.forEachChild(tt,(e,t)=>{let n=t5(t4(i,new eR(e)),t);r=r.updateImmediateChild(e,n)}),t3(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}(e.writeTree,e.treePath,t)}function nn(e,t,n,r){return function(e,t,n,r,i){(0,E.vA)(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=eq(t,n);if(t1(e.visibleWrites,s))return null;{let t=t4(e.visibleWrites,s);return t6(t)?i.getChild(n):t5(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function nr(e,t){var n,r;return n=e.writeTree,r=eq(e.treePath,t),t2(n.visibleWrites,r)}function ni(e,t,n){return function(e,t,n,r){let i=eq(t,n),s=t2(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?t5(t4(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function ns(e,t){return no(eq(e.treePath,t),e.writeTree)}function no(e,t){return{treePath:e,writeTree:t}}class na{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;(0,E.vA)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,E.vA)(".priority"!==n,"Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,ty(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,tm(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,tg(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,ty(n,e.snapshotNode,r.oldSnap));else throw(0,E.Hk)("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}class nl{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}let nu=new nl;class nh{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new tj(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ni(this.writes_,e,t)}}getChildAfterChild(e,t,n){var r;let i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:tW(this.viewCache_),s=(r=this.writes_,function(e,t,n,r,i,s,o){let a,l=t4(e.visibleWrites,t),u=t2(l,eP());if(null!=u)a=u;else{if(null==n)return[];a=t5(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),i=n.getNext();for(;i&&e.length<1;)0!==t(i,r)&&e.push(i),i=n.getNext();return e}}(r.writeTree,r.treePath,i,t,1,n,e));return 0===s.length?null:s[0]}}function nc(e,t,n,r,i,s){let o=t.eventCache;if(null!=nr(r,n))return t;{let a,l;if(ej(n))if((0,E.vA)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=tW(t),i=nt(r,n instanceof ta?n:ta.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let n=ne(r,tW(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let u=eO(n);if(".priority"===u){(0,E.vA)(1===eM(n),"Can't have a priority with additional path components");let i=o.getNode(),s=nn(r,n,i,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{let h,c=eL(n);if(o.isCompleteForChild(u)){l=t.serverCache.getNode();let e=nn(r,n,o.getNode(),l);h=null!=e?o.getNode().getImmediateChild(u).updateChild(c,e):o.getNode().getImmediateChild(u)}else h=ni(r,u,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),u,h,c,i,s):o.getNode()}}return t$(t,a,o.isFullyInitialized()||ej(n),e.filter.filtersNodes())}}function nd(e,t,n,r,i,s,o,a){let l,u=t.serverCache,h=o?e.filter:e.filter.getIndexedFilter();if(ej(n))l=h.updateFullNode(u.getNode(),r,null);else if(h.filtersNodes()&&!u.isFiltered()){let e=u.getNode().updateChild(n,r);l=h.updateFullNode(u.getNode(),e,null)}else{let e=eO(n);if(!u.isCompleteForPath(n)&&eM(n)>1)return t;let i=eL(n),s=u.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?h.updatePriority(u.getNode(),s):h.updateChild(u.getNode(),e,s,i,nu,null)}let c=tG(t,l,u.isFullyInitialized()||ej(n),h.filtersNodes()),d=new nh(i,c,s);return nc(e,c,n,i,d,a)}function nf(e,t,n,r,i,s,o){let a,l,u=t.eventCache,h=new nh(i,t,s);if(ej(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),a=t$(t,l,!0,e.filter.filtersNodes());else{let i=eO(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),a=t$(t,l,u.isFullyInitialized(),u.isFiltered());else{let s,l=eL(n),c=u.getNode().getImmediateChild(i);if(ej(l))s=r;else{let e=h.getCompleteChild(i);s=null!=e?".priority"===eF(l)&&e.getChild(eV(l)).isEmpty()?e:e.updateChild(l,r):ta.EMPTY_NODE}a=c.equals(s)?t:t$(t,e.filter.updateChild(u.getNode(),i,s,l,h,o),u.isFullyInitialized(),e.filter.filtersNodes())}}return a}function np(e,t){return e.eventCache.isCompleteForChild(t)}function ng(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function nm(e,t,n,r,i,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let u=t;l=ej(n)?r:new tY(null).setTree(n,r);let h=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(h.hasChild(n)){let l=ng(e,t.serverCache.getNode().getImmediateChild(n),r);u=nd(e,u,new eR(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!h.hasChild(n)&&!l){let l=ng(e,t.serverCache.getNode().getImmediateChild(n),r);u=nd(e,u,new eR(n),l,i,s,o,a)}}),u}class ny{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,r=new tv(n.getIndex()),i=function(e){return e.loadsAllData()?new tv(e.getIndex()):e.hasLimit()?new tw(e):new t_(e)}(n);this.processor_={filter:i};let s=t.serverCache,o=t.eventCache,a=r.updateFullNode(ta.EMPTY_NODE,s.getNode(),null),l=i.updateFullNode(ta.EMPTY_NODE,o.getNode(),null),u=new tj(a,s.isFullyInitialized(),r.filtersNodes()),h=new tj(l,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=tK(h,u),this.eventGenerator_=new tB(this.query_)}get query(){return this.query_}}function nv(e){return 0===e.eventRegistrations_.length}function n_(e,t,n){let r=[];if(n){(0,E.vA)(null==t,"A cancel should cancel all event registrations.");let i=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){let i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function nw(e,t,n,r){var i,s;t.type===m.MERGE&&null!==t.source.queryId&&((0,E.vA)(tW(e.viewCache_),"We should always have a full cache before handling merges"),(0,E.vA)(tH(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,r,i){let s,o,a=new na;if(n.type===m.OVERWRITE)n.source.fromUser?s=nf(e,t,n.path,n.snap,r,i,a):((0,E.vA)(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered()&&!ej(n.path),s=nd(e,t,n.path,n.snap,r,i,o,a));else if(n.type===m.MERGE){var l,u,h,c,d,p,g;let m;n.source.fromUser?(l=e,u=t,h=n.path,c=n.children,d=r,p=i,g=a,m=u,c.foreach((e,t)=>{let n=eq(h,e);np(u,eO(n))&&(m=nf(l,m,n,t,d,p,g))}),c.foreach((e,t)=>{let n=eq(h,e);np(u,eO(n))||(m=nf(l,m,n,t,d,p,g))}),s=m):((0,E.vA)(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered(),s=nm(e,t,n.path,n.children,r,i,o,a))}else if(n.type===m.ACK_USER_WRITE)s=n.revert?function(e,t,n,r,i,s){let o;if(null!=nr(r,n))return t;{let a,l=new nh(r,t,i),u=t.eventCache.getNode();if(ej(n)||".priority"===eO(n)){let n;if(t.serverCache.isFullyInitialized())n=ne(r,tW(t));else{let e=t.serverCache.getNode();(0,E.vA)(e instanceof ta,"serverChildren would be complete if leaf node"),n=nt(r,e)}a=e.filter.updateFullNode(u,n,s)}else{let i=eO(n),h=ni(r,i,t.serverCache);null==h&&t.serverCache.isCompleteForChild(i)&&(h=u.getImmediateChild(i)),(a=null!=h?e.filter.updateChild(u,i,h,eL(n),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(u,i,ta.EMPTY_NODE,eL(n),l,s):u).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=ne(r,tW(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=nr(r,eP()),t$(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,r,i,a):function(e,t,n,r,i,s,o){if(null!=nr(i,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value)if(ej(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return nd(e,t,n,l.getNode().getChild(n),i,s,a,o);else{if(!ej(n))return t;let r=new tY(null);return l.getNode().forEachChild(e0,(e,t)=>{r=r.set(new eR(e),t)}),nm(e,t,n,r,i,s,a,o)}{let u=new tY(null);return r.foreach((e,t)=>{let r=eq(n,e);l.isCompleteForPath(r)&&(u=u.set(e,l.getNode().getChild(r)))}),nm(e,t,n,u,i,s,a,o)}}(e,t,n.path,n.affectedTree,r,i,a);else if(n.type===m.LISTEN_COMPLETE)s=function(e,t,n,r,i){let s=t.serverCache;return nc(e,tG(t,s.getNode(),s.isFullyInitialized()||ej(n),s.isFiltered()),n,r,nu,i)}(e,t,n.path,r,a);else throw(0,E.Hk)("Unknown operation type: "+n.type);let y=a.getChanges();return function(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=tH(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(s))&&r.getNode().getPriority().equals(s.getPriority())||n.push(tp(tH(t)))}}(t,s,y),{viewCache:s,changes:y}}(e.processor_,o,t,n,r);return i=e.processor_,s=a.viewCache,(0,E.vA)(s.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),(0,E.vA)(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),(0,E.vA)(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,nb(e,a.changes,a.viewCache.eventCache.getNode(),null)}function nb(e,t,n,r){let i=r?[r]:e.eventRegistrations_;var s=e.eventGenerator_;let o=[],a=[];return t.forEach(e=>{var t;"child_changed"===e.type&&s.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&a.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),tz(s,o,"child_removed",t,i,n),tz(s,o,"child_added",t,i,n),tz(s,o,"child_moved",a,i,n),tz(s,o,"child_changed",t,i,n),tz(s,o,"value",t,i,n),o}class nI{constructor(){this.views=new Map}}function nT(e,t,n,r){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return(0,E.vA)(null!=s,"SyncTree gave us an op for an invalid query."),nw(s,t,n,r)}{let i=[];for(let s of e.views.values())i=i.concat(nw(s,t,n,r));return i}}function nE(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function nC(e,t){let n=null;for(let r of e.views.values())n=n||function(e,t){let n=tW(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!ej(t)&&!n.getImmediateChild(eO(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function nS(e,t){if(t._queryParams.loadsAllData())return nx(e);{let n=t._queryIdentifier;return e.views.get(n)}}function nk(e){return null!=nx(e)}function nx(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let nA=1;class nN{constructor(e){this.listenProvider_=e,this.syncPointTree_=new tY(null),this.pendingWriteTree_={visibleWrites:tX.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function nD(e,t,n,r,i){var s,o;return(s=e.pendingWriteTree_,o=i,(0,E.vA)(r>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:r,visible:o}),o&&(s.visibleWrites=tJ(s.visibleWrites,t,n)),s.lastWriteId=r,i)?nF(e,new tV(tO(),t,n)):[]}function nR(e,t,n=!1){let r=function(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let r=e.allWrites.findIndex(e=>e.writeId===t);(0,E.vA)(r>=0,"removeWrite called with nonexistent writeId.");let i=e.allWrites[r];e.allWrites.splice(r,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=r&&function(e,t){if(e.snap)return e$(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&e$(eq(e.path,n),t))return!0;return!1}(t,i.path)?s=!1:e$(i.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=t9(n.allWrites,t8,eP()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):i.snap?e.visibleWrites=t0(e.visibleWrites,i.path):er(i.children,t=>{e.visibleWrites=t0(e.visibleWrites,eq(i.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new tY(null);return null!=r.snap?t=t.set(eP(),!0):er(r.children,e=>{t=t.set(new eR(e),!0)}),nF(e,new tF(r.path,t,n))}}function nP(e,t,n){return nF(e,new tV(tM(),t,n))}function nO(e,t,n,r,i=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=nS(o,t))){let h=function(e,t,n,r){let i=t._queryIdentifier,s=[],o=[],a=nk(e);if("default"===i)for(let[t,i]of e.views.entries())o=o.concat(n_(i,n,r)),nv(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||s.push(i.query));else{let t=e.views.get(i);t&&(o=o.concat(n_(t,n,r)),nv(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!nk(e)&&s.push(new((0,E.vA)(c,"Reference.ts has not been loaded"),c)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=h.removed;if(a=h.events,!i){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>nk(t));if(n&&!i){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&nk(t))return[nx(t)];{let e=[];return t&&(e=nE(t)),er(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let r=n[t],i=r.query,s=nU(e,r);e.listenProvider_.startListening(nK(i),nV(e,i),s.hashFn,s.onComplete)}}}i||!(d.length>0)||r||(n?e.listenProvider_.stopListening(nK(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(nq(t));e.listenProvider_.stopListening(nK(t),n)}))}var l=e,u=d;for(let e=0;e<u.length;++e){let t=u[e];if(!t._queryParams.loadsAllData()){let e=nq(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function nM(e,t,n,r=!1){let i,s=t._path,o=null,a=!1;e.syncPointTree_.foreachOnPath(s,(e,t)=>{let n=eB(e,s);o=o||nC(t,n),a=a||nk(t)});let l=e.syncPointTree_.get(s);l?(a=a||nk(l),o=o||nC(l,eP())):(l=new nI,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o?i=!0:(i=!1,o=ta.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild((e,t)=>{let n=nC(t,eP());n&&(o=o.updateImmediateChild(e,n))}));let u=null!=nS(l,t);if(!u&&!t._queryParams.loadsAllData()){let n=nq(t);(0,E.vA)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let r=nA++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let h=function(e,t,n,r,i,s){let o=function(e,t,n,r,i){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=ne(n,i?r:null),s=!1;return e?s=!0:(e=r instanceof ta?nt(n,r):ta.EMPTY_NODE,s=!1),new ny(t,tK(new tj(e,s,!1),new tj(r,i,!1)))}return o}(e,t,r,i,s);e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n);let a=o.viewCache_.eventCache,l=[];return a.getNode().isLeafNode()||a.getNode().forEachChild(tt,(e,t)=>{l.push(tg(e,t))}),a.isFullyInitialized()&&l.push(tp(a.getNode())),nb(o,l,a.getNode(),n)}(l,t,n,no(s,e.pendingWriteTree_),o,i);if(!u&&!a&&!r){let n=nS(l,t);h=h.concat(function(e,t,n){let r=t._path,i=nV(e,t),s=nU(e,n),o=e.listenProvider_.startListening(nK(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)(0,E.vA)(!nk(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!ej(e)&&t&&nk(t))return[nx(t).query];{let e=[];return t&&(e=e.concat(nE(t).map(e=>e.query))),er(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let r=t[n];e.listenProvider_.stopListening(nK(r),nV(e,r))}}return o}(e,t,n))}return h}function nL(e,t,n){let r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=nC(n,eB(e,t));if(r)return r});return t7(r,t,i,n,!0)}function nF(e,t){var n;return function e(t,n,r,i){if(ej(t.path))return function e(t,n,r,i){let s=n.get(eP());null==r&&null!=s&&(r=nC(s,eP()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=r?r.getImmediateChild(n):null,l=ns(i,n),u=t.operationForChild(n);u&&(o=o.concat(e(u,s,a,l)))}),s&&(o=o.concat(nT(s,t,i,r))),o}(t,n,r,i);{let s=n.get(eP());null==r&&null!=s&&(r=nC(s,eP()));let o=[],a=eO(t.path),l=t.operationForChild(a),u=n.children.get(a);if(u&&l){let t=r?r.getImmediateChild(a):null,n=ns(i,a);o=o.concat(e(l,u,t,n))}return s&&(o=o.concat(nT(s,t,i,r))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,no(eP(),n)))}function nU(e,t){let n=t.query,r=nV(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||ta.EMPTY_NODE).hash(),onComplete:t=>{if("ok"===t)if(r)return function(e,t,n){let r=nj(e,n);if(!r)return[];{let n=nB(r),i=n.path,s=n.queryId,o=eB(i,t);return nz(e,i,new tU(tL(s),o))}}(e,n._path,r);else{var i;return i=n._path,nF(e,new tU(tM(),i))}{let r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");let r=Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return nO(e,n,null,r)}}}}function nV(e,t){let n=nq(t);return e.queryToTagMap.get(n)}function nq(e){return e._path.toString()+"$"+e._queryIdentifier}function nj(e,t){return e.tagToQueryMap.get(t)}function nB(e){let t=e.indexOf("$");return(0,E.vA)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new eR(e.substr(0,t))}}function nz(e,t,n){let r=e.syncPointTree_.get(t);return(0,E.vA)(r,"Missing sync point for query tag that we're tracking"),nT(r,n,no(t,e.pendingWriteTree_),null)}function nK(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,E.vA)(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}class n${constructor(e){this.node_=e}getImmediateChild(e){return new n$(this.node_.getImmediateChild(e))}node(){return this.node_}}class nG{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=eq(this.path_,e);return new nG(this.syncTree_,t)}node(){return nL(this.syncTree_,this.path_)}}let nH=function(e,t,n){return e&&"object"==typeof e?((0,E.vA)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?nW(e[".sv"],t,n):"object"==typeof e[".sv"]?nQ(e[".sv"],t):void(0,E.vA)(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},nW=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,E.vA)(!1,"Unexpected server value: "+e)},nQ=function(e,t,n){e.hasOwnProperty("increment")||(0,E.vA)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;"number"!=typeof r&&(0,E.vA)(!1,"Unexpected increment value: "+r);let i=t.node();if((0,E.vA)(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return"number"!=typeof s?r:s+r},nY=function(e,t,n){return nX(e,new n$(t),n)};function nX(e,t,n){let r,i=nH(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new e7(i))),e.forEachChild(tt,(e,i)=>{let s=nX(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r;{let r=nH(e.getValue(),t,n);return r!==e.getValue()||i!==e.getPriority().val()?new e7(r,th(i)):e}}class nJ{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function nZ(e,t){let n=t instanceof eR?t:new eR(t),r=e,i=eO(n);for(;null!==i;){let e=(0,E.yw)(r.node.children,i)||{children:{},childCount:0};r=new nJ(i,r,e),i=eO(n=eL(n))}return r}function n0(e){return e.node.value}function n1(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,r){let i=void 0===n0(r)&&!n2(r),s=(0,E.gR)(t.node.children,n);i&&s?(delete t.node.children[n],t.node.childCount--,e(t)):i||s||(t.node.children[n]=r.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function n2(e){return e.node.childCount>0}function n3(e,t){er(e.node.children,(n,r)=>{t(new nJ(n,e,r))})}function n4(e){return new eR(null===e.parent?e.name:n4(e.parent)+"/"+e.name)}let n6=/[\[\].#$\/\u0000-\u001F\u007F]/,n5=/[\[\].#$\u0000-\u001F\u007F]/,n8=function(e){return"string"==typeof e&&0!==e.length&&!n6.test(e)},n9=function(e){return"string"==typeof e&&0!==e.length&&!n5.test(e)},n7=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!W(e)||e&&"object"==typeof e&&(0,E.gR)(e,".sv")},re=function(e,t,n,r){r&&void 0===t||rt((0,E.dI)(e,"value"),t,n)},rt=function(e,t,n){let r=n instanceof eR?new eG(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+eW(r));if("function"==typeof t)throw Error(e+"contains a function "+eW(r)+" with contents = "+t.toString());if(W(t))throw Error(e+"contains "+t.toString()+" "+eW(r));if("string"==typeof t&&t.length>3495253.3333333335&&(0,E.OE)(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+eW(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(er(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!n8(t)))throw Error(e+" contains an invalid key ("+t+") "+eW(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=(0,E.OE)(t),eH(r),rt(e,s,r);let o=r.parts_.pop();r.byteLength_-=(0,E.OE)(o),r.parts_.length>0&&(r.byteLength_-=1)}),n&&i)throw Error(e+' contains ".value" child '+eW(r)+" in addition to actual children.")}},rn=function(e,t){let n,r;for(n=0;n<t.length;n++){let i=eU(r=t[n]);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!n8(i[t]))throw Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(ez);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&e$(i,r))throw Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},rr=function(e,t,n,r){if(r&&void 0===t)return;let i=errorPrefix(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(i+" must be an object containing the children to replace.");let s=[];er(t,(e,t)=>{let r=new eR(e);if(rt(i,t,eq(n,r)),".priority"===eF(r)&&!n7(t))throw Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),rn(i,s)},ri=function(e,t,n){if(!n||void 0!==t){if(W(t))throw Error(errorPrefix(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!n7(t))throw Error(errorPrefix(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},rs=function(e,t,n,r){if((!r||void 0!==n)&&!n9(n))throw Error((0,E.dI)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ro=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),rs(e,t,n,r)},ra=function(e,t){if(".info"===eO(t))throw Error(e+" failed = Can't modify data under /.info/")},rl=function(e,t){var n;let r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!n8(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&((n=r)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!n9(n)))throw Error((0,E.dI)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ru{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function rh(e,t){let n=null;for(let r=0;r<t.length;r++){let i=t[r],s=i.getPath();null===n||eK(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function rc(e,t,n){rh(e,n),rf(e,e=>eK(e,t))}function rd(e,t,n){rh(e,n),rf(e,e=>e$(e,t)||e$(t,e))}function rf(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let r=n.getEventRunner();V&&B("event: "+n.toString()),ea(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class rp{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ru,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=tA(),this.transactionQueueTree_=new nJ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function rg(e){var t;return(t=t={timestamp:function(e){let t=e.infoData_.getNode(new eR(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}(e)}).timestamp=t.timestamp||new Date().getTime(),t}function rm(e,t,n,r,i){e.dataUpdateCount++;let s=new eR(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){let t=(0,E.kH)(n,e=>th(e));o=function(e,t,n,r){let i=nj(e,r);if(!i)return[];{let r=nB(i),s=r.path,o=r.queryId,a=eB(s,t),l=tY.fromObject(n);return nz(e,s,new tq(tL(o),a,l))}}(e.serverSyncTree_,s,t,i)}else{let t=th(n);o=function(e,t,n,r){let i=nj(e,r);if(null==i)return[];{let r=nB(i),s=r.path,o=r.queryId,a=eB(s,t);return nz(e,s,new tV(tL(o),a,n))}}(e.serverSyncTree_,s,t,i)}else if(r){let t=(0,E.kH)(n,e=>th(e));o=function(e,t,n){let r=tY.fromObject(n);return nF(e,new tq(tM(),t,r))}(e.serverSyncTree_,s,t)}else{let t=th(n);o=nP(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=rC(e,s)),rd(e.eventQueue_,a,o)}function ry(e,t){rv(e,"connected",t),!1===t&&function(e){rI(e,"onDisconnectEvents");let t=rg(e),n=tA();tD(e.onDisconnect_,eP(),(r,i)=>{var s,o,a,l;let u=(s=r,o=i,a=e.serverSyncTree_,l=t,nX(o,new nG(a,s),l));tN(n,r,u)});let r=[];tD(n,eP(),(t,n)=>{r=r.concat(nP(e.serverSyncTree_,t,n));let i=rA(e,t);rC(e,i)}),e.onDisconnect_=tA(),rd(e.eventQueue_,eP(),r)}(e)}function rv(e,t,n){let r=new eR("/.info/"+t),i=th(n);e.infoData_.updateSnapshot(r,i);let s=nP(e.infoSyncTree_,r,i);rd(e.eventQueue_,r,s)}function r_(e){return e.nextWriteId_++}function rw(e,t,n,r){let i=th(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&tN(e.onDisconnect_,t,i),rT(e,r,n,s)})}function rb(e,t,n){let r;r=".info"===eO(t._path)?nO(e.infoSyncTree_,t,n):nO(e.serverSyncTree_,t,n),rc(e.eventQueue_,t._path,r)}function rI(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),B(n,...t)}function rT(e,t,n,r){t&&ea(()=>{if("ok"===n)t(null);else{let e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);let s=Error(i);s.code=e,t(s)}})}function rE(e,t,n){return nL(e.serverSyncTree_,t,n)||ta.EMPTY_NODE}function rC(e,t){let n=rS(e,t),r=n4(n),i=rk(e,n);return function(e,t,n){if(0===t.length)return;let r=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=eB(n,a.path),u=!1,h;if((0,E.vA)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)u=!0,h=a.abortReason,i=i.concat(nR(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)u=!0,h="maxretry",i=i.concat(nR(e.serverSyncTree_,a.currentWriteId,!0));else{let n=rE(e,a.path,s);a.currentInputSnapshot=n;let r=t[o].update(n.val());if(void 0!==r){rt("transaction failed: Data returned ",r,a.path);let t=th(r);"object"==typeof r&&null!=r&&(0,E.gR)(r,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=nY(t,n,rg(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=r_(e),s.splice(s.indexOf(o),1),i=(i=i.concat(nD(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(nR(e.serverSyncTree_,o,!0))}else u=!0,h="nodata",i=i.concat(nR(e.serverSyncTree_,a.currentWriteId,!0))}rd(e.eventQueue_,n,i),i=[],u&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===h?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(h),!1,null))))}rx(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)ea(r[e]);!function e(t,n=t.transactionQueueTree_){if(n||rx(t,n),n0(n)){let r=rk(t,n);(0,E.vA)(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&function(t,n,r){let i=rE(t,n,r.map(e=>e.currentWriteId)),s=i,o=i.hash();for(let e=0;e<r.length;e++){let t=r[e];(0,E.vA)(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let i=eB(n,t.path);s=s.updateChild(i,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,i=>{rI(t,"transaction put response",{path:n.toString(),status:i});let s=[];if("ok"===i){let i=[];for(let e=0;e<r.length;e++)r[e].status=2,s=s.concat(nR(t.serverSyncTree_,r[e].currentWriteId)),r[e].onComplete&&i.push(()=>r[e].onComplete(null,!0,r[e].currentOutputSnapshotResolved)),r[e].unwatcher();rx(t,nZ(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),rd(t.eventQueue_,n,s);for(let e=0;e<i.length;e++)ea(i[e])}else{if("datastale"===i)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{G("transaction at "+n.toString()+" failed: "+i);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=i}rC(t,n)}},o)}(t,n4(n),r)}else n2(n)&&n3(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,i,r),r}function rS(e,t){let n,r=e.transactionQueueTree_;for(n=eO(t);null!==n&&void 0===n0(r);)r=nZ(r,n),n=eO(t=eL(t));return r}function rk(e,t){let n=[];return function e(t,n,r){let i=n0(n);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);n3(n,n=>{e(t,n,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function rx(e,t){let n=n0(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,n1(t,n.length>0?n:void 0)}n3(t,t=>{rx(e,t)})}function rA(e,t){let n=n4(rS(e,t)),r=nZ(e.transactionQueueTree_,t);return!function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{rN(e,t)}),rN(e,r),!function e(t,n,r,i){r&&!i&&n(t),n3(t,t=>{e(t,n,!0,i)}),r&&i&&n(t)}(r,t=>{rN(e,t)}),n}function rN(e,t){let n=n0(t);if(n){let r=[],i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,E.vA)(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):((0,E.vA)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(nR(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?n1(t,void 0):n.length=s+1,rd(e.eventQueue_,n4(t),i);for(let e=0;e<r.length;e++)ea(r[e])}}let rD=function(e,t){let n=rR(e),r=n.namespace;"firebase.com"===n.domain&&$(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||$("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||H();let i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new eg(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new eR(n.pathString)}},rR=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let u=e.indexOf("//");u>=0&&(a=e.substring(0,u-1),e=e.substring(u+2));let h=e.indexOf("/");-1===h&&(h=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(h,c)),h<c&&(i=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(h,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):G(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(u=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(u+1),10)):u=t.length;let p=t.slice(0,u);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{let e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}},rP="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";(function(){let e=0,t=[];})();class rO{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,E.As)(this.snapshot.exportVal())}}class rM{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class rL{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,E.vA)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class rF{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return ej(this._path)?null:eF(this._path)}get ref(){return new rj(this._repo,this._path)}get _queryIdentifier(){let e=et(tS(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return tS(this._queryParams)}isEqual(e){if(!((e=(0,E.Ku)(e))instanceof rF))return!1;let t=this._repo===e._repo,n=eK(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function rU(e,t){if(!0===e._orderByCalled)throw Error(t+": You can't combine multiple orderBy calls.")}function rV(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===e0){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==Y)throw Error(r);if("string"!=typeof t)throw Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==X)throw Error(r);if("string"!=typeof n)throw Error(i)}}else if(e.getIndex()===tt){if(null!=t&&!n7(t)||null!=n&&!n7(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,E.vA)(e.getIndex()instanceof tc||e.getIndex()===tf,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function rq(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class rj extends rF{constructor(e,t){super(e,t,new tb,!1)}get parent(){let e=eV(this._path);return null===e?null:new rj(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class rB{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new eR(e),n=rz(this.ref,e);return new rB(this._node.getChild(t),n,tt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new rB(n,rz(this.ref,t),tt)))}hasChild(e){let t=new eR(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function rz(e,t){return null===eO((e=(0,E.Ku)(e))._path)?ro("child","path",t,!1):rs("child","path",t,!1),new rj(e._repo,eq(e._path,t))}class rK{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new rO("value",this,new rB(e.snapshotNode,new rj(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rM(this,e,t):null}matches(e){return e instanceof rK&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class r${constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rM(this,e,t):null}createEvent(e,t){(0,E.vA)(null!=e.childName,"Child events should have a childName.");let n=rz(new rj(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new rO(e.type,this,new rB(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof r$&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function rG(e,t,n,r,i){var s;let o,a;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){let t=n,r=(n,r)=>{rb(e._repo,e,u),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}let l=new rL(n,o||void 0),u="value"===t?new rK(l):new r$(t,l);return s=e._repo,a=".info"===eO(e._path)?nM(s.infoSyncTree_,e,u):nM(s.serverSyncTree_,e,u),rc(s.eventQueue_,e._path,a),()=>rb(e._repo,e,u)}class rH{}class rW extends rH{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){re("endAt",this._value,e._path,!0);let t=tT(e._queryParams,this._value,this._key);if(rq(t),rV(t),e._queryParams.hasEnd())throw Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new rF(e._repo,e._path,t,e._orderByCalled)}}class rQ extends rH{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){re("startAt",this._value,e._path,!0);let t=tI(e._queryParams,this._value,this._key);if(rq(t),rV(t),e._queryParams.hasStart())throw Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new rF(e._repo,e._path,t,e._orderByCalled)}}(0,E.vA)(!c,"__referenceConstructor has already been defined"),c=rj,(0,E.vA)(!d,"__referenceConstructor has already been defined"),d=rj;let rY={};class rX{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){if(e.stats_=ew(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new tk(e.repoInfo_,(t,n,r,i)=>{rm(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>ry(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,E.As)(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new eY(e.repoInfo_,t,(t,n,r,i)=>{rm(e,t,n,r,i)},t=>{ry(e,t)},t=>{var n;n=e,er(t,(e,t)=>{rv(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){let n=e.toString();return e_[n]||(e_[n]=t()),e_[n]}(e.repoInfo_,()=>new tP(e.stats_,e.server_)),e.infoData_=new tx,e.infoSyncTree_=new nN({startListening:(t,n,r,i)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=nP(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),rv(e,"connected",!1),e.serverSyncTree_=new nN({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let s=i(n,r);rd(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new rj(this._repo,eP())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){var n;let r=rY[t];r&&r[e.key]===e||$(`Database ${t}(${e.repoInfo_}) has already been deleted.`),(n=e).persistentConnection_&&n.persistentConnection_.interrupt("repo_interrupt"),delete r[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&$("Cannot call "+e+" on a deleted database.")}}eY.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},eY.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},A=I.MF,(0,I.om)(new T.uA("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate();return function(e,t,n,r,i){var s,o,a,l;let u,h,c,d,p=r||e.options.databaseURL;void 0===p&&(e.options.projectId||$("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),B("Using default host for project ",e.options.projectId),p=`${e.options.projectId}-default-rtdb.firebaseio.com`);let g=rD(p,void 0),m=g.repoInfo;void 0!==S&&S.env&&(c=S.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(d=!0,m=(g=rD(p=`http://${c}?ns=${m.namespace}`,void 0)).repoInfo):d=!g.repoInfo.secure;let y=i&&d?new ec(ec.OWNER):new eh(e.name,e.options,t);return rl("Invalid Firebase Database URL",g),ej(g.path)||$("Database URL must point to the root of a Firebase Database (not including a child path)."),new rX((s=m,o=e,a=y,l=new eu(e.name,n),(u=rY[o.name])||(u={},rY[o.name]=u),(h=u[s.toURLString()])&&$("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),h=new rp(s,!1,a,l),u[s.toURLString()]=h,h),e)}(n,e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),(0,I.KO)(k,x,void 0),(0,I.KO)(k,x,"esm2017");var rJ=n(6042);n(5665),n(1792);let rZ="firebasestorage.googleapis.com";class r0 extends E.g{constructor(e,t,n=0){super(r1(e),`Firebase Storage: ${t} (${r1(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,r0.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return r1(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function r1(e){return"storage/"+e}function r2(){return new r0(y.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function r3(){return new r0(y.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function r4(){return new r0(y.CANCELED,"User canceled the upload/download.")}function r6(){return new r0(y.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function r5(e){return new r0(y.INVALID_ARGUMENT,e)}function r8(){return new r0(y.APP_DELETED,"The Firebase app was deleted.")}function r9(e,t){return new r0(y.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(y||(y={}));class r7{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=r7.makeFromUrl(e,t)}catch(t){return new r7(e,"")}if(""===n.path)return n;throw new r0(y.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null,r="([A-Za-z0-9.\\-_]+)",i=RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}let o=t.replace(/[.]/g,"\\."),a=RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),l=t===rZ?"(?:storage.googleapis.com|storage.cloud.google.com)":t,u=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:a,indices:{bucket:1,path:3},postModify:s},{regex:RegExp(`^https?://${l}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<u.length;t++){let r=u[t],i=r.regex.exec(e);if(i){let e=i[r.indices.bucket],t=i[r.indices.path];t||(t=""),n=new r7(e,t),r.postModify(n);break}}if(null==n)throw new r0(y.INVALID_URL,"Invalid URL '"+e+"'.");return n}}class ie{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function it(e){return"string"==typeof e||e instanceof String}function ir(e){return ii()&&e instanceof Blob}function ii(){return"undefined"!=typeof Blob&&!isNode()}function is(e,t,n,r){if(r<t)throw r5(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw r5(`Invalid value for '${e}'. Expected ${n} or less.`)}function io(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function ia(e,t){let n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(v||(v={}));class il{constructor(e,t,n,r,i,s,o,a,l,u,h,c=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.retry=c,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{let n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==i){let e=r2();e.serverResponse=i.getErrorText(),r(this.errorCallback_?this.errorCallback_(i,e):e)}else r(t.canceled?this.appDelete_?r8():r4():r3())};this.canceled_?e(!1,new iu(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0,l=!1;function u(...e){l||(l=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(d,2===a)},t)}function c(){s&&clearTimeout(s)}function d(e,...t){let n;if(l)return void c();if(e||2===a||o){c(),u.call(null,e,...t);return}r<64&&(r*=2),1===a?(a=2,n=0):n=(r+Math.random())*1e3,h(n)}let p=!1;function g(e){p||(p=!0,c(),!l&&(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,g(!0)},n),g}((e,t)=>{if(t)return void e(!1,new iu(!1,null,!0));let n=this.connectionFactory_();this.pendingConnection_=n;let r=e=>{let t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;let t=n.getErrorCode()===v.NO_ERROR,i=n.getStatus();if(!t||ia(i,this.additionalRetryCodes_)&&this.retry)return void e(!1,new iu(!1,null,n.getErrorCode()===v.ABORT));e(!0,new iu(-1!==this.successCodes_.indexOf(i),n))})},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class iu{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function ih(...e){let t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){let n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(ii())return new Blob(e);throw new r0(y.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}let ic={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class id{constructor(e,t){this.data=e,this.contentType=t||null}}function ip(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):(64512&r)==55296?n<e.length-1&&(64512&e.charCodeAt(n+1))==56320?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):(64512&r)==56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function ig(e,t){let n;switch(e){case ic.BASE64:{let n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw r9(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case ic.BASE64URL:{let n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw r9(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{n=function(e){if("undefined"==typeof atob)throw new r0(y.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw r9(e,"Invalid character found")}let r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class im{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(null===t)throw r9(ic.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let n=t[1]||null;null!=n&&(this.base64=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class iy{constructor(e,t){let n=0,r="";ir(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(!ir(this.data_))return new iy(new Uint8Array(this.data_.buffer,e,t-e),!0);{var n,r,i;let s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new iy(s)}}static getBlob(...e){if(ii()){let t=e.map(e=>e instanceof iy?e.data_:e);return new iy(ih.apply(null,t))}{let t=e.map(e=>it(e)?function(e,t){switch(e){case ic.RAW:return new id(ip(t));case ic.BASE64:case ic.BASE64URL:return new id(ig(e,t));case ic.DATA_URL:return new id(function(e){let t,n=new im(e);if(n.base64)return ig(ic.BASE64,n.rest);var r=n.rest;try{t=decodeURIComponent(r)}catch(e){throw r9(ic.DATA_URL,"Malformed data URL.")}return ip(t)}(t),new im(t).contentType)}throw r2()}(ic.RAW,e).data:e.data_),n=0;t.forEach(e=>{n+=e.byteLength});let r=new Uint8Array(n),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]}),new iy(r,!0)}}uploadData(){return this.data_}}function iv(e){var t;let n;try{n=JSON.parse(e)}catch(e){return null}return"object"!=typeof(t=n)||Array.isArray(t)?null:n}function i_(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}function iw(e,t){return t}class ib{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||iw}}let iI=null;function iT(){if(iI)return iI;let e=[];e.push(new ib("bucket")),e.push(new ib("generation")),e.push(new ib("metageneration")),e.push(new ib("name","fullPath",!0));let t=new ib("name");t.xform=function(e,t){return!it(t)||t.length<2?t:i_(t)},e.push(t);let n=new ib("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new ib("timeCreated")),e.push(new ib("updated")),e.push(new ib("md5Hash",null,!0)),e.push(new ib("cacheControl",null,!0)),e.push(new ib("contentDisposition",null,!0)),e.push(new ib("contentEncoding",null,!0)),e.push(new ib("contentLanguage",null,!0)),e.push(new ib("contentType",null,!0)),e.push(new ib("metadata","customMetadata",!0)),iI=e}function iE(e,t){let n={},r=t.length;for(let i=0;i<r;i++){let r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}let iC="prefixes",iS="items";class ik{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function ix(e){if(!e)throw r2()}function iA(e,t){return function(n,r){let i=function(e,t,n){let r=iv(t);return null===r?null:function(e,t,n){let r={};r.type="file";let i=n.length;for(let e=0;e<i;e++){let i=n[e];r[i.local]=i.xform(r,t[i.server])}return Object.defineProperty(r,"ref",{get:function(){let t=new r7(r.bucket,r.fullPath);return e._makeStorageReference(t)}}),r}(e,r,n)}(e,r,t);return ix(null!==i),i}}function iN(e){return function(t,n){var r,i;let s;return 401===t.getStatus()?s=t.getErrorText().includes("Firebase App Check token is invalid")?new r0(y.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new r0(y.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(r=e.bucket,s=new r0(y.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,s=new r0(y.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):s=n,s.status=t.getStatus(),s.serverResponse=n.serverResponse,s}}function iD(e){let t=iN(e);return function(n,r){var i;let s=t(n,r);return 404===n.getStatus()&&(i=e.path,s=new r0(y.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),s.serverResponse=r.serverResponse,s}}function iR(e,t,n){let r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=t&&t.type()||"application/octet-stream"),r}function iP(e,t,n,r,i){let s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;let l=iR(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+iE(l,n)+"\r\n--"+a+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",h=iy.getBlob(u,r,"\r\n--"+a+"--");if(null===h)throw r6();let c={name:l.fullPath},d=io(s,e.host,e._protocol),p=e.maxUploadRetryTime,g=new ik(d,"POST",iA(e,n),p);return g.urlParams=c,g.headers=o,g.body=h.uploadData(),g.errorHandler=iN(t),g}class iO{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function iM(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){ix(!1)}return ix(!!n&&-1!==(t||["active"]).indexOf(n)),n}let iL={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function iF(e){switch(e){case"running":case"pausing":case"canceling":return iL.RUNNING;case"paused":return iL.PAUSED;case"success":return iL.SUCCESS;case"canceled":return iL.CANCELED;default:return iL.ERROR}}class iU{constructor(e,t,n){"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=e.next,this.error=e.error,this.complete=e.complete)}}function iV(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}class iq extends null{initXhr(){this.xhr_.responseType="text"}}function ij(){return new iq}class iB extends null{initXhr(){this.xhr_.responseType="arraybuffer"}}class iz extends null{initXhr(){this.xhr_.responseType="blob"}}class iK{constructor(e,t){this._service=e,t instanceof r7?this._location=t:this._location=r7.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new iK(e,t)}get root(){let e=new r7(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return i_(this._location.path)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new r7(this._location.bucket,e);return new iK(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new r0(y.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function i$(e,t){let n=null==t?void 0:t.storageBucket;return null==n?null:r7.makeFromBucketSpec(n,e)}class iG{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=rZ,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=r?this._bucket=r7.makeFromBucketSpec(r,this._host):this._bucket=i$(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=r7.makeFromBucketSpec(this._url,e):this._bucket=i$(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){is("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){is("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new iK(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new ie(r8());{let s=function(e,t,n,r,i,s,o=!0){let a=function(e){let t=encodeURIComponent,n="?";for(let r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n.slice(0,-1)}(e.urlParams),l=e.url+a,u=Object.assign({},e.headers);return t&&(u["X-Firebase-GMPID"]=t),null!==n&&n.length>0&&(u.Authorization="Firebase "+n),u["X-Firebase-Storage-Version"]="webjs/"+(null!=s?s:"AppManager"),null!==r&&(u["X-Firebase-AppCheck"]=r),new il(l,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}let iH="@firebase/storage",iW="0.11.2";(0,I.om)(new T.uA("storage",function(e,{instanceIdentifier:t}){let n=e.getProvider("app").getImmediate();return new iG(n,e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,I.MF)},"PUBLIC").setMultipleInstances(!0)),(0,I.KO)(iH,iW,""),(0,I.KO)(iH,iW,"esm2017");let iQ=(e,t)=>t.some(t=>e instanceof t),iY=new WeakMap,iX=new WeakMap,iJ=new WeakMap,iZ=new WeakMap,i0=new WeakMap,i1={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return iX.get(e);if("objectStoreNames"===t)return e.objectStoreNames||iJ.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return i2(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function i2(e){if(e instanceof IDBRequest){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(i2(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&iY.set(t,e)}).catch(()=>{}),i0.set(t,e),t}if(iZ.has(e))return iZ.get(e);let t=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(g||(g=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(i3(this),t),i2(iY.get(this))}:function(...t){return i2(e.apply(i3(this),t))}:function(t,...n){let r=e.call(i3(this),t,...n);return iJ.set(r,t.sort?t.sort():[t]),i2(r)};return(e instanceof IDBTransaction&&function(e){if(iX.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});iX.set(e,t)}(e),iQ(e,p||(p=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,i1):e}(e);return t!==e&&(iZ.set(e,t),i0.set(t,e)),t}let i3=e=>i0.get(e),i4=["get","getKey","getAll","getAllKeys","count"],i6=["put","add","delete","clear"],i5=new Map;function i8(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(i5.get(t))return i5.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=i6.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||i4.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return i5.set(t,s),s}i1=(e=>({...e,get:(t,n,r)=>i8(t,n)||e.get(t,n,r),has:(t,n)=>!!i8(t,n)||e.has(t,n)}))(i1);let i9="@firebase/installations",i7="0.6.4",se=`w:${i7}`,st="FIS_v2",sn=new E.FA("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function sr(e){return e instanceof E.g&&e.code.includes("request-failed")}function si({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function ss(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function so(e,t){let n=(await t.json()).error;return sn.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function sa({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function sl(e,{refreshToken:t}){var n;let r=sa(e);return r.append("Authorization",(n=t,`${st} ${n}`)),r}async function su(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function sh({appConfig:e,heartbeatServiceProvider:t},{fid:n}){let r=si(e),i=sa(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let o={method:"POST",headers:i,body:JSON.stringify({fid:n,authVersion:st,appId:e.appId,sdkVersion:se})},a=await su(()=>fetch(r,o));if(a.ok){let e=await a.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:ss(e.authToken)}}throw await so("Create Installation",a)}function sc(e){return new Promise(t=>{setTimeout(t,e)})}let sd=/^[cdef][\w-]{21}$/;function sf(e){return`${e.appName}!${e.appId}`}let sp=new Map;function sg(e,t){let n=sf(e);sm(n,t),function(e,t){let n=function(){return!sy&&"BroadcastChannel"in self&&((sy=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{sm(e.data.key,e.data.fid)}),sy}();n&&n.postMessage({key:e,fid:t}),function(){0===sp.size&&sy&&(sy.close(),sy=null)}()}(n,t)}function sm(e,t){let n=sp.get(e);if(n)for(let e of n)e(t)}let sy=null,sv="firebase-installations-store",s_=null;function sw(){return s_||(s_=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,1),a=i2(o);return r&&o.addEventListener("upgradeneeded",e=>{r(i2(o.result),e.oldVersion,e.newVersion,i2(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}("firebase-installations-database",0,{upgrade:(e,t)=>{0===t&&e.createObjectStore(sv)}})),s_}async function sb(e,t){let n=sf(e),r=(await sw()).transaction(sv,"readwrite"),i=r.objectStore(sv),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||sg(e,t.fid),t}async function sI(e){let t=sf(e),n=(await sw()).transaction(sv,"readwrite");await n.objectStore(sv).delete(t),await n.done}async function sT(e,t){let n=sf(e),r=(await sw()).transaction(sv,"readwrite"),i=r.objectStore(sv),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,o&&(!s||s.fid!==o.fid)&&sg(e,o.fid),o}async function sE(e){let t,n=await sT(e.appConfig,n=>{let r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(sn.create("app-offline"))};let n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=sC(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:sS(e)}:{installationEntry:t}}(e,sx(n||{fid:function(){try{var e;let t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;let n=(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22));return sd.test(n)?n:""}catch(e){return""}}(),registrationStatus:0}));return t=r.registrationPromise,r.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function sC(e,t){try{let n=await sh(e,t);return sb(e.appConfig,n)}catch(n){throw sr(n)&&409===n.customData.serverCode?await sI(e.appConfig):await sb(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function sS(e){let t=await sk(e.appConfig);for(;1===t.registrationStatus;)await sc(100),t=await sk(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:n}=await sE(e);return n||t}return t}function sk(e){return sT(e,e=>{if(!e)throw sn.create("installation-not-found");return sx(e)})}function sx(e){var t;return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function sA({appConfig:e,heartbeatServiceProvider:t},n){let r=function(e,{fid:t}){return`${si(e)}/${t}/authTokens:generate`}(e,n),i=sl(e,n),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let o={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:se,appId:e.appId}})},a=await su(()=>fetch(r,o));if(a.ok)return ss(await a.json());throw await so("Generate Auth Token",a)}async function sN(e,t=!1){let n,r=await sT(e.appConfig,r=>{var i;if(!sO(r))throw sn.create("not-registered");let s=r.authToken;if(!t&&2===(i=s).requestStatus&&!function(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(i))return r;if(1===s.requestStatus)return n=sD(e,t),r;{if(!navigator.onLine)throw sn.create("app-offline");let t=function(e){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=sP(e,t),t}});return n?await n:r.authToken}async function sD(e,t){let n=await sR(e.appConfig);for(;1===n.authToken.requestStatus;)await sc(100),n=await sR(e.appConfig);let r=n.authToken;return 0===r.requestStatus?sN(e,t):r}function sR(e){return sT(e,e=>{var t;if(!sO(e))throw sn.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function sP(e,t){try{let n=await sA(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await sb(e.appConfig,r),n}catch(n){if(sr(n)&&(401===n.customData.serverCode||404===n.customData.serverCode))await sI(e.appConfig);else{let n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await sb(e.appConfig,n)}throw n}}function sO(e){return void 0!==e&&2===e.registrationStatus}async function sM(e){let{installationEntry:t,registrationPromise:n}=await sE(e);return n?n.catch(console.error):sN(e).catch(console.error),t.fid}async function sL(e,t=!1){return await sF(e),(await sN(e,t)).token}async function sF(e){let{registrationPromise:t}=await sE(e);t&&await t}function sU(e){return sn.create("missing-app-config-values",{valueName:e})}let sV="installations";(0,I.om)(new T.uA(sV,e=>{let t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw sU("App Configuration");if(!e.name)throw sU("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw sU(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),r=(0,I.j6)(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},"PUBLIC")),(0,I.om)(new T.uA("installations-internal",e=>{let t=e.getProvider("app").getImmediate(),n=(0,I.j6)(t,sV).getImmediate();return{getId:()=>sM(n),getToken:e=>sL(n,e)}},"PRIVATE")),(0,I.KO)(i9,i7),(0,I.KO)(i9,i7,"esm2017");let sq="@firebase/remote-config",sj="0.4.4";class sB{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}let sz=new E.FA("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});class sK{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&null.indexOf(this._value.toLowerCase())>=0}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}class s${constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;let n=Date.now()-t,r=n<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${n}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}async fetch(e){let[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;let r=await this.client.fetch(e),i=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===r.status&&i.push(this.storage.setLastSuccessfulFetchResponse(r)),await Promise.all(i),r}}class sG{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(e){let t,n,r,[i,s]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),o=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",a=`${o}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,l=fetch(a,{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},body:JSON.stringify({sdk_version:this.sdkVersion,app_instance_id:i,app_instance_id_token:s,app_id:this.appId,language_code:function(e=navigator){return e.languages&&e.languages[0]||e.language}()})}),u=new Promise((t,n)=>{e.signal.addEventListener(()=>{let e=Error("The operation was aborted.");e.name="AbortError",n(e)})});try{await Promise.race([l,u]),t=await l}catch(t){let e="fetch-client-network";throw(null==t?void 0:t.name)==="AbortError"&&(e="fetch-timeout"),sz.create(e,{originalErrorMessage:null==t?void 0:t.message})}let h=t.status,c=t.headers.get("ETag")||void 0;if(200===t.status){let e;try{e=await t.json()}catch(e){throw sz.create("fetch-client-parse",{originalErrorMessage:null==e?void 0:e.message})}n=e.entries,r=e.state}if("INSTANCE_STATE_UNSPECIFIED"===r?h=500:"NO_CHANGE"===r?h=304:("NO_TEMPLATE"===r||"EMPTY_CONFIG"===r)&&(n={}),304!==h&&200!==h)throw sz.create("fetch-status",{httpStatus:h});return{status:h,eTag:c,config:n}}}class sH{constructor(e,t){this.client=e,this.storage=t}async fetch(e){let t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var r;await (r=e.signal,new Promise((e,n)=>{let i=setTimeout(e,Math.max(t-Date.now(),0));r.addEventListener(()=>{clearTimeout(i),n(sz.create("fetch-throttle",{throttleEndTimeMillis:t}))})}));try{let t=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),t}catch(r){if(!function(e){if(!(e instanceof E.g)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(r))throw r;let t={throttleEndTimeMillis:Date.now()+(0,E.p9)(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(t),this.attemptFetch(e,t)}}}class sW{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function sQ(e,t){let n=e.target.error||void 0;return sz.create(t,{originalErrorMessage:n&&(null==n?void 0:n.message)})}let sY="app_namespace_store";class sX{constructor(e,t,n,r=new Promise((e,t)=>{try{let n=indexedDB.open("firebase_remote_config",1);n.onerror=e=>{t(sQ(e,"storage-open"))},n.onsuccess=t=>{e(t.target.result)},n.onupgradeneeded=e=>{let t=e.target.result;0===e.oldVersion&&t.createObjectStore(sY,{keyPath:"compositeKey"})}}catch(e){t(sz.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){let t=await this.openDbPromise;return new Promise((n,r)=>{let i=t.transaction([sY],"readonly").objectStore(sY),s=this.createCompositeKey(e);try{let e=i.get(s);e.onerror=e=>{r(sQ(e,"storage-get"))},e.onsuccess=e=>{let t=e.target.result;t?n(t.value):n(void 0)}}catch(e){r(sz.create("storage-get",{originalErrorMessage:null==e?void 0:e.message}))}})}async set(e,t){let n=await this.openDbPromise;return new Promise((r,i)=>{let s=n.transaction([sY],"readwrite").objectStore(sY),o=this.createCompositeKey(e);try{let e=s.put({compositeKey:o,value:t});e.onerror=e=>{i(sQ(e,"storage-set"))},e.onsuccess=()=>{r()}}catch(e){i(sz.create("storage-set",{originalErrorMessage:null==e?void 0:e.message}))}})}async delete(e){let t=await this.openDbPromise;return new Promise((n,r)=>{let i=t.transaction([sY],"readwrite").objectStore(sY),s=this.createCompositeKey(e);try{let e=i.delete(s);e.onerror=e=>{r(sQ(e,"storage-delete"))},e.onsuccess=()=>{n()}}catch(e){r(sz.create("storage-delete",{originalErrorMessage:null==e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class sJ{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){let e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),r=await e;r&&(this.lastFetchStatus=r);let i=await t;i&&(this.lastSuccessfulFetchTimestampMillis=i);let s=await n;s&&(this.activeConfig=s)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}(0,I.om)(new T.uA("remote-config",function(e,{instanceIdentifier:t}){let n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw sz.create("registration-window");if(!(0,E.zW)())throw sz.create("indexed-db-unavailable");let{projectId:i,apiKey:s,appId:o}=n.options;if(!i)throw sz.create("registration-project-id");if(!s)throw sz.create("registration-api-key");if(!o)throw sz.create("registration-app-id");t=t||"firebase";let a=new sX(o,n.name,t),l=new sJ(a),u=new C.Vy(sq);u.logLevel=C.$b.ERROR;let h=new sW(n,new s$(new sH(new sG(r,I.MF,t,i,s,o),a),a,l,u),l,a,u);return!function(e){let t=(0,E.Ku)(e);t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}(h),h},"PUBLIC").setMultipleInstances(!0)),(0,I.KO)(sq,sj),(0,I.KO)(sq,sj,"esm2017");var sZ=function(e,t){return(sZ=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function s0(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}sZ(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s1(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var l=[s,a];if(n)throw TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){o=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(6===l[0]&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function s2(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s3(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function s4(e,t,n){if(n||2==arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function s6(e){return this instanceof s6?(this.v=e,this):new s6(e)}function s5(e){return"function"==typeof e}function s8(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var s9=s8(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,t){return t+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function s7(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var oe=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=s2(s),a=o.next();!a.done;a=o.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else s.remove(this);var l=this.initialTeardown;if(s5(l))try{l()}catch(e){i=e instanceof s9?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var h=s2(u),c=h.next();!c.done;c=h.next()){var d=c.value;try{or(d)}catch(e){i=null!=i?i:[],e instanceof s9?i=s4(s4([],s3(i)),s3(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}}if(i)throw new s9(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)or(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(n=this._finalizers)?n:[]).push(e)}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&s7(t,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&s7(n,e),e instanceof t&&e._removeParent(this)},(e=new t).closed=!0,t.EMPTY=e,t}(),ot=oe.EMPTY;function on(e){return e instanceof oe||e&&"closed"in e&&s5(e.remove)&&s5(e.add)&&s5(e.unsubscribe)}function or(e){s5(e)?e():e.unsubscribe()}var oi={Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},os={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=os.delegate;return null!=i&&i.setTimeout?i.setTimeout.apply(i,s4([e,t],s3(n))):setTimeout.apply(void 0,s4([e,t],s3(n)))},clearTimeout:function(e){var t=os.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function oo(e){os.setTimeout(function(){throw e})}function oa(){}var ol=null;function ou(e){if(oi.useDeprecatedSynchronousErrorHandling){var t=!ol;if(t&&(ol={errorThrown:!1,error:null}),e(),t){var n=ol,r=n.errorThrown,i=n.error;if(ol=null,r)throw i}}else e()}var oh=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,on(t)&&t.add(n)):n.destination=og,n}return s0(t,e),t.create=function(e,t,n){return new op(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(oe),oc=Function.prototype.bind;function od(e,t){return oc.call(e,t)}var of=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){oo(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){oo(e)}else oo(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){oo(e)}},e}(),op=function(e){function t(t,n,r){var i,s,o=e.call(this)||this;return s5(t)||!t?s={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&oi.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&od(t.next,i),error:t.error&&od(t.error,i),complete:t.complete&&od(t.complete,i)}):s=t,o.destination=new of(s),o}return s0(t,e),t}(oh),og={closed:!0,next:oa,error:function(e){throw e},complete:oa},om="function"==typeof Symbol&&Symbol.observable||"@@observable";function oy(e){return e}var ov=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=!function(e){return e&&e instanceof oh||e&&s5(e.next)&&s5(e.error)&&s5(e.complete)&&on(e)}(e)?new op(e,t,n):e;return ou(function(){var e=r.operator,t=r.source;i.add(e?e.call(i,t):t?r._subscribe(i):r._trySubscribe(i))}),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=o_(t))(function(t,r){var i=new op({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)})},e.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},e.prototype[om]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===e.length?oy:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)})(this)},e.prototype.toPromise=function(e){var t=this;return new(e=o_(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function o_(e){var t;return null!=(t=null!=e?e:oi.Promise)?t:Promise}function ow(e){return function(t){if(s5(null==t?void 0:t.lift))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError("Unable to lift unknown Observable type")}}function ob(e,t,n,r,i){return new oI(e,t,n,r,i)}var oI=function(e){function t(t,n,r,i,s,o){var a=e.call(this,t)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return s0(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),n||null==(t=this.onFinalize)||t.call(this)}},t}(oh),oT=s8(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),oE=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return s0(t,e),t.prototype.lift=function(e){var t=new oC(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new oT},t.prototype.next=function(e){var t=this;ou(function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=s2(t.currentObservers),s=i.next();!s.done;s=i.next())s.value.next(e)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;ou(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;ou(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null==(e=this.observers)?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this.hasError,r=this.isStopped,i=this.observers;return n||r?ot:(this.currentObservers=null,i.push(e),new oe(function(){t.currentObservers=null,s7(i,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,n=this.thrownError,r=this.isStopped;t?e.error(n):r&&e.complete()},t.prototype.asObservable=function(){var e=new ov;return e.source=this,e},t.create=function(e,t){return new oC(e,t)},t}(ov),oC=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return s0(t,e),t.prototype.next=function(e){var t,n;null==(n=null==(t=this.destination)?void 0:t.next)||n.call(t,e)},t.prototype.error=function(e){var t,n;null==(n=null==(t=this.destination)?void 0:t.error)||n.call(t,e)},t.prototype.complete=function(){var e,t;null==(t=null==(e=this.destination)?void 0:e.complete)||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!=(n=null==(t=this.source)?void 0:t.subscribe(e))?n:ot},t}(oE),oS={now:function(){return(oS.delegate||Date).now()},delegate:void 0},ok=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=oS);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return s0(t,e),t.prototype.next=function(t){var n=this.isStopped,r=this._buffer,i=this._infiniteTimeWindow,s=this._timestampProvider,o=this._windowTime;n||(r.push(t),i||r.push(s.now()+o)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer,i=r.slice(),s=0;s<i.length&&!e.closed;s+=n?1:2)e.next(i[s]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,n=this._buffer,r=this._infiniteTimeWindow,i=(r?1:2)*e;if(e<1/0&&i<n.length&&n.splice(0,n.length-i),!r){for(var s=t.now(),o=0,a=1;a<n.length&&n[a]<=s;a+=2)o=a;o&&n.splice(0,o+1)}},t}(oE),ox=function(e){function t(t,n){return e.call(this)||this}return s0(t,e),t.prototype.schedule=function(e,t){return this},t}(oe),oA={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=oA.delegate;return null!=i&&i.setInterval?i.setInterval.apply(i,s4([e,t],s3(n))):setInterval.apply(void 0,s4([e,t],s3(n)))},clearInterval:function(e){var t=oA.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},oN=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return s0(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),oA.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;oA.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,s7(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(ox),oD=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=oS.now,e}(),oR=new(function(e){function t(t,n){void 0===n&&(n=oD.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return s0(t,e),t.prototype.flush=function(e){var t,n=this.actions;if(this._active)return void n.push(e);this._active=!0;do if(t=e.execute(e.state,e.delay))break;while(e=n.shift());if(this._active=!1,t){for(;e=n.shift();)e.unsubscribe();throw t}},t}(oD))(oN),oP=new ov(function(e){return e.complete()});function oO(e){return e&&s5(e.schedule)}function oM(e){return e[e.length-1]}function oL(e){return oO(oM(e))?e.pop():void 0}var oF=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function oU(e){return s5(null==e?void 0:e.then)}function oV(e){return Symbol.asyncIterator&&s5(null==e?void 0:e[Symbol.asyncIterator])}function oq(e){return TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var oj="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function oB(e){return s5(null==e?void 0:e[oj])}function oz(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})})}function a(e,t){try{var n;(n=i[e](t)).value instanceof s6?Promise.resolve(n.value.v).then(l,u):h(s[0][2],n)}catch(e){h(s[0][3],e)}}function l(e){a("next",e)}function u(e){a("throw",e)}function h(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function(){var t,n,r;return s1(this,function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,s6(t.read())];case 3:return r=(n=i.sent()).value,n.done?[4,s6(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,s6(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function oK(e){return s5(null==e?void 0:e.getReader)}function o$(e){if(e instanceof ov)return e;if(null!=e){var t,n,r,i;if(s5(e[om])){return t=e,new ov(function(e){var n=t[om]();if(s5(n.subscribe))return n.subscribe(e);throw TypeError("Provided object does not correctly implement Symbol.observable")})}if(oF(e)){return n=e,new ov(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}if(oU(e)){return r=e,new ov(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,oo)})}if(oV(e))return oG(e);if(oB(e)){return i=e,new ov(function(e){var t,n;try{for(var r=s2(i),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}e.complete()})}if(oK(e))return oG(oz(e))}throw oq(e)}function oG(e){return new ov(function(t){(function(e,t){var n,r,i,s,o,a,l,u;return o=this,a=void 0,l=void 0,u=function(){var o;return s1(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=s2(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){var s,o,a;s=r,o=i,a=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){s({value:e,done:a})},o)})}}}(e),a.label=1;case 1:return[4,n.next()];case 2:if((r=a.sent()).done)return[3,4];if(o=r.value,t.next(o),t.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return i={error:a.sent()},[3,11];case 6:return a.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})},new(l||(l=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):((i=t.value)instanceof l?i:new l(function(e){e(i)})).then(n,r)}i((u=u.apply(o,a||[])).next())})})(e,t).catch(function(e){return t.error(e)})})}function oH(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function oW(e,t){return void 0===t&&(t=0),ow(function(n,r){n.subscribe(ob(r,function(n){return oH(r,e,function(){return r.next(n)},t)},function(){return oH(r,e,function(){return r.complete()},t)},function(n){return oH(r,e,function(){return r.error(n)},t)}))})}function oQ(e,t){return void 0===t&&(t=0),ow(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function oY(e,t){if(!e)throw Error("Iterable cannot be null");return new ov(function(n){oH(n,t,function(){var r=e[Symbol.asyncIterator]();oH(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function oX(e,t){return t?function(e,t){if(null!=e){if(s5(e[om]))return o$(e).pipe(oQ(t),oW(t));if(oF(e))return new ov(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})});if(oU(e))return o$(e).pipe(oQ(t),oW(t));if(oV(e))return oY(e,t);if(oB(e))return new ov(function(n){var r;return oH(n,t,function(){r=e[oj](),oH(n,t,function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){n.error(e);return}i?n.complete():n.next(t)},0,!0)}),function(){return s5(null==r?void 0:r.return)&&r.return()}});if(oK(e))return oY(oz(e),t)}throw oq(e)}(e,t):o$(e)}function oJ(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=oL(e);return oX(e,n)}var oZ=s8(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function o0(e,t){return ow(function(n,r){var i=0;n.subscribe(ob(r,function(n){r.next(e.call(t,n,i++))}))})}function o1(e,t,n){return void 0===n&&(n=1/0),s5(t)?o1(function(n,r){return o0(function(e,i){return t(n,e,r,i)})(o$(e(n,r)))},n):("number"==typeof t&&(n=t),ow(function(t,r){var i,s,o,a,l,u,h,c,d;return i=n,o=[],a=0,l=0,u=!1,h=function(){!u||o.length||a||r.complete()},c=function(e){return a<i?d(e):o.push(e)},d=function(t){a++;var n=!1;o$(e(t,l++)).subscribe(ob(r,function(e){s?c(e):r.next(e)},function(){n=!0},void 0,function(){if(n)try{for(a--;o.length&&a<i;)!function(){var e=o.shift();d(e)}();h()}catch(e){r.error(e)}}))},t.subscribe(ob(r,c,function(){u=!0,h()})),function(){}}))}function o2(e){return void 0===e&&(e=1/0),o1(oy,e)}function o3(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=oL(t),i=(e=1/0,"number"==typeof oM(t)?t.pop():e);return t.length?1===t.length?o$(t[0]):o2(i)(oX(t,r)):oP}function o4(e){return e<=0?function(){return oP}:ow(function(t,n){var r=0;t.subscribe(ob(n,function(t){++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function o6(e,t){return e===t}function o5(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0===t)return void e();if(!1!==t){var i=new op({next:function(){i.unsubscribe(),e()}});return t.apply(void 0,s4([],s3(n))).subscribe(i)}}let o8=b.createContext(void 0),o9=b.createContext(!1),o7=(e,t)=>e===t||[...Object.keys(e),...Object.keys(t)].every(n=>e[n]===t[n]);function ae(e){let{firebaseConfig:t,appName:n,suspense:r}=e,i=b.useMemo(()=>{if(e.firebaseApp)return e.firebaseApp;let r=(0,rJ.Dk)().find(e=>e.name===(n||"[DEFAULT]"));if(r){if(t&&o7(r.options,t))return r;throw Error(`Does not match the options already provided to the ${n||"default"} firebase app instance, give this new instance a different appName.`)}{if(!t)throw Error("No firebaseConfig provided");let e=b.version||"unknown";return(0,rJ.KO)("react",e),(0,rJ.KO)("reactfire","4.2.3"),(0,rJ.Wp)(t,n)}},[e.firebaseApp,t,n]);return b.createElement(o8.Provider,{value:i},b.createElement(o9.Provider,Object.assign({value:null!=r&&r},e)))}function at(e){let t=f.useContext(o9);return void 0!==e?e:t}function an(){let e=b.useContext(o8);if(!e)throw Error("Cannot call useFirebaseApp unless your component is within a FirebaseAppProvider");return e}var ar=function(){return(ar=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function ai(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}!function(e){e.added="child_added",e.removed="child_removed",e.changed="child_changed",e.moved="child_moved",e.value="value"}(w||(w={}));var as=Object.freeze(((_={})[w.added]=function(e,t,n,r){return rG(e,"child_added",t,n,r)},_[w.removed]=function(e,t,n,r){return rG(e,"child_removed",t,n,r)},_[w.changed]=function(e,t,n,r){return rG(e,"child_changed",t,n,r)},_[w.moved]=function(e,t,n,r){return rG(e,"child_moved",t,n,r)},_[w.value]=function(e,t,n,r){return rG(e,"value",t,n,r)},_));function ao(e,t){for(var n=e.length,r=0;r<n;r++)if(e[r].snapshot.key===t)return r;return -1}function aa(e,t){var n=t.snapshot,r=t.prevKey,i=t.event,s=n.key,o=ao(e,s),a=function(e,t){if(null==t)return 0;var n=ao(e,t);return -1===n?e.length:n+1}(e,r||void 0);switch(i){case w.value:if(t.snapshot&&t.snapshot.exists()){var l=null;t.snapshot.forEach(function(t){var n={snapshot:t,event:w.value,prevKey:l};return l=t.key,e=ai(ai([],e),[n]),!1})}return e;case w.added:if(o>-1){var u=e[o-1];(u&&u.snapshot.key||null)!==r&&(e=e.filter(function(e){return e.snapshot.key!==n.key})).splice(a,0,t)}else{if(null==r)return ai([t],e);(e=e.slice()).splice(a,0,t)}return e;case w.removed:return e.filter(function(e){return e.snapshot.key!==n.key});case w.changed:return e.map(function(e){return e.snapshot.key===s?t:e});case w.moved:if(o>-1){var h=e.splice(o,1)[0];return(e=e.slice()).splice(a,0,h),e}return e;default:return e}}let al=globalThis._reactFireDatabaseCachedQueries||[];globalThis._reactFireDatabaseCachedQueries||(globalThis._reactFireDatabaseCachedQueries=al);var au={includeMetadataChanges:!1};class ah extends oE{constructor(e,t){super(),this._timeoutWindow=t,this._hasValue=!1,this._error=void 0,this._firstEmission=new Promise(e=>this._resolveFirstEmission=e),this._innerObservable=e.pipe(function(e,t,n){var r=s5(e)?{next:e,error:void 0,complete:void 0}:e;return r?ow(function(e,t){null==(n=r.subscribe)||n.call(r);var n,i=!0;e.subscribe(ob(t,function(e){var n;null==(n=r.next)||n.call(r,e),t.next(e)},function(){var e;i=!1,null==(e=r.complete)||e.call(r),t.complete()},function(e){var n;i=!1,null==(n=r.error)||n.call(r,e),t.error(e)},function(){var e,t;i&&(null==(e=r.unsubscribe)||e.call(r)),null==(t=r.finalize)||t.call(r)}))}):oy}({next:e=>{this._next(e)},error:e=>{this._error=e,this._resolveFirstEmission()}}),function e(t){return ow(function(n,r){var i,s=null,o=!1;s=n.subscribe(ob(r,void 0,void 0,function(a){i=o$(t(a,e(t)(n))),s?(s.unsubscribe(),s=null,i.subscribe(r)):o=!0})),o&&(s.unsubscribe(),s=null,i.subscribe(r))})}(()=>{var e;return oP}),function(e,t,n){var r,i,s,o,a,l,u,h,c,d,p,g,m,y=!1;return m=null!=e?e:1/0,s=void 0===(i=(r={connector:function(){return new ok(m,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:y}).connector)?function(){return new oE}:i,a=void 0===(o=r.resetOnError)||o,u=void 0===(l=r.resetOnComplete)||l,c=void 0===(h=r.resetOnRefCountZero)||h,function(e){var t,n,r,i=0,o=!1,l=!1,h=function(){null==n||n.unsubscribe(),n=void 0},d=function(){h(),t=r=void 0,o=l=!1},p=function(){var e=t;d(),null==e||e.unsubscribe()};return ow(function(e,g){i++,l||o||h();var m=r=null!=r?r:s();g.add(function(){0!=--i||l||o||(n=o5(p,c))}),m.subscribe(g),!t&&i>0&&(t=new op({next:function(e){return m.next(e)},error:function(e){l=!0,h(),n=o5(d,a,e),m.error(e)},complete:function(){o=!0,h(),n=o5(d,u),m.complete()}}),o$(e).subscribe(t))})(e)}}(1)),this._warmupSubscription=this._innerObservable.subscribe(),this._timeoutHandler=setTimeout(this._reset.bind(this),this._timeoutWindow)}get hasValue(){return this._hasValue||!!this._error}get value(){if(this._error)throw this._error;if(!this.hasValue)throw Error("Can only get value if SuspenseSubject has a value");return this._value}get firstEmission(){return this._firstEmission}_next(e){this._hasValue=!0,this._value=e,this._resolveFirstEmission()}_reset(){this._warmupSubscription&&this._warmupSubscription.unsubscribe(),this._hasValue=!1,this._value=void 0,this._error=void 0,this._firstEmission=new Promise(e=>this._resolveFirstEmission=e)}_subscribe(e){return this._timeoutHandler&&clearTimeout(this._timeoutHandler),this._innerSubscriber=this._innerObservable.subscribe(e),this._innerSubscriber}get ourError(){return this._error}}let ac=globalThis._reactFirePreloadedObservables||new Map;function ad(e,t,n={}){var r;if(!e)throw Error("cannot call useObservable without an observableId");let i=function(e,t){if(ac.has(t))return ac.get(t);{let n=new ah(e,3e4);return ac.set(t,n),n}}(t,e),s=n.hasOwnProperty("initialData")||n.hasOwnProperty("startWithValue"),o=i.hasValue||s;if(!0===at(n.suspense)&&!o)throw i.firstEmission;let a={status:o?"success":"loading",hasEmitted:o,isComplete:!1,data:i.hasValue?i.value:null!=(r=null==n?void 0:n.initialData)?r:null==n?void 0:n.startWithValue,error:i.ourError,firstValuePromise:i.firstEmission},[l,u]=f.useReducer(function(e,t){let n=Object.assign(Object.assign({},e),{hasEmitted:e.hasEmitted||i.hasValue,error:i.ourError,firstValuePromise:i.firstEmission});switch(i.hasValue&&(n.data=i.value),t){case"value":return n.status="success",n;case"error":return n.status="error",n;case"complete":return n.isComplete=!0,n;default:throw Error(`invalid action "${t}"`)}},a);return f.useEffect(()=>{let e=i.subscribe({next:()=>{u("value")},error:e=>{throw u("error"),e},complete:()=>{u("complete")}});return()=>e.unsubscribe()},[i]),l}globalThis._reactFirePreloadedObservables||(globalThis._reactFirePreloadedObservables=ac);let af=globalThis._reactFireFirestoreQueryCache||[];globalThis._reactFireFirestoreQueryCache||(globalThis._reactFireFirestoreQueryCache=af);function ap(e){var t=e.remoteConfig,n=e.key,r=e.getter;return new ov(function(e){Kt(t).then(function(){var i=r.bind(t);e.next(i(t,n))})})}function ag(e){var t,n;let{storage:r,storagePath:i,suspense:s,placeHolder:o}=e,a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}(e,["storage","storagePath","suspense","placeHolder"]),l={suspense:at(s)};if(!r)throw Error("Storage was not passed to component INTERNALStorageImage. This should not be possible");let{status:u,data:h}=(t=Qt(r,i),n=l,ad(`storage:downloadUrl:${t.toString()}`,oX(qt(t)),n));return"success"===u?(a.alt||""===a.alt||console.warn(`No alt prop provided for StorageImage with storagePath "${i}"`,"img elements must have an alt prop, either with meaningful text, or an empty string for decorative images"),f.createElement("img",Object.assign({src:h,alt:a.alt},a))):null!=o?o:f.createElement(f.Fragment,null,"''")}let am=b.createContext(void 0),ay=b.createContext(void 0),av=b.createContext(void 0),a_=b.createContext(void 0),aw=b.createContext(void 0),ab=b.createContext(void 0),aI=b.createContext(void 0),aT=b.createContext(void 0),aE=b.createContext(void 0);function aC(e){return function(t){var n,r;if(!t.sdk)throw Error("no sdk provided");let i=an().name;if((null==(r=null==(n=null==t?void 0:t.sdk)?void 0:n.app)?void 0:r.name)!==i)throw Error("sdk was initialized with a different firebase app");return b.createElement(e.Provider,Object.assign({value:t.sdk},t))}}function aS(e){let t=f.useContext(e);if(!t)throw Error("SDK not found. useSdk must be called from within a provider");return t}aC(am),aC(ay),aC(av),aC(a_),aC(aw),aC(ab),aC(aT),aC(aI),aC(aE);let ak=()=>aS(aI),ax=()=>aS(aE);class aA extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="ReactFireError",Object.setPrototypeOf(this,aA.prototype)}}},6042:(e,t,n)=>{"use strict";n.d(t,{Dk:()=>r.Dk,KO:()=>r.KO,Wp:()=>r.Wp});var r=n(6614);(0,r.KO)("firebase","9.23.0","app")},6048:()=>{},6525:(e,t,n)=>{"use strict";var r;n.d(t,{$b:()=>r,Vy:()=>u});let i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));let s={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,a={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},l=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=a[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}},6614:(e,t,n)=>{"use strict";let r,i;n.d(t,{MF:()=>O,j6:()=>D,om:()=>N,Sx:()=>L,Dk:()=>F,Wp:()=>M,KO:()=>U});var s=n(8308),o=n(6525),a=n(9207);let l=(e,t)=>t.some(t=>e instanceof t),u=new WeakMap,h=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,g={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){if(e instanceof IDBRequest){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(m(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&u.set(t,e)}).catch(()=>{}),p.set(t,e),t}if(d.has(e))return d.get(e);let t=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(y(this),t),m(u.get(this))}:function(...t){return m(e.apply(y(this),t))}:function(t,...n){let r=e.call(y(this),t,...n);return c.set(r,t.sort?t.sort():[t]),m(r)};return(e instanceof IDBTransaction&&function(e){if(h.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});h.set(e,t)}(e),l(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,g):e}(e);return t!==e&&(d.set(e,t),p.set(t,e)),t}let y=e=>p.get(e),v=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],w=new Map;function b(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(w.get(t))return w.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||v.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return w.set(t,s),s}g=(e=>({...e,get:(t,n,r)=>b(t,n)||e.get(t,n,r),has:(t,n)=>!!b(t,n)||e.has(t,n)}))(g);class I{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let T="@firebase/app",E="0.9.13",C=new o.Vy("@firebase/app"),S="[DEFAULT]",k={[T]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},x=new Map,A=new Map;function N(e){let t=e.name;if(A.has(t))return C.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(A.set(t,e),x.values()))try{n.container.addComponent(e)}catch(t){C.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}return!0}function D(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}let R=new a.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class P{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new s.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw R.create("app-deleted",{appName:this._name})}}let O="9.23.0";function M(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:S,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw R.create("bad-app-name",{appName:String(i)});if(n||(n=(0,a.T9)()),!n)throw R.create("no-options");let o=x.get(i);if(o)if((0,a.bD)(n,o.options)&&(0,a.bD)(r,o.config))return o;else throw R.create("duplicate-app",{appName:i});let l=new s.h1(i);for(let e of A.values())l.addComponent(e);let u=new P(n,r,l);return x.set(i,u),u}function L(e=S){let t=x.get(e);if(!t&&e===S&&(0,a.T9)())return M();if(!t)throw R.create("no-app",{appName:e});return t}function F(){return Array.from(x.values())}function U(e,t,n){var r;let i=null!=(r=k[e])?r:e;n&&(i+=`-${n}`);let o=i.match(/\s|\//),a=t.match(/\s|\//);if(o||a){let e=[`Unable to register library "${i}" with version "${t}":`];o&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),C.warn(e.join(" "));return}N(new s.uA(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}let V="firebase-heartbeat-store",q=null;function j(){return q||(q=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,1),a=m(o);return r&&o.addEventListener("upgradeneeded",e=>{r(m(o.result),e.oldVersion,e.newVersion,m(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{0===t&&e.createObjectStore(V)}}).catch(e=>{throw R.create("idb-open",{originalErrorMessage:e.message})})),q}async function B(e){try{let t=await j();return await t.transaction(V).objectStore(V).get(K(e))}catch(e){if(e instanceof a.g)C.warn(e.message);else{let t=R.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});C.warn(t.message)}}}async function z(e,t){try{let n=(await j()).transaction(V,"readwrite"),r=n.objectStore(V);await r.put(t,K(e)),await n.done}catch(e){if(e instanceof a.g)C.warn(e.message);else{let t=R.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});C.warn(t.message)}}}function K(e){return`${e.name}!${e.options.appId}`}class ${constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new H(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=G();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))?void 0:(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let e=G(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),W(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),W(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,a.Uj)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function G(){return new Date().toISOString().substring(0,10)}class H{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,a.zW)()&&(0,a.eX)().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await B(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return z(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return z(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function W(e){return(0,a.Uj)(JSON.stringify({version:2,heartbeats:e})).length}N(new s.uA("platform-logger",e=>new I(e),"PRIVATE")),N(new s.uA("heartbeat",e=>new $(e),"PRIVATE")),U(T,E,""),U(T,E,"esm2017"),U("fire-js","")},8308:(e,t,n)=>{"use strict";n.d(t,{h1:()=>a,uA:()=>i});var r=n(9207);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!=(n=this.onInitCallbacks.get(r))?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===s?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},9207:(e,t,n)=>{"use strict";n.d(t,{$L:()=>U,$g:()=>D,A4:()=>g,Am:()=>W,As:()=>V,Cv:()=>j,FA:()=>L,Fy:()=>C,Hk:()=>o,I9:()=>Q,Im:()=>$,K3:()=>u,KA:()=>c,Ku:()=>es,OE:()=>er,T9:()=>I,Tj:()=>w,Uj:()=>d,XA:()=>T,ZQ:()=>S,bD:()=>function e(t,n){if(t===n)return!0;let r=Object.keys(t),i=Object.keys(n);for(let s of r){if(!i.includes(s))return!1;let r=t[s],o=n[s];if(H(r)&&H(o)){if(!e(r,o))return!1}else if(r!==o)return!1}for(let e of i)if(!r.includes(e))return!1;return!0},cY:()=>E,dI:()=>et,eX:()=>O,g:()=>M,gR:()=>z,gz:()=>X,hp:()=>Y,jZ:()=>k,kH:()=>G,kj:()=>en,lT:()=>N,lV:()=>A,nr:()=>R,p9:()=>ei,qc:()=>B,sr:()=>x,tD:()=>J,u:()=>p,vA:()=>s,yU:()=>b,yw:()=>K,zW:()=>P});var r=n(5364);let i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(e,t){if(!e)throw o(t)},o=function(e){return Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},l=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],o=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,u=i>>2,h=(3&i)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),r.push(n[u],n[h],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):l(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new h;let l=i<<2|s>>4;if(r.push(l),64!==o){let e=s<<4&240|o>>2;if(r.push(e),64!==a){let e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class h extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let c=function(e){let t=a(e);return u.encodeByteArray(t,!0)},d=function(e){return c(e).replace(/\./g,"")},p=function(e){try{return u.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function g(e){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let r in n)n.hasOwnProperty(r)&&"__proto__"!==r&&(t[r]=e(t[r],n[r]));return t}(void 0,e)}let m=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,y=()=>{if(void 0===r||void 0===r.env)return;let e=r.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},v=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&p(e[1]);return t&&JSON.parse(t)},_=()=>{try{return m()||y()||v()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},w=e=>{var t,n;return null==(n=null==(t=_())?void 0:t.emulatorHosts)?void 0:n[e]},b=e=>{let t=w(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},I=()=>{var e;return null==(e=_())?void 0:e.config},T=e=>{var t;return null==(t=_())?void 0:t[`_${e}`]};class E{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function C(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[d(JSON.stringify({alg:"none",type:"JWT"})),d(JSON.stringify(s)),""].join(".")}function S(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function k(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(S())}function x(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function A(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function N(){let e=S();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function D(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}function R(){return!function(){var e;let t=null==(e=_())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function P(){try{return"object"==typeof indexedDB}catch(e){return!1}}function O(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}})}class M extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,M.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,L.prototype.create)}}class L{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,r=i,n.replace(F,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new M(s,l,i)}}let F=/\{\$([^}]+)}/g;function U(e){return JSON.parse(e)}function V(e){return JSON.stringify(e)}let q=function(e){let t={},n={},r={},i="";try{let s=e.split(".");t=U(p(s[0])||""),n=U(p(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},j=function(e){let t=q(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},B=function(e){let t=q(e).claims;return"object"==typeof t&&!0===t.admin};function z(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function K(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function $(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function G(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function H(e){return null!==e&&"object"==typeof e}function W(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Q(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function Y(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class X{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,r;t||(t=0);let i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=t<<1|t>>>31}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],u=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),r=0x5a827999):(n=o^a^l,r=0x6ed9eba1):e<60?(n=o&a|l&(o|a),r=0x8f1bbcdc):(n=o^a^l,r=0xca62c1d6);let t=(s<<5|s>>>27)+n+u+r+i[e]|0;u=l,l=a,a=o<<30|o>>>2,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+u|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}function J(e,t){let n=new Z(e,t);return n.subscribe.bind(n)}class Z{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=ee),void 0===r.error&&(r.error=ee),void 0===r.complete&&(r.complete=ee);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ee(){}function et(e,t){return`${e} failed: ${t} argument `}let en=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;s(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},er=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function ei(e,t=1e3,n=2){let r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function es(e){return e&&e._delegate?e._delegate:e}}},e=>{var t=t=>e(e.s=t);e.O(0,[593,792],()=>(t(92),t(8253))),_N_E=e.O()}]);