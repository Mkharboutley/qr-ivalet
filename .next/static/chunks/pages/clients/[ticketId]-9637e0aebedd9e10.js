(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[10],{417:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>o});var i=s(7876),a=s(4232),r=s(9099),c=s(5665),n=s(5965),l=s(9779),d=s.n(l);function o(){var t;let e=(0,n.sh)(),s=(0,c.aU)(e),{ticketId:l}=(0,r.useRouter)().query,[o,u]=(0,a.useState)(null),[_,h]=(0,a.useState)(""),[g,k]=(0,a.useState)(""),[x,m]=(0,a.useState)(!0),[f,p]=(0,a.useState)(!1),[j,w]=(0,a.useState)(0);(0,a.useEffect)(()=>{l&&(async()=>{try{let t=(0,c.P)((0,c.rJ)(s,"tickets"),(0,c._M)("ticket_number","==",parseInt(l))),e=await (0,c.GG)(t);if(e.empty)k("Ticket not found.");else{let t=e.docs[0],s=t.data();h(t.id),u(s);let i=s.requestedAt&&s.etaMinutes;if(p(i),i){let t=s.requestedAt.toDate().getTime()+6e4*s.etaMinutes;w(Math.max(t-Date.now(),0))}}}catch(t){k(t.message)}finally{m(!1)}})()},[l]),(0,a.useEffect)(()=>{if(!f||j<=0)return;let t=setInterval(()=>{w(t=>Math.max(t-1e3,0))},1e3);return()=>clearInterval(t)},[f,j]);let N=async()=>{let t=(await (0,c.GG)((0,c.P)((0,c.rJ)(s,"tickets"),(0,c._M)("status","==","requested"),(0,c.My)("requestedAt","asc")))).docs.length,e=t<5?7:7*Math.ceil(t/5),i=c.Dc.now();await (0,c.mZ)((0,c.H9)(s,"tickets",_),{requestedAt:i,etaMinutes:e,status:"requested",assignedWorker:t<5?t+1:null}),p(!0),w(6e4*e),u(t=>({...t,status:"requested",requestedAt:i,etaMinutes:e}))},v=Math.floor(j/6e4).toString().padStart(2,"0"),M=Math.floor(j%6e4/1e3).toString().padStart(2,"0");return x?(0,i.jsx)("p",{className:d().container,children:"Loading ticket..."}):g?(0,i.jsx)("p",{className:d().container,children:g}):(0,i.jsxs)("div",{className:d().container,children:[(0,i.jsx)("img",{src:"/logo.gif",alt:"i-Valet",className:d().logo}),(0,i.jsxs)("div",{className:d().card,children:[(0,i.jsx)("h2",{className:d().title,children:"Valet Ticket"}),(0,i.jsxs)("div",{className:d().detail,children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Ticket #:"})," ",o.ticket_number]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Plate:"})," ",o.plate_number]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Model:"})," ",o.car_model]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Entry Time:"})," ",null==(t=o.createdAt)?void 0:t.toDate().toLocaleString()]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Status:"})," ",o.status]})]}),f?(0,i.jsxs)("div",{className:d().countdown,children:[v,":",M]}):(0,i.jsx)("button",{onClick:N,className:d().button,children:"Request My Car"})]}),(0,i.jsx)("div",{className:d().shadowBox,children:(0,i.jsx)("img",{src:"/car-waiting.gif",alt:"waiting",className:d().gif})})]})}},7276:(t,e,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/clients/[ticketId]",function(){return s(417)}])},9099:(t,e,s)=>{t.exports=s(8253)},9779:t=>{t.exports={container:"ticketid_container__9GeE_",logo:"ticketid_logo__Q2ibl",gif:"ticketid_gif__p0Rdf",card:"ticketid_card__E_1E4",glowBorder:"ticketid_glowBorder__pTpkP",title:"ticketid_title__172IW",detail:"ticketid_detail__o4BJD",countdown:"ticketid_countdown__pLsvC",button:"ticketid_button__cDYWs"}}},t=>{var e=e=>t(t.s=e);t.O(0,[636,593,792],()=>e(7276)),_N_E=t.O()}]);